// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Snapshots: overreacted.io.rss 1`] = `
Object {
  "feed": Object {
    "attrs": Map {
      "xmlns:dc" => "http://purl.org/dc/elements/1.1/",
      "xmlns:content" => "http://purl.org/rss/1.0/modules/content/",
      "xmlns:atom" => "http://www.w3.org/2005/Atom",
      "version" => "2.0",
    },
    "meta": Map {
      "title" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "",
        "value": "Overreacted",
      },
      "description" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "",
        "value": "Personal blog by Dan Abramov. I explain with words and code.",
      },
      "link" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "",
        "value": "https://overreacted.io",
      },
      "generator" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "",
        "value": "RSS for Node",
      },
      "lastBuildDate" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "",
        "value": "Fri, 22 Feb 2019 12:35:03 GMT",
      },
    },
    "type": "rss",
    "uri": "",
    "version": "2.0",
  },
  "items": Array [
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Fix Like No One’s Watching",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "The other kind of technical debt.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/fix-like-no-ones-watching/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/fix-like-no-ones-watching/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Fri, 15 Feb 2019 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>Some technical debt is in plain sight.</p>
<p>An inadequate data structure might lead to convoluted code. When the requirements keep changing, the code might contain traces of previous approaches. Sometimes the code is written in a hurry or is just sloppy.</p>
<p>This kind of technical debt is easy to discuss because it’s highly visible. It manifests as bugs, performance problems, and difficulties adding features.</p>
<p>There is another, more insidious kind of technical debt.</p>
<p>Maybe the test suite is a <em>little bit</em> slow. Not slow to a crawl — but just enough that you don’t bother looking at a bug and add it to the backlog instead. Maybe you don’t trust the deployment script so you skip that extra release. Perhaps the abstraction layers make it too hard to locate a performance regression so you leave a TODO in the code. Sometimes the unit tests are too rigid so you postpone trying an intriguing new idea until after you’ve shipped the planned features.</p>
<p>None of these things are dealbreakers. If anything, they might seem like distractions. It feels vain to complain about them. After all, if they <em>really</em> mattered, you would have done those things despite the friction, wouldn’t you?</p>
<p>And so these things never get done. They don’t seem important enough by themselves. <strong>The friction killed them.</strong> Some of these explorations could be of no consequence. Some of them could redefine your project.</p>
<p>You never know. This is why you must actively reduce friction. Like your project’s fate depends on it. Because it does.</p>
<p>Fix like no one’s watching.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/fix-like-no-ones-watching/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Making setInterval Declarative with React Hooks",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "How I learned to stop worrying and love refs.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/making-setinterval-declarative-with-react-hooks/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/making-setinterval-declarative-with-react-hooks/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Mon, 04 Feb 2019 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>If you played with <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">React Hooks</a> for more than a few hours, you probably ran into an intriguing problem: using <code class=\\"language-text\\">setInterval</code> just <a href=\\"https://stackoverflow.com/questions/53024496/state-not-updating-when-using-react-state-hook-within-setinterval\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">doesn’t work</a> as you’d expect.</p>
<p>In the <a href=\\"https://mobile.twitter.com/ryanflorence/status/1088606583637061634\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">words</a> of Ryan Florence:</p>
<blockquote>
<p>I’ve had a lot of people point to setInterval with hooks as some sort of egg on React’s face</p>
</blockquote>
<p>Honestly, I think these people have a point. It <em>is</em> confusing at first.</p>
<p>But I’ve also come to see it not as a flaw of Hooks but as a mismatch between the <a href=\\"https://overreacted.io/react-as-a-ui-runtime/\\">React programming model</a> and <code class=\\"language-text\\">setInterval</code>. Hooks, being closer to the React programming model than classes, make that mismatch more prominent.</p>
<p><strong>There <em>is</em> a way to get them working together very well but it’s a bit unintuitive.</strong></p>
<p>In this post, we’ll look at <em>how</em> to make intervals and Hooks play well together, <em>why</em> this solution makes sense, and which <em>new</em> capabilities it can give you.</p>
<hr>
<p><strong>Disclaimer: this post focuses on a <em>pathological case</em>. Even if an API simplifies a hundred use cases, the discussion will always focus on the one that got harder.</strong></p>
<p>If you’re new to Hooks and don’t understand what the fuss is about, check out <a href=\\"https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">this introduction</a> and the <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">documentation</a> instead. This post assumes that you worked with Hooks for more than an hour.</p>
<hr>
<h2 id=\\"just-show-me-the-code\\"><a href=\\"#just-show-me-the-code\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Just Show Me the Code</h2>
<p>Without further ado, here’s a counter that increments every second:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">import</span> React<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> useState<span class=\\"token punctuation\\">,</span> useEffect<span class=\\"token punctuation\\">,</span> useRef <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'react'</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token comment\\">// Your custom logic here</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(Here’s a <a href=\\"https://codesandbox.io/s/105x531vkq\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>.)</em></p>
<p>This <code class=\\"language-text\\">useInterval</code> isn’t a built-in React Hook; it’s a <a href=\\"https://reactjs.org/docs/hooks-custom.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">custom Hook</a> that I wrote:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">import</span> React<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> useState<span class=\\"token punctuation\\">,</span> useEffect<span class=\\"token punctuation\\">,</span> useRef <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'react'</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span>callback<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> savedCallback <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useRef</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Remember the latest callback.</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    savedCallback<span class=\\"token punctuation\\">.</span>current <span class=\\"token operator\\">=</span> callback<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Set up the interval.</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>delay <span class=\\"token operator\\">!==</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(Here’s a <a href=\\"https://codesandbox.io/s/105x531vkq\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a> in case you missed it earlier.)</em></p>
<p><strong>My <code class=\\"language-text\\">useInterval</code> Hook sets up an interval and clears it after unmounting.</strong> It’s a combo of <code class=\\"language-text\\">setInterval</code> and <code class=\\"language-text\\">clearInterval</code> tied to the component lifecycle.</p>
<p>Feel free to copy paste it in your project or put it on npm.</p>
<p><strong>If you don’t care how this works, you can stop reading now! The rest of the blog post is for folks who are ready to take a deep dive into React Hooks.</strong></p>
<hr>
<h2 id=\\"wait-what-\\"><a href=\\"#wait-what-\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Wait What?! 🤔</h2>
<p>I know what you’re thinking:</p>
<blockquote>
<p>Dan, this code doesn’t make any sense. What happened to “Just JavaScript”? Admit that React has jumped the shark with Hooks!</p>
</blockquote>
<p><strong>I thought this too but I changed my mind, and I’m going to change yours.</strong> Before explaining why this code makes sense, I want to show off what it can do.</p>
<hr>
<h2 id=\\"why-useinterval-is-a-better-api\\"><a href=\\"#why-useinterval-is-a-better-api\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Why <code class=\\"language-text\\">useInterval()</code> Is a Better API</h2>
<p>To remind you, my <code class=\\"language-text\\">useInterval</code> Hook accepts a function and a delay:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// ...</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This looks a lot like <code class=\\"language-text\\">setInterval</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// ...</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p><strong>So why not just use <code class=\\"language-text\\">setInterval</code> directly?</strong></p>
<p>This may not be obvious at first, but the difference between the <code class=\\"language-text\\">setInterval</code> you know and my <code class=\\"language-text\\">useInterval</code> Hook is that <strong>its arguments are “dynamic”</strong>.</p>
<p>I’ll illustrate this point with a concrete example.</p>
<hr>
<p>Let’s say we want the interval delay to be adjustable:</p>
<p><img src=\\"https://overreacted.io/counter_delay-35e4f35a8585255b11c090aed9f72433.gif\\" alt=\\"Counter with an input that adjusts the interval delay\\"></p>
<p>While you wouldn’t necessarily control the delay with an <em>input</em>, adjusting it dynamically can be useful — for example, to poll for some AJAX updates less often while the user has switched to a different tab.</p>
<p>So how would you do this with <code class=\\"language-text\\">setInterval</code> in a class? I ended up with this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Counter</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
    count<span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span>
    delay<span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">componentDidMount</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>interval <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>tick<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\"></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">componentDidUpdate</span><span class=\\"token punctuation\\">(</span>prevProps<span class=\\"token punctuation\\">,</span> prevState<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>prevState<span class=\\"token punctuation\\">.</span>delay <span class=\\"token operator\\">!==</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>delay<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>interval<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>interval <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>tick<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\"></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">componentWillUnmount</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>interval<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\"></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function-variable function\\">tick</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      count<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span>
  <span class=\\"token function-variable function\\">handleDelayChange</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> delay<span class=\\"token punctuation\\">:</span> <span class=\\"token function\\">Number</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
      <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>delay<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">onChange</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>handleDelayChange<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(Here’s a <a href=\\"https://codesandbox.io/s/mz20m600mp\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>.)</em></p>
<p>This is not too bad!</p>
<p>What’s the Hook version looking like?</p>
<p><font size=\\"50\\">🥁🥁🥁</font></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">,</span> setDelay<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token comment\\">// Your custom logic here</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleDelayChange</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setDelay</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">Number</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>delay<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">onChange</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>handleDelayChange<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(Here’s a <a href=\\"https://codesandbox.io/s/329jy81rlm\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>.)</em></p>
<p>Yeah, <em>that’s all it takes</em>.</p>
<p>Unlike the class version, there is no complexity gap for “upgrading” the <code class=\\"language-text\\">useInterval</code> Hook example to have a dynamically adjusted delay:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token comment\\">// Constant delay</span>
  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token comment\\">// Adjustable delay</span>
  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>When <code class=\\"language-text\\">useInterval</code> Hook sees a different delay, it sets up the interval again.</p>
<p><strong>Instead of writing code to <em>set</em> and <em>clear</em> the interval, I can <em>declare</em> an interval with a particular delay — and our <code class=\\"language-text\\">useInterval</code> Hook makes it happen.</strong></p>
<p>What if I want to temporarily <em>pause</em> my interval? I can do this with state too:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">,</span> setDelay<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>isRunning<span class=\\"token punctuation\\">,</span> setIsRunning<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> isRunning <span class=\\"token operator\\">?</span> delay <span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p><em>(Here is a <a href=\\"https://codesandbox.io/s/l240mp2pm7\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">demo</a>!)</em></p>
<p>This is what gets me excited about Hooks and React all over again. We can wrap the existing imperative APIs and create declarative APIs expressing our intent more closely. Just like with rendering, we can <strong>describe the process at all points in time simultaneously</strong> instead of carefully issuing commands to manipulate it.</p>
<hr>
<p>I hope by this you’re sold on <code class=\\"language-text\\">useInterval()</code> Hook being a nicer API — at least when we’re doing it from a component.</p>
<p><strong>But why is using <code class=\\"language-text\\">setInterval()</code> and <code class=\\"language-text\\">clearInterval()</code> annoying with Hooks?</strong> Let’s go back to our counter example and try to implement it manually.</p>
<hr>
<h2 id=\\"first-attempt\\"><a href=\\"#first-attempt\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>First Attempt</h2>
<p>I’ll start with a simple example that just renders the initial state:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Now I want an interval that increments it every second. It’s a <a href=\\"https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">side effect that needs cleanup</a> so I’m going to <code class=\\"language-text\\">useEffect()</code> and return the cleanup function:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(See the <a href=\\"https://codesandbox.io/s/7wlxk1k87j\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>.)</em></p>
<p>Seems easy enough? This kind of works.</p>
<p><strong>However, this code has a strange behavior.</strong></p>
<p>React by default re-applies effects after every render. This is intentional and helps avoid <a href=\\"https://reactjs.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">a whole class of bugs</a> that are present in React class components.</p>
<p>This is usually good because many subscription APIs can happily remove the old and add a new listener at any time. However, <code class=\\"language-text\\">setInterval</code> isn’t one of them. When we run <code class=\\"language-text\\">clearInterval</code> and <code class=\\"language-text\\">setInterval</code>, their timing shifts. If we re-render and re-apply effects too often, the interval never gets a chance to fire!</p>
<p>We can see the bug by re-rendering our component within a <em>smaller</em> interval:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Re-renders and re-applies Counter's effects</span>
  <span class=\\"token comment\\">// which in turn causes it to clearInterval()</span>
  <span class=\\"token comment\\">// and setInterval() before that interval fires.</span>
  ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Counter</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span> rootElement<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">100</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p><em>(See a <a href=\\"https://codesandbox.io/s/9j86r218y4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">demo</a> of this bug.)</em></p>
<hr>
<h2 id=\\"second-attempt\\"><a href=\\"#second-attempt\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Second Attempt</h2>
<p>You might know that <code class=\\"language-text\\">useEffect()</code> lets us <a href=\\"https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><em>opt out</em></a> of re-applying effects. You can specify a dependency array as a second argument, and React will only re-run the effect if something in that array changes:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  document<span class=\\"token punctuation\\">.</span>title <span class=\\"token operator\\">=</span> <span class=\\"token template-string\\"><span class=\\"token string\\">\`You clicked </span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>count<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\"> times\`</span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>When we want to <em>only</em> run the effect on mount and cleanup on unmount, we can pass an empty <code class=\\"language-text\\">[]</code> array of dependencies.</p>
<p>However, this is a common source of mistakes if you’re not very familiar with JavaScript closures. We’re going to make this mistake right now! (We’re also building a <a href=\\"https://github.com/facebook/react/pull/14636\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">lint rule</a> to surface these bugs early but it’s not quite ready yet.)</p>
<p>In the first attempt, our problem was that re-running the effects caused our timer to get cleared too early. We can try to fix it by never re-running them:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>However, now our counter updates to 1 and stays there. (<a href=\\"https://codesandbox.io/s/jj0mk6y683\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">See the bug in action</a>.)</p>
<p>What happened?!</p>
<p><strong>The problem is that <code class=\\"language-text\\">useEffect</code> captures the <code class=\\"language-text\\">count</code> from the first render.</strong> It is equal to <code class=\\"language-text\\">0</code>. We never re-apply the effect so the closure in <code class=\\"language-text\\">setInterval</code> always references the <code class=\\"language-text\\">count</code> from the first render, and <code class=\\"language-text\\">count + 1</code> is always <code class=\\"language-text\\">1</code>. Oops!</p>
<p><strong>I can hear your teeth grinding. Hooks are so annoying, right?</strong></p>
<p><a href=\\"https://codesandbox.io/s/j379jxrzjy\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">One way</a> to fix it is to replace <code class=\\"language-text\\">setCount(count + 1)</code> with the “updater” form like <code class=\\"language-text\\">setCount(c =&gt; c + 1)</code>. It can always reads fresh state for that variable. But this doesn’t help you read the fresh props, for example.</p>
<p><a href=\\"https://codesandbox.io/s/00o9o95jyv\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Another fix</a> is to <a href=\\"https://reactjs.org/docs/hooks-reference.html#usereducer\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useReducer()</code></a>. This approach gives you more flexibility. Inside the reducer, you have the access both to current state and fresh props. The <code class=\\"language-text\\">dispatch</code> function itself never changes so you can pump data into it from any closure. One limitation of <code class=\\"language-text\\">useReducer()</code> is that you can’t yet emit side effects in it. (However, you could return new state — triggering some effect.)</p>
<p><strong>But why is it getting so convoluted?</strong></p>
<hr>
<h2 id=\\"the-impedance-mismatch\\"><a href=\\"#the-impedance-mismatch\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>The Impedance Mismatch</h2>
<p>This term is sometimes thrown around, and <a href=\\"https://haacked.com/archive/2004/06/15/impedance-mismatch.aspx/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Phil Haack</a> explains it like this:</p>
<blockquote>
<p>One might say Databases are from Mars and Objects are from Venus. Databases do not map naturally to object models. It’s a lot like trying to push the north poles of two magnets together.</p>
</blockquote>
<p>Our “impedance mismatch” is not between Databases and Objects. It is between the React programming model and the imperative <code class=\\"language-text\\">setInterval</code> API.</p>
<p><strong>A React component may be mounted for a while and go through many different states, but its render result describes <em>all of them at once.</em></strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token comment\\">// Describes every render</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>Hooks let us apply the same declarative approach to effects:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token comment\\">// Describes every interval state</span>
  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> isRunning <span class=\\"token operator\\">?</span> delay <span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>We don’t <em>set</em> the interval, but specify <em>whether</em> it is set and with what delay. Our Hook makes it happen. A continuous process is described in discrete terms.</p>
<p><strong>By contrast, <code class=\\"language-text\\">setInterval</code> does not describe a process in time — once you set the interval, you can’t change anything about it except clearing it.</strong></p>
<p>That’s the mismatch between the React model and the <code class=\\"language-text\\">setInterval</code> API.</p>
<hr>
<p>Props and state of React components can change. React will re-render them and “forget” everything about the previous render result. It becomes irrelevant.</p>
<p>The <code class=\\"language-text\\">useEffect()</code> Hook “forgets” the previous render too. It cleans up the last effect and sets up the next effect. The next effect closes over fresh props and state. This is why our <a href=\\"https://codesandbox.io/s/7wlxk1k87j\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">first attempt</a> worked for simple cases.</p>
<p><strong>But <code class=\\"language-text\\">setInterval()</code> does not “forget”.</strong> It will forever reference the old props and state until you replace it — which you can’t do without resetting the time.</p>
<p>Or wait, can you?</p>
<hr>
<h2 id=\\"refs-to-the-rescue\\"><a href=\\"#refs-to-the-rescue\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Refs to the Rescue!</h2>
<p>The problem boils down to this:</p>
<ul>
<li>We do <code class=\\"language-text\\">setInterval(callback1, delay)</code> with <code class=\\"language-text\\">callback1</code> from first render.</li>
<li>We have <code class=\\"language-text\\">callback2</code> from next render that closes over fresh props and state.</li>
<li>But we can’t replace an already existing interval without resetting the time!</li>
</ul>
<p><strong>So what if we didn’t replace the interval at all, and instead introduced a mutable <code class=\\"language-text\\">savedCallback</code> variable pointing to the <em>latest</em> interval callback?</strong></p>
<p>Now we can see the solution:</p>
<ul>
<li>We <code class=\\"language-text\\">setInterval(fn, delay)</code> where <code class=\\"language-text\\">fn</code> calls <code class=\\"language-text\\">savedCallback</code>.</li>
<li>Set <code class=\\"language-text\\">savedCallback</code> to <code class=\\"language-text\\">callback1</code> after the first render.</li>
<li>Set <code class=\\"language-text\\">savedCallback</code> to <code class=\\"language-text\\">callback2</code> after the next render.</li>
<li>???</li>
<li>PROFIT</li>
</ul>
<p>This mutable <code class=\\"language-text\\">savedCallback</code> needs to “persist” across the re-renders. So it can’t be a regular variable. We want something more like an instance field.</p>
<p><a href=\\"https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">As we can learn from the Hooks FAQ,</a> <code class=\\"language-text\\">useRef()</code> gives us exactly that:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> savedCallback <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useRef</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// { current: null }</span></code></pre></div>
<p><em>(You might be familiar with <a href=\\"https://reactjs.org/docs/refs-and-the-dom.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">DOM refs</a> in React. Hooks use the same concept for holding any mutable values. A ref is like a “box” into which you can put anything.)</em></p>
<p><code class=\\"language-text\\">useRef()</code> returns a plain object with a mutable <code class=\\"language-text\\">current</code> property that’s shared between renders. We can save the <em>latest</em> interval callback into it:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">callback</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// Can read fresh props, state, etc.</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token comment\\">// After every render, save the latest callback into our ref.</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">    savedCallback<span class=\\"token punctuation\\">.</span>current <span class=\\"token operator\\">=</span> callback<span class=\\"token punctuation\\">;</span></span>  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>And then we can read and call it from inside our interval:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>Thanks to <code class=\\"language-text\\">[]</code>, our effect never re-executes, and the interval doesn’t get reset. However, thanks to the <code class=\\"language-text\\">savedCallback</code> ref, we can always read the callback that we set after the last render, and call it from the interval tick.</p>
<p>Here’s a complete working solution:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> savedCallback <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useRef</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">callback</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">    savedCallback<span class=\\"token punctuation\\">.</span>current <span class=\\"token operator\\">=</span> callback<span class=\\"token punctuation\\">;</span></span>  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token operator\\">&lt;</span>h1<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>h1<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(See the <a href=\\"https://codesandbox.io/s/3499qqr565\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>.)</em></p>
<hr>
<h2 id=\\"extracting-a-hook\\"><a href=\\"#extracting-a-hook\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Extracting a Hook</h2>
<p>Admittedly, the above code can be disorienting. It’s mind-bending to mix the opposite paradigms. There’s also a potential to make a mess with mutable refs.</p>
<p><strong>I think Hooks provide lower-level primitives than classes — but their beauty is that they enable us to compose and create better declarative abstractions.</strong></p>
<p>Ideally, I just want to write this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token operator\\">&lt;</span>h1<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>h1<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>I’ll copy and paste the body of my ref mechanism into a custom Hook:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span>callback<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> savedCallback <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useRef</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    savedCallback<span class=\\"token punctuation\\">.</span>current <span class=\\"token operator\\">=</span> callback<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Currently, the <code class=\\"language-text\\">1000</code> delay is hardcoded. I want to make it an argument:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span>callback<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></code></pre></div>
<p>I will use it when I set up the interval:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p> Now that the <code class=\\"language-text\\">delay</code> can change between renders, I need to declare it in the dependencies of my interval effect:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>Wait, didn’t we want to avoid resetting the interval effect, and specifically passed <code class=\\"language-text\\">[]</code> to avoid it? Not quite. We only wanted to avoid resetting it when the <em>callback</em> changes. But when the <code class=\\"language-text\\">delay</code> changes, we <em>want</em> to restart the timer!</p>
<p>Let’s check if our code works:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span>callback<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> savedCallback <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useRef</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    savedCallback<span class=\\"token punctuation\\">.</span>current <span class=\\"token operator\\">=</span> callback<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(Try it on <a href=\\"https://codesandbox.io/s/xvyl15375w\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox</a>.)</em></p>
<p>It does! We can now <code class=\\"language-text\\">useInterval()</code> in any component and not think too much about its implementation details.</p>
<h2 id=\\"bonus-pausing-the-interval\\"><a href=\\"#bonus-pausing-the-interval\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Bonus: Pausing the Interval</h2>
<p>Say we want to be able to pause our interval by passing <code class=\\"language-text\\">null</code> as the <code class=\\"language-text\\">delay</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">,</span> setDelay<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>isRunning<span class=\\"token punctuation\\">,</span> setIsRunning<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> isRunning <span class=\\"token operator\\">?</span> delay <span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>How do we implement this? The answer is: by not setting up an interval.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">tick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      savedCallback<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">current</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>delay <span class=\\"token operator\\">!==</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>      <span class=\\"token keyword\\">let</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span>tick<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p><em>(See the <a href=\\"https://codesandbox.io/s/l240mp2pm7\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>.)</em></p>
<p>That’s it. This code handles all possible transitions: a change of a delay, pausing, or resuming an interval. The <code class=\\"language-text\\">useEffect()</code> API asks us to spend more upfront effort to describe the setup and cleanup — but adding new cases is easy.</p>
<h2 id=\\"bonus-fun-demo\\"><a href=\\"#bonus-fun-demo\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Bonus: Fun Demo</h2>
<p>This <code class=\\"language-text\\">useInterval()</code> Hook is really fun to play with. When the side effects are declarative, it’s much easier to orchestrate complex behaviors together.</p>
<p><strong>For example, we can have a <code class=\\"language-text\\">delay</code> of one interval be controlled by another:</strong></p>
<p><img src=\\"https://overreacted.io/counter_inception-10cfc4b38497a46980d3a13048a56e36.gif\\" alt=\\"Counter that automatically speeds up\\"></p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>delay<span class=\\"token punctuation\\">,</span> setDelay<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Increment the counter.</span>
  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// Make it faster every second!</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>delay <span class=\\"token operator\\">></span> <span class=\\"token number\\">10</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token function\\">setDelay</span><span class=\\"token punctuation\\">(</span>delay <span class=\\"token operator\\">/</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleReset</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setDelay</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>h1<span class=\\"token operator\\">></span>Counter<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>h1<span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>h4<span class=\\"token operator\\">></span>Delay<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>delay<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>h4<span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>button onClick<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>handleReset<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">></span>
        Reset delay
      <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>button<span class=\\"token operator\\">></span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(See the <a href=\\"https://codesandbox.io/s/znr418qp13\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">CodeSandbox demo</a>!)</em></p>
<h2 id=\\"closing-thoughts\\"><a href=\\"#closing-thoughts\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Closing Thoughts</h2>
<p>Hooks take some getting used to — and <em>especially</em> at the boundary of imperative and declarative code. You can create powerful declarative abstractions with them like <a href=\\"http://react-spring.surge.sh/hooks\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">React Spring</a> but they can definitely get on your nerves sometimes.</p>
<p>This is an early time for Hooks, and there are definitely still patterns we need to work out and compare. Don’t rush to adopt Hooks if you’re used to following well-known “best practices”. There’s still a lot to try and discover.</p>
<p>I hope this post helps you understand the common pitfalls related to using APIs like <code class=\\"language-text\\">setInterval()</code> with Hooks, the patterns that can help you overcome them, and the sweet fruit of creating more expressive declarative APIs on top of them.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/making-setinterval-declarative-with-react-hooks/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "React as a UI Runtime",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "An in-depth description of the React programming model.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/react-as-a-ui-runtime/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/react-as-a-ui-runtime/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Sat, 02 Feb 2019 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>Most tutorials introduce React as a UI library. This makes sense because React <em>is</em> a UI library. That’s literally what the tagline says!</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/0429fcb4a2f2022852afc698ff8968f1/74bd4/react.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 29.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVQY011Qy07DMBD0v1CniRM7dt4Pp01VWgmQOKEeekKCA0hIFUcOSIgfH9amDaWH0c4+ZrxeFiY5zjGPswlBqMCvIvCZ8Ajm8t/MpcZxdmkYyoKECubmAcv3b1S7J8Iz6v0L8vs95pH2c9I0MKWFLnqorJ2MWSBoE2H+QEVOm8jxDv3rB+zbJ4bDF5rHA8ztDjxMEcnSmzitM4nTyhsnugaTpoai19K8hc47z11T0pAQGkrliGMDlZKJrrw4qyxh8BqHhOpClcQ7MFP2aPoV+sV6QjesMYwb1N2IjnLXt8trLFZbtNbxDey49bmrO41QhT8DO32V0218PPIpP4v8OOu2dBvN6Ps8+u2dbvoDB8/AqO9EOdcAAAAASUVORK5CYII='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"React homepage screenshot: \\"A JavaScript library for building user interfaces\\"\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/0429fcb4a2f2022852afc698ff8968f1/74bd4/react.png\\"
        srcset=\\"https://overreacted.io/static/0429fcb4a2f2022852afc698ff8968f1/309d6/react.png 148w,https://overreacted.io/static/0429fcb4a2f2022852afc698ff8968f1/fe30e/react.png 295w,https://overreacted.io/static/0429fcb4a2f2022852afc698ff8968f1/74bd4/react.png 500w\\"
        sizes=\\"(max-width: 500px) 100vw, 500px\\"
      />
    </span>
  </span>

  </a>
    </p>
<p>I’ve written about the challenges of creating <a href=\\"https://overreacted.io/the-elements-of-ui-engineering/\\">user interfaces</a> before. But this post talks about React in a different way — more as a <a href=\\"https://en.wikipedia.org/wiki/Runtime_system\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">programming runtime</a>.</p>
<p><strong>This post won’t teach you anything about creating user interfaces.</strong> But it might help you understand the React programming model in more depth.</p>
<hr>
<p><strong>Note: If you’re <em>learning</em> React, check out <a href=\\"https://reactjs.org/docs/getting-started.html#learn-react\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">the docs</a> instead.</strong></p>
<p><font size=\\"60\\">⚠️</font></p>
<p><strong>This is a deep dive — THIS IS NOT a beginner-friendly post.</strong> In this post, I’m describing most of the React programming model from first principles. I don’t explain how to use it — just how it works.</p>
<p>It’s aimed at experienced programmers and folks working on other UI libraries who asked about some tradeoffs chosen in React. I hope you’ll find it useful!</p>
<p><strong>Many people successfully use React for years without thinking about most of these topics.</strong> This is definitely a programmer-centric view of React rather than, say, a <a href=\\"http://mrmrs.cc/writing/2016/04/21/developing-ui/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">designer-centric one</a>. But I don’t think it hurts to have resources for both.</p>
<p>With that disclaimer out of the way, let’s go!</p>
<hr>
<h2 id=\\"host-tree\\"><a href=\\"#host-tree\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Host Tree</h2>
<p>Some programs output numbers. Other programs output poems. Different languages and their runtimes are often optimized for a particular set of use cases, and React is no exception to that.</p>
<p>React programs usually output <strong>a tree that may change over time</strong>. It might be a <a href=\\"https://www.npmjs.com/package/react-dom\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">DOM tree</a>, an <a href=\\"https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">iOS hierarchy</a>, a tree of <a href=\\"https://react-pdf.org/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">PDF primitives</a>, or even of <a href=\\"https://reactjs.org/docs/test-renderer.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">JSON objects</a>. However, usually, we want to represent some UI with it. We’ll call it a “<em>host</em> tree” because it is a part of the <em>host environment</em> outside of React — like DOM or iOS. The host tree usually has <a href=\\"https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">its</a> <a href=\\"https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">own</a> imperative API. React is a layer on top of it.</p>
<p>So what is React useful for? Very abstractly, it helps you write a program that predictably manipulates a complex host tree in response to external events like interactions, network responses, timers, and so on.</p>
<p>A specialized tool works better than a generic one when it can impose and benefit from particular constraints. React makes a bet on two principles:</p>
<ul>
<li>
<p><strong>Stability.</strong> The host tree is relatively stable and most updates don’t radically change its overall structure. If an app rearranged all its interactive elements into a completely different combination every second, it would be difficult to use. Where did that button go? Why is my screen dancing?</p>
</li>
<li>
<p><strong>Regularity.</strong> The host tree can be broken down into UI patterns that look and behave consistently (such as buttons, lists, avatars) rather than random shapes.</p>
</li>
</ul>
<p><strong>These principles happen to be true for most UIs.</strong> However, React is ill-suited when there are no stable “patterns” in the output. For example, React may help you write a Twitter client but won’t be very useful for a <a href=\\"https://www.youtube.com/watch?v=Uzx9ArZ7MUU\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">3D pipes screensaver</a>.</p>
<h2 id=\\"host-instances\\"><a href=\\"#host-instances\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Host Instances</h2>
<p>The host tree consists of nodes. We’ll call them “host instances”.</p>
<p>In the DOM environment, host instances are regular DOM nodes — like the objects you get when you call <code class=\\"language-text\\">document.createElement(&#39;div&#39;)</code>. On iOS, host instances could be values uniquely identifying a native view from JavaScript.</p>
<p>Host instances have their own properties (e.g. <code class=\\"language-text\\">domNode.className</code> or <code class=\\"language-text\\">view.tintColor</code>). They may also contain other host instances as children.</p>
<p>(This has nothing to do with React — I’m describing the host environments.)</p>
<p>There is usually an API to manipulate host instances. For example, the DOM provides APIs like <code class=\\"language-text\\">appendChild</code>, <code class=\\"language-text\\">removeChild</code>, <code class=\\"language-text\\">setAttribute</code>, and so on. In React apps, you usually don’t call these APIs. That’s the job of React.</p>
<h2 id=\\"renderers\\"><a href=\\"#renderers\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Renderers</h2>
<p>A <em>renderer</em> teaches React to talk to a specific host environment and manage its host instances. React DOM, React Native, and even <a href=\\"https://mobile.twitter.com/vadimdemedes/status/1089344289102942211\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Ink</a> are React renderers. You can also <a href=\\"https://github.com/facebook/react/tree/master/packages/react-reconciler\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">create your own React renderer</a>.</p>
<p>React renderers can work in one of two modes.</p>
<p>The vast majority of renderers are written to use the “mutating” mode. This mode is how the DOM works: we can create a node, set its properties, and later add or remove children from it. The host instances are completely mutable.</p>
<p>React can also work in a “persistent” mode. This mode is for host environments that don’t provide methods like <code class=\\"language-text\\">appendChild()</code> but instead clone the parent tree and always replace the top-level child. Immutability on the host tree level makes multi-threading easier. <a href=\\"https://facebook.github.io/react-native/blog/2018/06/14/state-of-react-native-2018\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">React Fabric</a> takes advantage of that.</p>
<p>As a React user, you never need to think about these modes. I only want to highlight that React isn’t just an adapter from one mode to another. Its usefulness is orthogonal to the target low-level view API paradigm.</p>
<h2 id=\\"react-elements\\"><a href=\\"#react-elements\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>React Elements</h2>
<p>In the host environment, a host instance (like a DOM node) is the smallest building block. In React, the smallest building block is a <em>React element</em>.</p>
<p>A React element is a plain JavaScript object. It can <em>describe</em> a host instance.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// JSX is a syntax sugar for these objects.</span>
<span class=\\"token comment\\">// &lt;button className=\\"blue\\" /></span>
<span class=\\"token punctuation\\">{</span>
  type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'button'</span><span class=\\"token punctuation\\">,</span>
  props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span> className<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'blue'</span> <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>A React element is lightweight and has no host instance tied to it. Again, it is merely a <em>description</em> of what you want to see on the screen.</p>
<p>Like host instances, React elements can form a tree:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// JSX is a syntax sugar for these objects.</span>
<span class=\\"token comment\\">// &lt;dialog></span>
<span class=\\"token comment\\">//   &lt;button className=\\"blue\\" /></span>
<span class=\\"token comment\\">//   &lt;button className=\\"red\\" /></span>
<span class=\\"token comment\\">// &lt;/dialog></span>
<span class=\\"token punctuation\\">{</span>
  type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'dialog'</span><span class=\\"token punctuation\\">,</span>
  props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
    children<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span>
      type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'button'</span><span class=\\"token punctuation\\">,</span>
      props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span> className<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'blue'</span> <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span>
      type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'button'</span><span class=\\"token punctuation\\">,</span>
      props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span> className<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'red'</span> <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(Note: I omitted <a href=\\"https://overreacted.io/why-do-react-elements-have-typeof-property/\\">some properties</a> that aren’t important to this explanation.)</em></p>
<p>However, remember that <strong>React elements don’t have their own persistent identity.</strong> They’re meant to be re-created and thrown away all the time.</p>
<p>React elements are immutable. For example, you can’t change the children or a property of a React element. If you want to render something different later, you will <em>describe</em> it with a new React element tree created from scratch.</p>
<p>I like to think of React elements as being like frames in a movie. They capture what the UI should look like at a specific point in time. They don’t change.</p>
<h2 id=\\"entry-point\\"><a href=\\"#entry-point\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Entry Point</h2>
<p>Each React renderer has an “entry point”. It’s the API that lets us tell React to render a particular React element tree inside a container host instance.</p>
<p>For example, React DOM entry point is <code class=\\"language-text\\">ReactDOM.render</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token comment\\">// { type: 'button', props: { className: 'blue' } }</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">className</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>blue<span class=\\"token punctuation\\">\\"</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span>
  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>When we say <code class=\\"language-text\\">ReactDOM.render(reactElement, domContainer)</code>, we mean: <strong>“Dear React, make the <code class=\\"language-text\\">domContainer</code> host tree match my <code class=\\"language-text\\">reactElement</code>.”</strong></p>
<p>React will look at the <code class=\\"language-text\\">reactElement.type</code> (in our example, <code class=\\"language-text\\">&#39;button&#39;</code>) and ask the React DOM renderer to create a host instance for it and set the properties:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Somewhere in the ReactDOM renderer (simplified)</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createHostInstance</span><span class=\\"token punctuation\\">(</span>reactElement<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">let</span> domNode <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span>reactElement<span class=\\"token punctuation\\">.</span>type<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  domNode<span class=\\"token punctuation\\">.</span>className <span class=\\"token operator\\">=</span> reactElement<span class=\\"token punctuation\\">.</span>props<span class=\\"token punctuation\\">.</span>className<span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">return</span> domNode<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>In our example, effectively React will do this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">let</span> domNode <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'button'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">domNode<span class=\\"token punctuation\\">.</span>className <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'blue'</span><span class=\\"token punctuation\\">;</span></span>
domContainer<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>domNode<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>If the React element has child elements in <code class=\\"language-text\\">reactElement.props.children</code>, React will recursively create host instances for them too on the first render.</p>
<h2 id=\\"reconciliation\\"><a href=\\"#reconciliation\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Reconciliation</h2>
<p>What happens if we call <code class=\\"language-text\\">ReactDOM.render()</code> twice with the same container?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">className</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>blue<span class=\\"token punctuation\\">\\"</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span></span>  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token comment\\">// ... later ...</span>

<span class=\\"token comment\\">// Should this *replace* the button host instance</span>
<span class=\\"token comment\\">// or merely update a property on an existing one?</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">className</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>red<span class=\\"token punctuation\\">\\"</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span></span>  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>Again, React’s job is to <em>make the host tree match the provided React element tree</em>. The process of figuring out <em>what</em> to do to the host instance tree in response to new information is sometimes called <a href=\\"https://reactjs.org/docs/reconciliation.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">reconciliation</a>.</p>
<p>There are two ways to go about it. A simplified version of React could blow away the existing tree and re-create it from scratch:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> domContainer <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// Clear the tree</span>
domContainer<span class=\\"token punctuation\\">.</span>innerHTML <span class=\\"token operator\\">=</span> <span class=\\"token string\\">''</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// Create the new host instance tree</span>
<span class=\\"token keyword\\">let</span> domNode <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'button'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
domNode<span class=\\"token punctuation\\">.</span>className <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'red'</span><span class=\\"token punctuation\\">;</span>
domContainer<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>domNode<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>But in DOM, this is slow and loses important information like focus, selection, scroll state, and so on. Instead, we want React to do something like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> domNode <span class=\\"token operator\\">=</span> domContainer<span class=\\"token punctuation\\">.</span>firstChild<span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// Update existing host instance</span>
domNode<span class=\\"token punctuation\\">.</span>className <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'red'</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In other words, React needs to decide when to <em>update</em> an existing host instance to match a new React element, and when to create a <em>new</em> one.</p>
<p>This raises a question of <em>identity</em>. The React element may be different every time, but when does it refer to the same host instance conceptually?</p>
<p>In our example, it’s simple. We used to render a <code class=\\"language-text\\">&lt;button&gt;</code> as a first (and only) child, and we want to render a <code class=\\"language-text\\">&lt;button&gt;</code> in the same place again. We already have a <code class=\\"language-text\\">&lt;button&gt;</code> host instance there so why re-create it? Let’s just reuse it.</p>
<p>This is pretty close to how React thinks about it.</p>
<p><strong>If an element type in the same place in the tree “matches up” between the previous and the next renders, React reuses the existing host instance.</strong></p>
<p>Here is an example with comments showing roughly what React does:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// let domNode = document.createElement('button');</span>
<span class=\\"token comment\\">// domNode.className = 'blue';</span>
<span class=\\"token comment\\">// domContainer.appendChild(domNode);</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">className</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>blue<span class=\\"token punctuation\\">\\"</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span>
  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">// Can reuse host instance? Yes! (button → button)</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">// domNode.className = 'red';</span></span>ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">className</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>red<span class=\\"token punctuation\\">\\"</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span>
  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">// Can reuse host instance? No! (button → p)</span></span><span class=\\"token comment\\">// domContainer.removeChild(domNode);</span>
<span class=\\"token comment\\">// domNode = document.createElement('p');</span>
<span class=\\"token comment\\">// domNode.textContent = 'Hello';</span>
<span class=\\"token comment\\">// domContainer.appendChild(domNode);</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">,</span>
  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">// Can reuse host instance? Yes! (p → p)</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">// domNode.textContent = 'Goodbye';</span></span>ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Goodbye</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">,</span>
  document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The same heuristic is used for child trees. For example, when we update a <code class=\\"language-text\\">&lt;dialog&gt;</code> with two <code class=\\"language-text\\">&lt;button&gt;</code>s inside, React first decides whether to re-use the <code class=\\"language-text\\">&lt;dialog&gt;</code>, and then repeats this decision procedure for each child.</p>
<h2 id=\\"conditions\\"><a href=\\"#conditions\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Conditions</h2>
<p>If React only reuses host instances when the element types “match up” between updates, how can we render conditional content?</p>
<p>Say we want to first show only an input, but later render a message before it:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// First render</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>dialog</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">  </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>dialog</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">,</span>
  domContainer
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token comment\\">// Next render</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>dialog</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">I was just added here!</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">  </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>dialog</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">,</span>
  domContainer
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In this example, the <code class=\\"language-text\\">&lt;input&gt;</code> host instance would get re-created. React would walk the element tree, comparing it with the previous version:</p>
<ul>
<li>
<p><code class=\\"language-text\\">dialog → dialog</code>: Can reuse the host instance? <strong>Yes — the type matches.</strong></p>
<ul>
<li><code class=\\"language-text\\">input → p</code>: Can reuse the host instance? <strong>No, the type has changed!</strong> Need to remove the existing <code class=\\"language-text\\">input</code> and create a new <code class=\\"language-text\\">p</code> host instance.</li>
<li><code class=\\"language-text\\">(nothing) → input</code>: Need to create a new <code class=\\"language-text\\">input</code> host instance.</li>
</ul>
</li>
</ul>
<p>So effectively the update code executed by React would be like:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">let</span> oldInputNode <span class=\\"token operator\\">=</span> dialogNode<span class=\\"token punctuation\\">.</span>firstChild<span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">dialogNode<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeChild</span><span class=\\"token punctuation\\">(</span>oldInputNode<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
<span class=\\"token keyword\\">let</span> pNode <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'p'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
pNode<span class=\\"token punctuation\\">.</span>textContent <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'I was just added here!'</span><span class=\\"token punctuation\\">;</span>
dialogNode<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>pNode<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">let</span> newInputNode <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'input'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">dialogNode<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>newInputNode<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>This is not great because <em>conceptually</em> the <code class=\\"language-text\\">&lt;input&gt;</code> hasn’t been <em>replaced</em> with <code class=\\"language-text\\">&lt;p&gt;</code> — it just moved. We don’t want to lose its selection, focus state, and content due to re-creating the DOM.</p>
<p>While this problem has an easy fix (which we’ll get to in a minute), it doesn’t occur often in the React applications. It’s interesting to see why.</p>
<p>In practice, you would rarely call <code class=\\"language-text\\">ReactDOM.render</code> directly. Instead, React apps tend to be broken down into functions like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> showMessage <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> message <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>showMessage<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    message <span class=\\"token operator\\">=</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">I was just added here!</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>dialog</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token punctuation\\">{</span>message<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>dialog</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This example doesn’t suffer from the problem we just described. It might be easier to see why if we use object notation instead of JSX. Look at the <code class=\\"language-text\\">dialog</code> child element tree:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> showMessage <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> message <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>showMessage<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    message <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
      type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'p'</span><span class=\\"token punctuation\\">,</span>
      props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span> children<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'I was just added here!'</span> <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">{</span>
    type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'dialog'</span><span class=\\"token punctuation\\">,</span>
    props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">      children<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span></span><span class=\\"gatsby-highlight-code-line\\">        message<span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token punctuation\\">{</span> type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'input'</span><span class=\\"token punctuation\\">,</span> props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span> <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token punctuation\\">]</span></span>    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><strong>Regardless of whether <code class=\\"language-text\\">showMessage</code> is <code class=\\"language-text\\">true</code> or <code class=\\"language-text\\">false</code>, the <code class=\\"language-text\\">&lt;input&gt;</code> is the second child and doesn’t change its tree position between renders.</strong></p>
<p>If <code class=\\"language-text\\">showMessage</code> changes from <code class=\\"language-text\\">false</code> to <code class=\\"language-text\\">true</code>, React would walk the element tree, comparing it with the previous version:</p>
<ul>
<li>
<p><code class=\\"language-text\\">dialog → dialog</code>: Can reuse the host instance? <strong>Yes — the type matches.</strong></p>
<ul>
<li><code class=\\"language-text\\">(null) → p</code>: Need to insert a new <code class=\\"language-text\\">p</code> host instance.</li>
<li><code class=\\"language-text\\">input → input</code>: Can reuse the host instance? <strong>Yes — the type matches.</strong></li>
</ul>
</li>
</ul>
<p>And the code executed by React would be similar to this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> inputNode <span class=\\"token operator\\">=</span> dialogNode<span class=\\"token punctuation\\">.</span>firstChild<span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">let</span> pNode <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'p'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
pNode<span class=\\"token punctuation\\">.</span>textContent <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'I was just added here!'</span><span class=\\"token punctuation\\">;</span>
dialogNode<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">insertBefore</span><span class=\\"token punctuation\\">(</span>pNode<span class=\\"token punctuation\\">,</span> inputNode<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>No input state is lost now.</p>
<h2 id=\\"lists\\"><a href=\\"#lists\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Lists</h2>
<p>Comparing the element type at the same position in the tree is usually enough to decide whether to reuse or re-create the corresponding host instance.</p>
<p>But this only works well if child positions are static and don’t re-order. In our example above, even though <code class=\\"language-text\\">message</code> could be a “hole”, we still knew that the input goes after the message, and there are no other children.</p>
<p>With dynamic lists, we can’t be sure the order is ever the same:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">ShoppingList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> list <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>form</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token punctuation\\">{</span>list<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span>item <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">(</span>
        <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
          You bought </span><span class=\\"token punctuation\\">{</span>item<span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
          </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>br</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
          Enter how many do you want: </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
        </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span>
      <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>form</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>If the <code class=\\"language-text\\">list</code> of our shopping items is ever re-ordered, React will see that all <code class=\\"language-text\\">p</code> and <code class=\\"language-text\\">input</code> elements inside have the same type, and won’t know to move them. (From React’s point of view, the <em>items themselves</em> changed, not their order.)</p>
<p>The code executed by React to re-order 10 items would be something like:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">for</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">let</span> i <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span> i <span class=\\"token operator\\">&lt;</span> <span class=\\"token number\\">10</span><span class=\\"token punctuation\\">;</span> i<span class=\\"token operator\\">++</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> pNode <span class=\\"token operator\\">=</span> formNode<span class=\\"token punctuation\\">.</span>childNodes<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">let</span> textNode <span class=\\"token operator\\">=</span> pNode<span class=\\"token punctuation\\">.</span>firstChild<span class=\\"token punctuation\\">;</span>
  textNode<span class=\\"token punctuation\\">.</span>textContent <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'You bought '</span> <span class=\\"token operator\\">+</span> items<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>So instead of <em>re-ordering</em> them, React would effectively <em>update</em> each of them. This can create performance issues and possible bugs. For example, the content of the first input would stay reflected in first input <em>after</em> the sort — even though conceptually they might refer to different products in your shopping list!</p>
<p><strong>This is why React nags you to specify a special property called <code class=\\"language-text\\">key</code> every time you include an array of elements in your output:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">ShoppingList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> list <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>form</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span>list<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span>item <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">(</span>
<span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span> <span class=\\"token attr-name\\">key</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>item<span class=\\"token punctuation\\">.</span>productId<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">          You bought </span><span class=\\"token punctuation\\">{</span>item<span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">          </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>br</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">          Enter how many do you want: </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span>
      <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>form</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>A <code class=\\"language-text\\">key</code> tells React that it should consider an item to be <em>conceptually</em> the same even if it has different <em>positions</em> inside its parent element between renders.</p>
<p>When React sees <code class=\\"language-text\\">&lt;p key=&quot;42&quot;&gt;</code> inside a <code class=\\"language-text\\">&lt;form&gt;</code>, it will check if the previous render also contained <code class=\\"language-text\\">&lt;p key=&quot;42&quot;&gt;</code> inside the same <code class=\\"language-text\\">&lt;form&gt;</code>. This works even if <code class=\\"language-text\\">&lt;form&gt;</code> children changed their order. React will reuse the previous host instance with the same key if it exists, and re-order the siblings accordingly.</p>
<p>Note that the <code class=\\"language-text\\">key</code> is only relevant within a particular parent React element, such as a <code class=\\"language-text\\">&lt;form&gt;</code>. React won’t try to “match up” elements with the same keys between different parents. (React doesn’t have idiomatic support for moving a host instance between different parents without re-creating it.)</p>
<p>What’s a good value for a <code class=\\"language-text\\">key</code>? An easy way to answer this is to ask: <strong>when would <em>you</em> say an item is the “same” even if the order changed?</strong> For example, in our shopping list, the product ID uniquely identifies it between siblings.</p>
<h2 id=\\"components\\"><a href=\\"#components\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Components</h2>
<p>We’ve already seen functions that return React elements:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> showMessage <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> message <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>showMessage<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    message <span class=\\"token operator\\">=</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">I was just added here!</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>dialog</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token punctuation\\">{</span>message<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>dialog</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>They are called <em>components</em>. They let us create our own “toolbox” of buttons, avatars, comments, and so on. Components are the bread and butter of React.</p>
<p>Components take one argument — an object hash. It contains “props” (short for “properties”). Here, <code class=\\"language-text\\">showMessage</code> is a prop. They’re like named arguments.</p>
<h2 id=\\"purity\\"><a href=\\"#purity\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Purity</h2>
<p>React components are assumed to be pure with respect to their props.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Button</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// 🔴 Doesn't work</span>
  props<span class=\\"token punctuation\\">.</span>isActive <span class=\\"token operator\\">=</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>In general, mutation is not idiomatic in React. (We’ll talk more about the idiomatic way to update the UI in response to events later.)</p>
<p>However, <em>local mutation</em> is absolutely fine:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">FriendList</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> friends <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">let</span> items <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">for</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">let</span> i <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span> i <span class=\\"token operator\\">&lt;</span> friends<span class=\\"token punctuation\\">.</span>length<span class=\\"token punctuation\\">;</span> i<span class=\\"token operator\\">++</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">let</span> friend <span class=\\"token operator\\">=</span> friends<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">    items<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span></span>      <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Friend</span> <span class=\\"token attr-name\\">key</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">.</span>id<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">friend</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span>
    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>section</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">{</span>items<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>section</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>We created <code class=\\"language-text\\">items</code> <em>while rendering</em> and no other component “saw” it so we can mutate it as much as we like before handing it off as part of the render result. There is no need to contort your code to avoid local mutation.</p>
<p>Similarly, lazy initialization is fine despite not being fully “pure”:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">ExpenseForm</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Fine if it doesn't affect other components:</span>
  SuperCalculator<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">initializeIfNotReady</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Continue rendering...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>As long as calling a component multiple times is safe and doesn’t affect the rendering of other components, React doesn’t care if it’s 100% pure in the strict FP sense of the word. <a href=\\"https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Idempotence</a> is more important to React than purity.</p>
<p>That said, side effects that are directly visible to the user are not allowed in React components. In other words, merely <em>calling</em> a component function shouldn’t by itself produce a change on the screen.</p>
<h2 id=\\"recursion\\"><a href=\\"#recursion\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Recursion</h2>
<p>How do we <em>use</em> components from other components? Components are functions so we <em>could</em> call them:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> reactElement <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> showMessage<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>reactElement<span class=\\"token punctuation\\">,</span> domContainer<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>However, this is <em>not</em> the idiomatic way to use components in the React runtime.</p>
<p>Instead, the idiomatic way to use a component is with the same mechanism we’ve already seen before — React elements. <strong>This means that you don’t directly call the component function, but instead let React later do it for you</strong>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// { type: Form, props: { showMessage: true } }</span>
<span class=\\"token keyword\\">let</span> reactElement <span class=\\"token operator\\">=</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Form</span> <span class=\\"token attr-name\\">showMessage</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">;</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>reactElement<span class=\\"token punctuation\\">,</span> domContainer<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>And somewhere inside React, your component will be called:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Somewhere inside React</span>
<span class=\\"token keyword\\">let</span> type <span class=\\"token operator\\">=</span> reactElement<span class=\\"token punctuation\\">.</span>type<span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Form</span>
<span class=\\"token keyword\\">let</span> props <span class=\\"token operator\\">=</span> reactElement<span class=\\"token punctuation\\">.</span>props<span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// { showMessage: true }</span>
<span class=\\"token keyword\\">let</span> result <span class=\\"token operator\\">=</span> <span class=\\"token function\\">type</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Whatever Form returns</span></code></pre></div>
<p>Component function names are by convention capitalized. When the JSX transform sees <code class=\\"language-text\\">&lt;Form&gt;</code> rather than <code class=\\"language-text\\">&lt;form&gt;</code>, it makes the object <code class=\\"language-text\\">type</code> itself an identifier rather than a string:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>form</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">.</span>type<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 'form' string</span>
console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Form</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">.</span>type<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Form function</span></code></pre></div>
<p>There is no global registration mechanism — we literally refer to <code class=\\"language-text\\">Form</code> by name when typing <code class=\\"language-text\\">&lt;Form /&gt;</code>. If <code class=\\"language-text\\">Form</code> doesn’t exist in local scope, you’ll see a JavaScript error just like you normally would with a bad variable name.</p>
<p><strong>Okay, so what does React do when an element type is a function? It calls your component, and asks what element <em>that</em> component wants to render.</strong></p>
<p>This process continues recursively and is described in more detail <a href=\\"https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>. In short, it looks like this:</p>
<ul>
<li><strong>You:</strong> <code class=\\"language-text\\">ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>
<li>
<p><strong>React:</strong> Hey <code class=\\"language-text\\">App</code>, what do you render to?</p>
<ul>
<li><code class=\\"language-text\\">App</code>: I render <code class=\\"language-text\\">&lt;Layout&gt;</code> with <code class=\\"language-text\\">&lt;Content&gt;</code> inside.</li>
</ul>
</li>
<li>
<p><strong>React:</strong> Hey <code class=\\"language-text\\">Layout</code>, what do you render to?</p>
<ul>
<li><code class=\\"language-text\\">Layout</code>: I render my children in a <code class=\\"language-text\\">&lt;div&gt;</code>. My child was <code class=\\"language-text\\">&lt;Content&gt;</code> so I guess that goes into the <code class=\\"language-text\\">&lt;div&gt;</code>.</li>
</ul>
</li>
<li>
<p><strong>React:</strong> Hey <code class=\\"language-text\\">&lt;Content&gt;</code>, what do you render to?</p>
<ul>
<li><code class=\\"language-text\\">Content</code>: I render an <code class=\\"language-text\\">&lt;article&gt;</code> with some text and a <code class=\\"language-text\\">&lt;Footer&gt;</code> inside.</li>
</ul>
</li>
<li>
<p><strong>React:</strong> Hey <code class=\\"language-text\\">&lt;Footer&gt;</code>, what do you render to?</p>
<ul>
<li><code class=\\"language-text\\">Footer</code>: I render a <code class=\\"language-text\\">&lt;footer&gt;</code> with some more text.</li>
</ul>
</li>
<li><strong>React:</strong> Okay, here you go:</li>
</ul>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Resulting DOM structure</span>
<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>div</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
  </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>article</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
    Some text
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>footer</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">some more text</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>footer</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
  </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>article</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>div</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>This is why we say reconciliation is recursive. When React walks the element tree, it might meet an element whose <code class=\\"language-text\\">type</code> is a component. It will call it and keep descending down the tree of returned React elements. Eventually, we’ll run out of components, and React will know what to change in the host tree.</p>
<p>The same reconciliation rules we already discussed apply here too. If the <code class=\\"language-text\\">type</code> at the same position (as determined by index and optional <code class=\\"language-text\\">key</code>) changes, React will throw away the host instances inside, and re-create them.</p>
<h2 id=\\"inversion-of-control\\"><a href=\\"#inversion-of-control\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Inversion of Control</h2>
<p>You might be wondering: why don’t we just call components directly? Why write <code class=\\"language-text\\">&lt;Form /&gt;</code> rather than <code class=\\"language-text\\">Form()</code>?</p>
<p><strong>React can do its job better if it “knows” about your components rather than if it only sees the React element tree after recursively calling them.</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// 🔴 React has no idea Layout and Article exist.</span>
<span class=\\"token comment\\">// You're calling them.</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token function\\">Layout</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> children<span class=\\"token punctuation\\">:</span> <span class=\\"token function\\">Article</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  domContainer
<span class=\\"token punctuation\\">)</span>

<span class=\\"token comment\\">// ✅ React knows Layout and Article exist.</span>
<span class=\\"token comment\\">// React calls them.</span>
ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Layout</span><span class=\\"token punctuation\\">></span></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Article</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>Layout</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">,</span>
  domContainer
<span class=\\"token punctuation\\">)</span></code></pre></div>
<p>This is a classic example of <a href=\\"https://en.wikipedia.org/wiki/Inversion_of_control\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">inversion of control</a>. There’s a few interesting properties we get by letting React take control of calling our components:</p>
<ul>
<li>
<p><strong>Components become more than functions.</strong> React can augment component functions with features like <em>local state</em> that are tied to the component identity in the tree. A good runtime provides fundamental abstractions that match the problem at hand. As we already mentioned, React is oriented specifically at programs that render UI trees and respond to interactions. If you called components directly, you’d have to build these features yourself.</p>
</li>
<li>
<p><strong>Component types participate in the reconciliation.</strong> By letting React call your components, you also tell it more about the conceptual structure of your tree. For example, when you move from rendering <code class=\\"language-text\\">&lt;Feed&gt;</code> to the <code class=\\"language-text\\">&lt;Profile&gt;</code> page, React won’t attempt to re-use host instances inside them — just like when you replace <code class=\\"language-text\\">&lt;button&gt;</code> with a <code class=\\"language-text\\">&lt;p&gt;</code>. All state will be gone — which is usually good when you render a conceptually different view. You wouldn’t want to preserve input state between <code class=\\"language-text\\">&lt;PasswordForm&gt;</code> and <code class=\\"language-text\\">&lt;MessengerChat&gt;</code> even if the <code class=\\"language-text\\">&lt;input&gt;</code> position in the tree accidentally “lines up” between them.</p>
</li>
<li>
<p><strong>React can delay the reconciliation.</strong> If React takes control over calling our components, it can do many interesting things. For example, it can let the browser do some work between the component calls so that re-rendering a large component tree <a href=\\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">doesn’t block the main thread</a>. Orchestrating this manually without reimplementing a large part of React is difficult.</p>
</li>
<li>
<p><strong>A better debugging story.</strong> If components are first-class citizens that the library is aware of, we can build <a href=\\"https://github.com/facebook/react-devtools\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">rich developer tools</a> for introspection in development.</p>
</li>
</ul>
<p>The last benefit to React calling your component functions is <em>lazy evaluation</em>. Let’s see what this means.</p>
<h2 id=\\"lazy-evaluation\\"><a href=\\"#lazy-evaluation\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Lazy Evaluation</h2>
<p>When we call functions in JavaScript, arguments are evaluated before the call:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// (2) This gets computed second</span>
<span class=\\"token function\\">eat</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token comment\\">// (1) This gets computed first</span>
  <span class=\\"token function\\">prepareMeal</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This is usually what JavaScript developers expect because JavaScript functions can have implicit side effects. It would be surprising if we called a function, but it wouldn’t execute until its result gets somehow “used” in JavaScript.</p>
<p>However, React components are <a href=\\"#purity\\">relatively</a> pure. There is absolutely no need to execute it if we know its result won’t get rendered on the screen.</p>
<p>Consider this component putting <code class=\\"language-text\\">&lt;Comments&gt;</code> inside a <code class=\\"language-text\\">&lt;Page&gt;</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Story</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> currentUser <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// return {</span>
  <span class=\\"token comment\\">//   type: Page,</span>
  <span class=\\"token comment\\">//   props: {</span>
  <span class=\\"token comment\\">//     user: currentUser,</span>
  <span class=\\"token comment\\">//     children: { type: Comments, props: {} }</span>
  <span class=\\"token comment\\">//   }</span>
  <span class=\\"token comment\\">// }</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Page</span> <span class=\\"token attr-name\\">user</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>currentUser<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Comments</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>Page</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The <code class=\\"language-text\\">Page</code> component can render the children given to it inside some <code class=\\"language-text\\">Layout</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Page</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> user<span class=\\"token punctuation\\">,</span> children <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Layout</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span>children<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>Layout</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><em>(<code class=\\"language-text\\">&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> in JSX is the same as <code class=\\"language-text\\">&lt;A children={&lt;B /&gt;} /&gt;</code>.)</em></p>
<p>But what if it has an early exit condition?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Page</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> user<span class=\\"token punctuation\\">,</span> children <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>user<span class=\\"token punctuation\\">.</span>isLoggedIn<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Please log in</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span>  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Layout</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span>children<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>Layout</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>If we called <code class=\\"language-text\\">Comments()</code> as a function, it would execute immediately regardless of whether <code class=\\"language-text\\">Page</code> wants to render them or not:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// {</span>
<span class=\\"token comment\\">//   type: Page,</span>
<span class=\\"token comment\\">//   props: {</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">//     children: Comments() // Always runs!</span></span><span class=\\"token comment\\">//   }</span>
<span class=\\"token comment\\">// }</span>
<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Page</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">  </span><span class=\\"token punctuation\\">{</span><span class=\\"token function\\">Comments</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\"></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>Page</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>But if we pass a React element, we don’t execute <code class=\\"language-text\\">Comments</code> ourselves at all:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// {</span>
<span class=\\"token comment\\">//   type: Page,</span>
<span class=\\"token comment\\">//   props: {</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">//     children: { type: Comments }</span></span><span class=\\"token comment\\">//   }</span>
<span class=\\"token comment\\">// }</span>
<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Page</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">  </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Comments</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\"></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>Page</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>This lets React decide when and <em>whether</em> to call it. If our <code class=\\"language-text\\">Page</code> component ignores its <code class=\\"language-text\\">children</code> prop and renders
<code class=\\"language-text\\">&lt;h1&gt;Please log in&lt;/h1&gt;</code> instead, React won’t even attempt to call the <code class=\\"language-text\\">Comments</code> function. What’s the point?</p>
<p>This is good because it both lets us avoid unnecessary rendering work that would be thrown away, and makes the code less fragile. (We don’t care if <code class=\\"language-text\\">Comments</code> throws or not when the user is logged out — it won’t be called.)</p>
<h2 id=\\"state\\"><a href=\\"#state\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>State</h2>
<p>We talked <a href=\\"#reconciliation\\">earlier</a> about identity and how an element’s conceptual “position” in the tree tells React whether to re-use a host instance or create a new one. Host instances can have all kinds of local state: focus, selection, input, etc. We want to preserve this state between updates that conceptually render the same UI. We also want to predictably destroy it when we render something conceptually different (such as moving from <code class=\\"language-text\\">&lt;SignupForm&gt;</code> to <code class=\\"language-text\\">&lt;MessengerChat&gt;</code>).</p>
<p><strong>Local state is so useful that React lets <em>your own</em> components have it too.</strong> Components are still functions but React augments them with features that are useful for UIs. Local state tied to the position in the tree is one of these features.</p>
<p>We call these features <em>Hooks</em>. For example, <code class=\\"language-text\\">useState</code> is a Hook.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Example</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>div</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">You clicked </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"> times</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">        Click me</span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>div</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>It returns a pair of values: the current state and a function that updates it.</p>
<p>The <a href=\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">array destructuring</a> syntax lets us give arbitrary names to our state variables. For example, I called this pair <code class=\\"language-text\\">count</code> and <code class=\\"language-text\\">setCount</code>, but it could’ve been <code class=\\"language-text\\">banana</code> and <code class=\\"language-text\\">setBanana</code>. In the text below, I will use <code class=\\"language-text\\">setState</code> to refer to the second value regardless of its actual name in the specific examples.</p>
<p><em>(You can learn more about <code class=\\"language-text\\">useState</code> and other Hooks provided by React <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>.)</em></p>
<h2 id=\\"consistency\\"><a href=\\"#consistency\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Consistency</h2>
<p>Even if we want to split the reconciliation process itself into <a href=\\"https://www.youtube.com/watch?v=mDdgfyRB5kg\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">non-blocking</a> chunks of work, we should still perform the actual host tree operations in a single synchronous swoop. This way we can ensure that the user doesn’t see a half-updated UI, and that the browser doesn’t perform unnecessary layout and style recalculation for intermediate states that the user shouldn’t see.</p>
<p>This is why React splits all work into the “render phase” and the “commit phase”. <em>Render phase</em> is when React calls your components and performs reconciliation. It is safe to interrupt and <a href=\\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">in the future</a> will be asynchronous. <em>Commit phase</em> is when React touches the host tree. It is always synchronous.</p>
<h2 id=\\"memoization\\"><a href=\\"#memoization\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Memoization</h2>
<p>When a parent schedules an update by calling <code class=\\"language-text\\">setState</code>, by default React reconciles its whole child subtree. This is because React can’t know whether an update in the parent would affect the child or not, and by default, React opts to be consistent. This may sound very expensive but in practice, it’s not a problem for small and medium-sized subtrees.</p>
<p>When trees get too deep or wide, you can tell React to <a href=\\"https://en.wikipedia.org/wiki/Memoization\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">memoize</a> a subtree and reuse previous render results during shallow equal prop changes:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Row</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> item <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">default</span> React<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">memo</span><span class=\\"token punctuation\\">(</span>Row<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>Now <code class=\\"language-text\\">setState</code> in a parent <code class=\\"language-text\\">&lt;Table&gt;</code> component would skip over reconciling <code class=\\"language-text\\">Row</code>s whose <code class=\\"language-text\\">item</code> is referentially equal to the <code class=\\"language-text\\">item</code> rendered last time.</p>
<p>You can get fine-grained memoization at the level of individual expressions with the <a href=\\"https://reactjs.org/docs/hooks-reference.html#usememo\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useMemo()</code> Hook</a>. The cache is local to component tree position and will be destroyed together with its local state. It only holds one last item.</p>
<p>React intentionally doesn’t memoize components by default. Many components always receive different props so memoizing them would be a net loss.</p>
<h2 id=\\"raw-models\\"><a href=\\"#raw-models\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Raw Models</h2>
<p>Ironically, React doesn’t use a “reactivity” system for fine-grained updates. In other words, any update at the top triggers reconciliation instead of updating just the components affected by changes.</p>
<p>This is an intentional design decision. <a href=\\"https://calibreapp.com/blog/time-to-interactive/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Time to interactive</a> is a crucial metric in consumer web applications, and traversing models to set up fine-grained listeners spends that precious time. Additionally, in many apps, interactions tend to result either in small (button hover) or large (page transition) updates, in which case fine-grained subscriptions are a waste of memory resources.</p>
<p>One of the core design principles of React is that it works with raw data. If you have a bunch of JavaScript objects received from the network, you can pump them directly into your components with no preprocessing. There are no gotchas about which properties you can access, or unexpected performance cliffs when a structure slightly changes. React rendering is O(<em>view size</em>) rather than O(<em>model size</em>), and you can significantly cut the <em>view size</em> with <a href=\\"https://react-window.now.sh/#/examples/list/fixed-size\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">windowing</a>.</p>
<p>There are some kinds of applications where fine-grained subscriptions are beneficial — such as stock tickers. This is a rare example of “everything constantly updating at the same time”. While imperative escape hatches can help optimize such code, React might not be the best fit for this use case. Still, you can implement your own fine-grained subscription system on top of React.</p>
<p><strong>Note that there are common performance issues that even fine-grained subscriptions and “reactivity” systems can’t solve.</strong> For example, rendering a <em>new</em> deep tree (which happens on every page transition) without blocking the browser. Change tracking doesn’t make it faster — it makes it slower because we have to do more work to set up subscriptions. Another problem is that we have to wait for data before we can start rendering the view. In React, we aim to solve both of these problems with <a href=\\"https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Concurrent Rendering</a>.</p>
<h2 id=\\"batching\\"><a href=\\"#batching\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Batching</h2>
<p>Several components may want to update state in response to the same event. This example is contrived but it illustrates a common pattern:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Parent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>div</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">      Parent clicked </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"> times</span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Child</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>div</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Child</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\">      Child clicked </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"> times</span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>When an event is dispatched, the child’s <code class=\\"language-text\\">onClick</code> fires first (triggering its <code class=\\"language-text\\">setState</code>). Then the parent calls <code class=\\"language-text\\">setState</code> in its own <code class=\\"language-text\\">onClick</code> handler.</p>
<p>If React immediately re-rendered components in response to <code class=\\"language-text\\">setState</code> calls, we’d end up rendering the child twice:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span> Entering React's browser click event handler <span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span>
<span class=\\"token function\\">Child</span> <span class=\\"token punctuation\\">(</span>onClick<span class=\\"token punctuation\\">)</span>
  <span class=\\"token operator\\">-</span> setState
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token operator\\">-</span> re<span class=\\"token operator\\">-</span>render Child <span class=\\"token comment\\">// 😞 unnecessary</span></span><span class=\\"token function\\">Parent</span> <span class=\\"token punctuation\\">(</span>onClick<span class=\\"token punctuation\\">)</span>
  <span class=\\"token operator\\">-</span> setState
  <span class=\\"token operator\\">-</span> re<span class=\\"token operator\\">-</span>render Parent
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token operator\\">-</span> re<span class=\\"token operator\\">-</span>render Child</span><span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span> Exiting React's browser click event handler <span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span></code></pre></div>
<p>The first <code class=\\"language-text\\">Child</code> render would be wasted. And we couldn’t make React skip rendering <code class=\\"language-text\\">Child</code> for the second time because the <code class=\\"language-text\\">Parent</code> might pass some different data to it based on its updated state.</p>
<p><strong>This is why React batches updates inside event handlers:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span> Entering React's browser click event handler <span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span>
<span class=\\"token function\\">Child</span> <span class=\\"token punctuation\\">(</span>onClick<span class=\\"token punctuation\\">)</span>
  <span class=\\"token operator\\">-</span> setState
<span class=\\"token function\\">Parent</span> <span class=\\"token punctuation\\">(</span>onClick<span class=\\"token punctuation\\">)</span>
  <span class=\\"token operator\\">-</span> setState
<span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span> Processing state updates                     <span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span>
  <span class=\\"token operator\\">-</span> re<span class=\\"token operator\\">-</span>render Parent
  <span class=\\"token operator\\">-</span> re<span class=\\"token operator\\">-</span>render Child
<span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span> Exiting React's browser click event handler  <span class=\\"token operator\\">**</span><span class=\\"token operator\\">*</span></code></pre></div>
<p>The <code class=\\"language-text\\">setState</code> calls in components wouldn’t immediately cause a re-render. Instead, React would execute all event handlers first, and then trigger a single re-render batching all of those updates together.</p>
<p>Batching is good for performance but can be surprising if you write code like:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCounter<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCounter</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleClick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>If we start with <code class=\\"language-text\\">count</code> set to <code class=\\"language-text\\">0</code>, these would just be three <code class=\\"language-text\\">setCount(1)</code> calls. To fix this, <code class=\\"language-text\\">setState</code> provides an overload that accepts an “updater” function:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCounter<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setCounter</span><span class=\\"token punctuation\\">(</span>c <span class=\\"token operator\\">=></span> c <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleClick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">increment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>React would put the updater functions in a queue, and later run them in sequence, resulting in a re-render with <code class=\\"language-text\\">count</code> set to <code class=\\"language-text\\">3</code>.</p>
<p>When state logic gets more complex than a few <code class=\\"language-text\\">setState</code> calls, I recommend expressing it as a local state reducer with the <a href=\\"https://reactjs.org/docs/hooks-reference.html#usereducer\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useReducer</code> Hook</a>. It’s like an evolution of this “updater” pattern where each update is given a name:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>counter<span class=\\"token punctuation\\">,</span> dispatch<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useReducer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>state<span class=\\"token punctuation\\">,</span> action<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>action <span class=\\"token operator\\">===</span> <span class=\\"token string\\">'increment'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">return</span> state <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">return</span> state<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleClick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">dispatch</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'increment'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">dispatch</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'increment'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">dispatch</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'increment'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The <code class=\\"language-text\\">action</code> argument can be anything, although an object is a common choice.</p>
<h2 id=\\"call-tree\\"><a href=\\"#call-tree\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Call Tree</h2>
<p>A programming language runtime usually has a <a href=\\"https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">call stack</a>. When a function <code class=\\"language-text\\">a()</code> calls <code class=\\"language-text\\">b()</code> which itself calls <code class=\\"language-text\\">c()</code>, somewhere in the JavaScript engine there’s a data structure like <code class=\\"language-text\\">[a, b, c]</code> that “keeps track” of where you are and what code to execute next. Once you exit out of <code class=\\"language-text\\">c</code>, its call stack frame is gone — poof! It’s not needed anymore. We jump back into <code class=\\"language-text\\">b</code>. By the time we exit <code class=\\"language-text\\">a</code>, the call stack is empty.</p>
<p>Of course, React itself runs in JavaScript and obeys JavaScript rules. But we can imagine that internally React has some kind of its own call stack to remember which component we are currently rendering, e.g. <code class=\\"language-text\\">[App, Page, Layout, Article /* we&#39;re here */]</code>.</p>
<p>React is different from a general purpose language runtime because it’s aimed at rendering UI trees. These trees need to “stay alive” for us to interact with them. The DOM doesn’t disappear after our first <code class=\\"language-text\\">ReactDOM.render()</code> call.</p>
<p>This may be stretching the metaphor but I like to think of React components as being in a “call tree” rather than just a “call stack”. When we go “out” of the <code class=\\"language-text\\">Article</code> component, its React “call tree” frame doesn’t get destroyed. We need to keep the local state and references to the host instances <a href=\\"https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">somewhere</a>.</p>
<p>These “call tree” frames <em>are</em> destroyed along with their local state and host instances, but only when the <a href=\\"#reconciliation\\">reconciliation</a> rules say it’s necessary. If you ever read React source, you might have seen these frames being referred to as <a href=\\"https://en.wikipedia.org/wiki/Fiber_(computer_science)\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Fibers</a>.</p>
<p>Fibers are where the local state actually lives. When the state is updated, React marks the Fibers below as needing reconciliation, and calls those components.</p>
<h2 id=\\"context\\"><a href=\\"#context\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Context</h2>
<p>In React, we pass things down to other components as props. Sometimes, the majority of components need the same thing — for example, the currently chosen visual theme. It gets cumbersome to pass it down through every level.</p>
<p>In React, this is solved by <a href=\\"https://reactjs.org/docs/context.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Context</a>. It is essentially like <a href=\\"http://wiki.c2.com/?DynamicScoping\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">dynamic scoping</a> for components. It’s like a wormhole that lets you put something on the top, and have every child at the bottom be able to read it and re-render when it changes.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">const</span> ThemeContext <span class=\\"token operator\\">=</span> React<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createContext</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token string\\">'light'</span> <span class=\\"token comment\\">// Default value as a fallback</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">DarkApp</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>ThemeContext.Provider</span> <span class=\\"token attr-name\\">value</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>dark<span class=\\"token punctuation\\">\\"</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>MyComponents</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>ThemeContext.Provider</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">SomeDeeplyNestedChild</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Depends on where the child is rendered</span>
  <span class=\\"token keyword\\">const</span> theme <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useContext</span><span class=\\"token punctuation\\">(</span>ThemeContext<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>When <code class=\\"language-text\\">SomeDeeplyNestedChild</code> renders, <code class=\\"language-text\\">useContext(ThemeContext)</code> will look for the closest <code class=\\"language-text\\">&lt;ThemeContext.Provider&gt;</code> above it in the tree, and use its <code class=\\"language-text\\">value</code>.</p>
<p>(In practice, React maintains a context stack while it renders.)</p>
<p>If there’s no <code class=\\"language-text\\">ThemeContext.Provider</code> above, the result of <code class=\\"language-text\\">useContext(ThemeContext)</code> call will be the default value specified in the <code class=\\"language-text\\">createContext()</code> call. In our example, it is <code class=\\"language-text\\">&#39;light&#39;</code>.</p>
<h2 id=\\"effects\\"><a href=\\"#effects\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Effects</h2>
<p>We mentioned earlier that React components shouldn’t have observable side effects during rendering. But side effects are sometimes necessary. We may want to manage focus, draw on a canvas, subscribe to a data source, and so on.</p>
<p>In React, this is done by declaring an effect:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Example</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    document<span class=\\"token punctuation\\">.</span>title <span class=\\"token operator\\">=</span> <span class=\\"token template-string\\"><span class=\\"token string\\">\`You clicked </span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>count<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\"> times\`</span></span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>div</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">You clicked </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"> times</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        Click me</span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>div</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>When possible, React defers executing effects until after the browser re-paints the screen. This is good because code like data source subscriptions shouldn’t hurt <a href=\\"https://calibreapp.com/blog/time-to-interactive/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">time to interactive</a> and <a href=\\"https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">time to first paint</a>. (There’s a <a href=\\"https://reactjs.org/docs/hooks-reference.html#uselayouteffect\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">rarely used</a> Hook that lets you opt out of that behavior and do things synchronously. Avoid it.)</p>
<p>Effects don’t just run once. They run both after a component is shown to the user for the first time, and after it updates. Effects can close over current props and state, such as with <code class=\\"language-text\\">count</code> in the above example.</p>
<p>Effects may require cleanup, such as in case of subscriptions. To clean up after itself, an effect can return a function:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    DataSource<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addSubscription</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> DataSource<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeSubscription</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>React will execute the returned function before applying this effect the next time, and also before the component is destroyed.</p>
<p>Sometimes, re-running the effect on every render can be undesirable. You can tell React to <a href=\\"https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">skip</a> applying an effect if certain variables didn’t change:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    document<span class=\\"token punctuation\\">.</span>title <span class=\\"token operator\\">=</span> <span class=\\"token template-string\\"><span class=\\"token string\\">\`You clicked </span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>count<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\"> times\`</span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>However, it is often a premature optimization and can lead to problems if you’re not familiar with how JavaScript closures work.</p>
<p>For example, this code is buggy:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    DataSource<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addSubscription</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> DataSource<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeSubscription</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>It is buggy because <code class=\\"language-text\\">[]</code> says “don’t ever re-execute this effect”. But the effect closes over <code class=\\"language-text\\">handleChange</code> which is defined outside of it. And <code class=\\"language-text\\">handleChange</code> might reference any props or state:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleChange</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>count<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>If we never let the effect re-run, <code class=\\"language-text\\">handleChange</code> will keep pointing at the version from the first render, and <code class=\\"language-text\\">count</code> will always be <code class=\\"language-text\\">0</code> inside of it.</p>
<p>To solve this, make sure that if you specify the dependency array, it includes <strong>all</strong> things that can change, including the functions:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    DataSource<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addSubscription</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> DataSource<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeSubscription</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>handleChange<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>Depending on your code, you might still see unnecessary resubscriptions because <code class=\\"language-text\\">handleChange</code> itself is different on every render. The <a href=\\"https://reactjs.org/docs/hooks-reference.html#usecallback\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useCallback</code></a> Hook can help you with that. Alternatively, you can just let it re-subscribe. For example, browser’s <code class=\\"language-text\\">addEventListener</code> API is extremely fast, and jumping through hoops to avoid calling it might cause more problems than it’s worth.</p>
<p><em>(You can learn more about <code class=\\"language-text\\">useEffect</code> and other Hooks provided by React <a href=\\"https://reactjs.org/docs/hooks-effect.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>.)</em></p>
<h2 id=\\"custom-hooks\\"><a href=\\"#custom-hooks\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Custom Hooks</h2>
<p>Since Hooks like <code class=\\"language-text\\">useState</code> and <code class=\\"language-text\\">useEffect</code> are function calls, we can compose them into our own Hooks:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">MyResponsiveComponent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Our custom Hook</span></span>  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Window width is </span><span class=\\"token punctuation\\">{</span>width<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleResize</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setWidth</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handleResize<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handleResize<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> width<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Custom Hooks let different components share reusable stateful logic. Note that the <em>state itself</em> is not shared. Each call to a Hook declares its own isolated state.</p>
<p><em>(You can learn more about writing your own Hooks <a href=\\"https://reactjs.org/docs/hooks-custom.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>.)</em></p>
<h2 id=\\"static-use-order\\"><a href=\\"#static-use-order\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Static Use Order</h2>
<p>You can think of <code class=\\"language-text\\">useState</code> as a syntax for defining a “React state variable”. It’s not <em>really</em> a syntax, of course. We’re still writing JavaScript. But we are looking at React as a runtime environment, and because React tailors JavaScript to describing UI trees, its features sometimes live closer to the language space.</p>
<p>If <code class=\\"language-text\\">use</code> <em>were</em> a syntax, it would make sense for it to be at the top level:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// 😉 Note: not a real syntax</span>
component <span class=\\"token function\\">Example</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> use <span class=\\"token function\\">State</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>div</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">You clicked </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"> times</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        Click me</span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>div</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>What would putting it into a condition or a callback or outside a component even mean?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// 😉 Note: not a real syntax</span>

<span class=\\"token comment\\">// This is local state... of what?</span>
<span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> use <span class=\\"token function\\">State</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

component <span class=\\"token function\\">Example</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>condition<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// What happens to it when condition is false?</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> use <span class=\\"token function\\">State</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleClick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// What happens to it when we leave a function?</span>
    <span class=\\"token comment\\">// How is this different from a variable?</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> use <span class=\\"token function\\">State</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>React state is local to the <em>component</em> and its identity in the tree. If <code class=\\"language-text\\">use</code> were a real syntax it would make sense to scope it to the top-level of a component too:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// 😉 Note: not a real syntax</span>
component <span class=\\"token function\\">Example</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Only valid here</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> use <span class=\\"token function\\">State</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>condition<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// This would be a syntax error</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> use <span class=\\"token function\\">State</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This is similar to how <code class=\\"language-text\\">import</code> only works at the top level of a module.</p>
<p><strong>Of course, <code class=\\"language-text\\">use</code> is not actually a syntax.</strong> (It wouldn’t bring much benefit and would create a lot of friction.)</p>
<p>However, React <em>does</em> expect that all calls to Hooks happen only at the top level of a component and unconditionally. These <a href=\\"https://reactjs.org/docs/hooks-rules.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Rules of Hooks</a> can be enforced with <a href=\\"https://www.npmjs.com/package/eslint-plugin-react-hooks\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">a linter plugin</a>. There have been heated arguments about this design choice but in practice, I haven’t seen it confusing people. I also wrote about why commonly proposed alternatives <a href=\\"https://overreacted.io/why-do-hooks-rely-on-call-order/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">don’t work</a>.</p>
<p>Internally, Hooks are implemented as <a href=\\"https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">linked lists</a>. When you call <code class=\\"language-text\\">useState</code>, we move the pointer to the next item. When we exit the component’s <a href=\\"#call-tree\\">“call tree” frame</a>, we save the resulting list there until the next render.</p>
<p><a href=\\"https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">This article</a> provides a simplified explanation for how Hooks work internally. Arrays might be an easier mental model than linked lists:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Pseudocode</span>
<span class=\\"token keyword\\">let</span> hooks<span class=\\"token punctuation\\">,</span> i<span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  i<span class=\\"token operator\\">++</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>hooks<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// Next renders</span>
    <span class=\\"token keyword\\">return</span> hooks<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// First render</span>
  hooks<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// Prepare to render</span>
i <span class=\\"token operator\\">=</span> <span class=\\"token operator\\">-</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">;</span>
hooks <span class=\\"token operator\\">=</span> fiber<span class=\\"token punctuation\\">.</span>hooks <span class=\\"token operator\\">||</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// Call the component</span>
<span class=\\"token function\\">YourComponent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// Remember the state of Hooks</span>
fiber<span class=\\"token punctuation\\">.</span>hooks <span class=\\"token operator\\">=</span> hooks<span class=\\"token punctuation\\">;</span></code></pre></div>
<p><em>(If you’re curious, the real code is <a href=\\"https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>.)</em></p>
<p>This is roughly how each <code class=\\"language-text\\">useState()</code> call gets the right state. As we’ve learned <a href=\\"#reconciliation\\">earlier</a>, “matching things up” isn’t new to React — reconciliation relies on the elements matching up between renders in a similar way.</p>
<h2 id=\\"whats-left-out\\"><a href=\\"#whats-left-out\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>What’s Left Out</h2>
<p>We’ve touched on pretty much all important aspects of the React runtime environment. If you finished this page, you probably know React in more detail than 90% of its users. And there’s nothing wrong with that!</p>
<p>There are some parts I left out — mostly because they’re unclear even to us. React doesn’t currently have a good story for multipass rendering, i.e. when the parent render needs information about the children. Also, the <a href=\\"https://reactjs.org/docs/error-boundaries.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">error handling API</a> doesn’t yet have a Hooks version. It’s possible that these two problems can be solved together. Concurrent Mode is not stable yet, and there are interesting questions about how Suspense fits into this picture. Maybe I’ll do a follow-up when they’re fleshed out and Suspense is ready for more than <a href=\\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">lazy loading</a>.</p>
<p><strong>I think it speaks to the success of React’s API that you can get very far without ever thinking about most of these topics.</strong> Good defaults like the reconciliation heuristics do the right thing in most cases. Warnings, like the <code class=\\"language-text\\">key</code> warning, nudge you when you risk shooting yourself in the foot.</p>
<p>If you’re a UI library nerd, I hope this post was somewhat entertaining and clarified how React works in more depth. Or maybe you decided React is too complicated and you’ll never look at it again. In either case, I’d love to hear from you on Twitter! Thank you for reading.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/react-as-a-ui-runtime/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Why Isn’t X a Hook?",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Just because we can, doesn’t mean we should.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-isnt-x-a-hook/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-isnt-x-a-hook/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Sat, 26 Jan 2019 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>Since the first alpha version of <a href=\\"https://reactjs.org/hooks\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">React Hooks</a> was released, there is a question that keeps coming up in discussions: “Why isn’t <em>&#x3C;some other API></em> a Hook?”</p>
<p>To remind you, here’s a few things that <em>are</em> Hooks:</p>
<ul>
<li><a href=\\"https://reactjs.org/docs/hooks-reference.html#usestate\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useState()</code></a> lets you declare a state variable.</li>
<li><a href=\\"https://reactjs.org/docs/hooks-reference.html#useeffect\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useEffect()</code></a> lets you declare a side effect.</li>
<li><a href=\\"https://reactjs.org/docs/hooks-reference.html#usecontext\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useContext()</code></a> lets you read some context.</li>
</ul>
<p>But there are some other APIs, like <code class=\\"language-text\\">React.memo()</code> and <code class=\\"language-text\\">&lt;Context.Provider&gt;</code>, that are <em>not</em> Hooks. Commonly proposed Hook versions of them would be <em>noncompositional</em> or <em>antimodular</em>. This article will help you understand why.</p>
<p><strong>Note: this post is a deep dive for folks who are interested in API discussions. You don’t need to think about any of this to be productive with React!</strong></p>
<hr>
<p>There are two important properties that we want React APIs to preserve:</p>
<ol>
<li>
<p><strong>Composition:</strong> <a href=\\"https://reactjs.org/docs/hooks-custom.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Custom Hooks</a> are largely the reason we’re excited about the Hooks API. We expect people to build their own Hooks very often, and we need to make sure Hooks written by different people <a href=\\"https://overreacted.io/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem\\">don’t conflict</a>. (Aren’t we all spoiled by how components compose cleanly and don’t break each other?)</p>
</li>
<li>
<p><strong>Debugging:</strong> We want the bugs to be <a href=\\"https://overreacted.io/the-bug-o-notation/\\">easy to find</a> as the application grows. One of React’s best features is that if you see something wrong rendered, you can walk up the tree until you find which component’s prop or state caused the mistake.</p>
</li>
</ol>
<p>These two constraints put together can tell us what can or <em>cannot</em> be a Hook. Let’s try a few examples.</p>
<hr>
<h2 id=\\"a-real-hook-usestate\\"><a href=\\"#a-real-hook-usestate\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>A Real Hook: <code class=\\"language-text\\">useState()</code></h2>
<h3 id=\\"composition\\"><a href=\\"#composition\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Composition</h3>
<p>Multiple custom Hooks each calling <code class=\\"language-text\\">useState()</code> don’t conflict:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useMyCustomHook1</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>value<span class=\\"token punctuation\\">,</span> setValue<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// What happens here, stays here.</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useMyCustomHook2</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>value<span class=\\"token punctuation\\">,</span> setValue<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// What happens here, stays here.</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">MyComponent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">useMyCustomHook1</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">useMyCustomHook2</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Adding a new unconditional <code class=\\"language-text\\">useState()</code> call is always safe. You don’t need to know anything about other Hooks used by a component to declare a new state variable. You also can’t break other state variables by updating one of them.</p>
<p><strong>Verdict:</strong> ✅ <code class=\\"language-text\\">useState()</code> doesn’t make custom Hooks fragile.</p>
<h3 id=\\"debugging\\"><a href=\\"#debugging\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Debugging</h3>
<p>Hooks are useful because you can pass values <em>between</em> Hooks:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">return</span> width<span class=\\"token punctuation\\">;</span></span><span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useTheme</span><span class=\\"token punctuation\\">(</span>isMobile<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Comment</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">const</span> isMobile <span class=\\"token operator\\">=</span> width <span class=\\"token operator\\">&lt;</span> <span class=\\"token constant\\">MOBILE_VIEWPORT</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> theme <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useTheme</span><span class=\\"token punctuation\\">(</span>isMobile<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>section</span> <span class=\\"token attr-name\\">className</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>theme<span class=\\"token punctuation\\">.</span>comment<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span><span class=\\"token comment\\">/* ... */</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>section</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>But what if we make a mistake? What’s the debugging story?</p>
<p>Let’s say the CSS class we get from <code class=\\"language-text\\">theme.comment</code> is wrong. How would we debug this? We can set a breakpoint or a few logs in the body of our component.</p>
<p>Maybe we’d see that <code class=\\"language-text\\">theme</code> is wrong but <code class=\\"language-text\\">width</code> and <code class=\\"language-text\\">isMobile</code> are correct. That would tell us the problem is inside <code class=\\"language-text\\">useTheme()</code>. Or perhaps we’d see that <code class=\\"language-text\\">width</code> itself is wrong. That would tell us to look into <code class=\\"language-text\\">useWindowWidth()</code>.</p>
<p><strong>A single look at the intermediate values tells us which of the Hooks at the top level contains the bug.</strong> We don’t need to look at <em>all</em> of their implementations.</p>
<p>Then we can “zoom in” on the one that has a bug, and repeat.</p>
<p>This becomes more important if the depth of custom Hook nesting increases. Imagine we have 3 levels of custom Hook nesting, each level using 3 different custom Hooks inside. The <a href=\\"https://overreacted.io/the-bug-o-notation/\\">difference</a> between looking for a bug in <strong>3 places</strong> versus potentially checking <strong>3 + 3×3 + 3×3×3 = 39 places</strong> is enormous. Luckily, <code class=\\"language-text\\">useState()</code> can’t magically “influence” other Hooks or components. A buggy value returned by it leaves a trail behind it, just like any variable. 🐛</p>
<p><strong>Verdict:</strong> ✅ <code class=\\"language-text\\">useState()</code> doesn’t obscure the cause-effect relationship in our code. We can follow the breadcrumbs directly to the bug.</p>
<hr>
<h2 id=\\"not-a-hook-usebailout\\"><a href=\\"#not-a-hook-usebailout\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Not a Hook: <code class=\\"language-text\\">useBailout()</code></h2>
<p>As an optimization, components using Hooks can bail out of re-rendering.</p>
<p>One way to do it is to put a <a href=\\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">React.memo()</code></a> wrapper around the whole component. It bails out of re-rendering if props are shallowly equal to what we had during the last render. This makes it similar to <code class=\\"language-text\\">PureComponent</code> in classes.</p>
<p><code class=\\"language-text\\">React.memo()</code> takes a component and returns a component:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Button</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">default</span> React<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">memo</span><span class=\\"token punctuation\\">(</span>Button<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p><strong>But why isn’t it just a Hook?</strong></p>
<p>Whether you call it <code class=\\"language-text\\">useShouldComponentUpdate()</code>, <code class=\\"language-text\\">usePure()</code>, <code class=\\"language-text\\">useSkipRender()</code>, or <code class=\\"language-text\\">useBailout()</code>, the proposal tends to look something like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Button</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> color <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ⚠️ Not a real API</span>
  <span class=\\"token function\\">useBailout</span><span class=\\"token punctuation\\">(</span>prevColor <span class=\\"token operator\\">=></span> prevColor <span class=\\"token operator\\">!==</span> color<span class=\\"token punctuation\\">,</span> color<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">className</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">'button-'</span> <span class=\\"token operator\\">+</span> color<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      OK
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>There are a few more variations (e.g. a simple <code class=\\"language-text\\">usePure()</code> marker) but in broad strokes they have the same flaws.</p>
<h3 id=\\"composition-1\\"><a href=\\"#composition-1\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Composition</h3>
<p>Let’s say we try to put <code class=\\"language-text\\">useBailout()</code> in two custom Hooks:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useFriendStatus</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>isOnline<span class=\\"token punctuation\\">,</span> setIsOnline<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// ⚠️ Not a real API</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useBailout</span><span class=\\"token punctuation\\">(</span>prevIsOnline <span class=\\"token operator\\">=></span> prevIsOnline <span class=\\"token operator\\">!==</span> isOnline<span class=\\"token punctuation\\">,</span> isOnline<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleStatusChange</span> <span class=\\"token operator\\">=</span> status <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setIsOnline</span><span class=\\"token punctuation\\">(</span>status<span class=\\"token punctuation\\">.</span>isOnline<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    ChatAPI<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">subscribe</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">,</span> handleStatusChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> ChatAPI<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">unsubscribe</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">,</span> handleStatusChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">return</span> isOnline<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// ⚠️ Not a real API</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">useBailout</span><span class=\\"token punctuation\\">(</span>prevWidth <span class=\\"token operator\\">=></span> prevWidth <span class=\\"token operator\\">!==</span> width<span class=\\"token punctuation\\">,</span> width<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleResize</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setWidth</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handleResize<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handleResize<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">return</span> width<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Now what happens if you use them both in the same component?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">ChatThread</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> friendID<span class=\\"token punctuation\\">,</span> isTyping <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> isOnline <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFriendStatus</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>ChatLayout</span> <span class=\\"token attr-name\\">width</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>width<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>FriendStatus</span> <span class=\\"token attr-name\\">isOnline</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>isOnline<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span>isTyping <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token string\\">'Typing...'</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>ChatLayout</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>When does it re-render?</p>
<p>If every <code class=\\"language-text\\">useBailout()</code> call has the power to skip an update, then updates from <code class=\\"language-text\\">useWindowWidth()</code> would be blocked by <code class=\\"language-text\\">useFriendStatus()</code>, and vice versa. <strong>These Hooks would break each other.</strong></p>
<p>However, if <code class=\\"language-text\\">useBailout()</code> was only respected when <em>all</em> calls to it inside a single component “agree” to block an update, our <code class=\\"language-text\\">ChatThread</code> would fail to update on changes to the <code class=\\"language-text\\">isTyping</code> prop.</p>
<p>Even worse, with these semantics <strong>any newly added Hooks to <code class=\\"language-text\\">ChatThread</code> would break if they don’t <em>also</em> call <code class=\\"language-text\\">useBailout()</code></strong>. Otherwise, they can’t “vote against” the bailout inside <code class=\\"language-text\\">useWindowWidth()</code> and <code class=\\"language-text\\">useFriendStatus()</code>.</p>
<p><strong>Verdict:</strong> 🔴 <code class=\\"language-text\\">useBailout()</code> breaks composition. Adding it to a Hook breaks state updates in other Hooks. We want the APIs to be <a href=\\"https://overreacted.io/optimized-for-change/\\">antifragile</a>, and this behavior is pretty much the opposite.</p>
<h3 id=\\"debugging-1\\"><a href=\\"#debugging-1\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Debugging</h3>
<p>How does a Hook like <code class=\\"language-text\\">useBailout()</code> affect debugging?</p>
<p>We’ll use the same example:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">ChatThread</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> friendID<span class=\\"token punctuation\\">,</span> isTyping <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> isOnline <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFriendStatus</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>ChatLayout</span> <span class=\\"token attr-name\\">width</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>width<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>FriendStatus</span> <span class=\\"token attr-name\\">isOnline</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>isOnline<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token punctuation\\">{</span>isTyping <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token string\\">'Typing...'</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>ChatLayout</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Let’s say the <code class=\\"language-text\\">Typing...</code> label doesn’t appear when we expect, even though somewhere many layers above the prop is changing. How do we debug it?</p>
<p><strong>Normally, in React you can confidently answer this question by looking <em>up</em>.</strong> If <code class=\\"language-text\\">ChatThread</code> doesn’t get a new <code class=\\"language-text\\">isTyping</code> value, we can open the component that renders <code class=\\"language-text\\">&lt;ChatThread isTyping={myVar} /&gt;</code> and check <code class=\\"language-text\\">myVar</code>, and so on. At one of these levels, we’ll either find a buggy <code class=\\"language-text\\">shouldComponentUpdate()</code> bailout, or an incorrect <code class=\\"language-text\\">isTyping</code> value being passed down. One look at each component in the chain is usually enough to locate the source of the problem.</p>
<p>However, if this <code class=\\"language-text\\">useBailout()</code> Hook was real, you would never know the reason an update was skipped until you checked <em>every single custom Hook</em> (deeply) used by our <code class=\\"language-text\\">ChatThread</code> and components in its owner chain. Since every parent component can <em>also</em> use custom Hooks, this <a href=\\"https://overreacted.io/the-bug-o-notation/\\">scales</a> terribly.</p>
<p>It’s like if you were looking for a screwdriver in a chest of drawers, and each drawer contained a bunch of smaller chests of drawers, and you don’t know how deep the rabbit hole goes.</p>
<p><strong>Verdict:</strong> 🔴 Not only <code class=\\"language-text\\">useBailout()</code> Hook breaks composition, but it also vastly increases the number of debugging steps and cognitive load for finding a buggy bailout — in some cases, exponentially.</p>
<hr>
<p>We just looked at one real Hook, <code class=\\"language-text\\">useState()</code>, and a common suggestion that is intentionally <em>not</em> a Hook — <code class=\\"language-text\\">useBailout()</code>. We compared them through the prism of Composition and Debugging, and discussed why one of them works and the other one doesn’t.</p>
<p>While there is no “Hook version” of <code class=\\"language-text\\">memo()</code> or <code class=\\"language-text\\">shouldComponentUpdate()</code>, React <em>does</em> provide a Hook called <a href=\\"https://reactjs.org/docs/hooks-reference.html#usememo\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">useMemo()</code></a>. It serves a similar purpose, but its semantics are different enough to not run into the pitfalls described above.</p>
<p><code class=\\"language-text\\">useBailout()</code> is just one example of something that doesn’t work well as a Hook. But there are a few others — for example, <code class=\\"language-text\\">useProvider()</code>, <code class=\\"language-text\\">useCatch()</code>, or <code class=\\"language-text\\">useSuspense()</code>.</p>
<p>Can you see why?</p>
<p><em>(Whispers: Composition… Debugging…)</em></p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/why-isnt-x-a-hook/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "The “Bug-O” Notation",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "What is the 🐞(<i>n</i>) of your API?",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/the-bug-o-notation/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/the-bug-o-notation/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Fri, 25 Jan 2019 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>When you write performance-sensitive code, it’s a good idea to keep in mind its algorithmic complexity. It is often expressed with the <a href=\\"https://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Big-O notation</a>.</p>
<p>Big-O is a measure of <strong>how much slower the code will get as you throw more data at it</strong>. For example, if a sorting algorithm has O(<i>n<sup>2</sup></i>) complexity, sorting ×50 times more items will be roughly 50<sup>2</sup> = 2,500 times slower. Big O doesn’t give you an exact number, but it helps you understand how an algorithm <em>scales</em>.</p>
<p>Some examples: O(<i>n</i>), O(<i>n</i> log <i>n</i>), O(<i>n<sup>2</sup></i>), O(<i>n!</i>).</p>
<p>However, <strong>this post isn’t about algorithms or performance</strong>. It’s about APIs and debugging. It turns out, API design involves very similar considerations.</p>
<hr>
<p>A significant part of our time goes into finding and fixing mistakes in our code. Most developers would like to find bugs faster. As satisfactory as it may be in the end, it sucks to spend the whole day chasing a single bug when you could have implemented something from your roadmap.</p>
<p>Debugging experience influences our choice of abstractions, libraries, and tools. Some API and language designs make a whole class of mistakes impossible. Some create endless problems. <strong>But how can you tell which one is which?</strong></p>
<p>Many online discussions about APIs are primarily concerned with aesthetics. But that <a href=\\"https://overreacted.io/optimized-for-change/\\">doesn’t say much</a> about what it feels like to use an API in practice.</p>
<p><strong>I have a metric that helps me think about this. I call it the <em>Bug-O</em> notation:</strong></p>
<p><font size=\\"40\\">🐞(<i>n</i>)</font></p>
<p>The Big-O describes how much an algorithm slows down as the inputs grow. The <em>Bug-O</em> describes how much an API slows <em>you</em> down as your codebase grows.</p>
<hr>
<p>For example, consider this code that manually updates the DOM over time with imperative operations like <code class=\\"language-text\\">node.appendChild()</code> and <code class=\\"language-text\\">node.removeChild()</code> and no clear structure:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">trySubmit</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Section 1</span>
  <span class=\\"token keyword\\">let</span> spinner <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createSpinner</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>spinner<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">submitForm</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  	<span class=\\"token comment\\">// Section 2</span>
    formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeChild</span><span class=\\"token punctuation\\">(</span>spinner<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">let</span> successMessage <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createSuccessMessage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>successMessage<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">catch</span><span class=\\"token punctuation\\">(</span>error <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  	<span class=\\"token comment\\">// Section 3</span>
    formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeChild</span><span class=\\"token punctuation\\">(</span>spinner<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">let</span> errorMessage <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createErrorMessage</span><span class=\\"token punctuation\\">(</span>error<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">let</span> retryButton <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createRetryButton</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>errorMessage<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>retryButton<span class=\\"token punctuation\\">)</span>
    retryButton<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'click'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">function</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token comment\\">// Section 4</span>
      formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeChild</span><span class=\\"token punctuation\\">(</span>errorMessage<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeChild</span><span class=\\"token punctuation\\">(</span>retryButton<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token function\\">trySubmit</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The problem with this code isn’t that it’s “ugly”. We’re not talking about aesthetics. <strong>The problem is that if there is a bug in this code, I don’t know where to start looking.</strong></p>
<p><strong>Depending on the order in which the callbacks and events fire, there is a combinatorial explosion of the number of codepaths this program could take.</strong> In some of them, I’ll see the right messages. In others, I’ll see multiple spinners, failure and error messages together, and possibly crashes.</p>
<p>This function has 4 different sections and no guarantees about their ordering. My very non-scientific calculation tells me there are 4×3×2×1 = 24 different orders in which they could run. If I add four more code segments, it’ll be 8×7×6×5×4×3×2×1 — <em>forty thousand</em> combinations. Good luck debugging that.</p>
<p><strong>In other words, the Bug-O of this approach is 🐞(<i>n!</i>)</strong> where <em>n</em> is the number of code segments touching the DOM. Yeah, that’s a <em>factorial</em>. Of course, I’m not being very scientific here. Not all transitions are possible in practice. But on the other hand, each of these segments can run more than once. <span style=\\"word-break: keep-all\\">🐞(<em>¯\\\\_(ツ)_/¯</em>)</span> might be more accurate but it’s still pretty bad. We can do better.</p>
<hr>
<p>To improve the Bug-O of this code, we can limit the number of possible states and outcomes. We don’t need any library to do this. It’s just a matter of enforcing some structure on our code. Here is one way we could do it:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> currentState <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
  step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'initial'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token comment\\">// 'initial' | 'pending' | 'success' | 'error'</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">trySubmit</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>currentState<span class=\\"token punctuation\\">.</span>step <span class=\\"token operator\\">===</span> <span class=\\"token string\\">'pending'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// Don't allow to submit twice</span>
    <span class=\\"token keyword\\">return</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'pending'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">submitForm</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'success'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">catch</span><span class=\\"token punctuation\\">(</span>error <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'error'</span><span class=\\"token punctuation\\">,</span> error <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span>nextState<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Clear all existing children</span>
  formStatus<span class=\\"token punctuation\\">.</span>innerHTML <span class=\\"token operator\\">=</span> <span class=\\"token string\\">''</span><span class=\\"token punctuation\\">;</span>

  currentState <span class=\\"token operator\\">=</span> nextState<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">switch</span> <span class=\\"token punctuation\\">(</span>nextState<span class=\\"token punctuation\\">.</span>step<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'initial'</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'pending'</span><span class=\\"token punctuation\\">:</span>
      formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>spinner<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'success'</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token keyword\\">let</span> successMessage <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createSuccessMessage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>successMessage<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'error'</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token keyword\\">let</span> errorMessage <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createErrorMessage</span><span class=\\"token punctuation\\">(</span>nextState<span class=\\"token punctuation\\">.</span>error<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">let</span> retryButton <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createRetryButton</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>errorMessage<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      formStatus<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">appendChild</span><span class=\\"token punctuation\\">(</span>retryButton<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      retryButton<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'click'</span><span class=\\"token punctuation\\">,</span> trySubmit<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This code might not look too different. It’s even a bit more verbose. But it is <em>dramatically</em> simpler to debug because of this line:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span>nextState<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Clear all existing children</span>
<span class=\\"gatsby-highlight-code-line\\">  formStatus<span class=\\"token punctuation\\">.</span>innerHTML <span class=\\"token operator\\">=</span> <span class=\\"token string\\">''</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token comment\\">// ... the code adding stuff to formStatus ...</span></code></pre></div>
<p>By clearing out the form status before doing any manipulations, we ensure that our DOM operations always start from scratch. This is how we can fight the inevitable <a href=\\"https://overreacted.io/the-elements-of-ui-engineering/\\">entropy</a> — by <em>not</em> letting the mistakes accumulate. This is the coding equivalent of “turning it off and on again”, and it works amazingly well.</p>
<p><strong>If there is a bug in the output, we only need to think <em>one</em> step back — to the previous <code class=\\"language-text\\">setState</code> call.</strong> The Bug-O of debugging a rendering result is 🐞(<em>n</em>) where <em>n</em> is the number of rendering code paths. Here, it’s just four (because we have four cases in a <code class=\\"language-text\\">switch</code>).</p>
<p>We might still have race conditions in <em>setting</em> the state, but debugging those is easier because each intermediate state can be logged and inspected. We can also disallow any undesired transitions explicitly:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">trySubmit</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>currentState<span class=\\"token punctuation\\">.</span>step <span class=\\"token operator\\">===</span> <span class=\\"token string\\">'pending'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// Don't allow to submit twice</span>
    <span class=\\"token keyword\\">return</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Of course, always resetting the DOM comes with a tradeoff. Naïvely removing and recreating the DOM every time would destroy its internal state, lose focus, and cause terrible performance problems in larger applications.</p>
<p>That’s why libraries like React can be helpful. They let you <em>think</em> in the paradigm of always recreating the UI from scratch without necessarily doing it:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">FormStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> <span class=\\"token punctuation\\">[</span>state<span class=\\"token punctuation\\">,</span> setState<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
    step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'initial'</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleSubmit</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    e<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">preventDefault</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>state<span class=\\"token punctuation\\">.</span>step <span class=\\"token operator\\">===</span> <span class=\\"token string\\">'pending'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token comment\\">// Don't allow to submit twice</span>
      <span class=\\"token keyword\\">return</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
    <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'pending'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">submitForm</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'success'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">catch</span><span class=\\"token punctuation\\">(</span>error <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> step<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'error'</span><span class=\\"token punctuation\\">,</span> error <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">let</span> content<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">switch</span> <span class=\\"token punctuation\\">(</span>state<span class=\\"token punctuation\\">.</span>step<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'pending'</span><span class=\\"token punctuation\\">:</span>
      content <span class=\\"token operator\\">=</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Spinner</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'success'</span><span class=\\"token punctuation\\">:</span>
      content <span class=\\"token operator\\">=</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>SuccessMessage</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">'error'</span><span class=\\"token punctuation\\">:</span>
      content <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
        <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
          </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>ErrorMessage</span> <span class=\\"token attr-name\\">error</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>state<span class=\\"token punctuation\\">.</span>error<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
          </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>RetryButton</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>handleSubmit<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\">
        </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
      <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>form</span> <span class=\\"token attr-name\\">onSubmit</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>handleSubmit<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
      </span><span class=\\"token punctuation\\">{</span>content<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>form</span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The code may look different, but the principle is the same. The component abstraction enforces boundaries so that you know no <em>other</em> code on the page could mess with its DOM or state. Componentization helps reduce the Bug-O.</p>
<p>In fact, if <em>any</em> value looks wrong in the DOM of a React app, you can trace where it comes from by looking at the code of components above it in the React tree one by one. No matter the app size, tracing a rendered value is 🐞(<em>tree height</em>).</p>
<p><strong>Next time you see an API discussion, consider: what is the 🐞(<em>n</em>) of common debugging tasks in it?</strong> What about existing APIs and principles you’re deeply familiar with? Redux, CSS, inheritance — they all have their own Bug-O.</p>
<hr>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/the-bug-o-notation/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Preparing for a Tech Talk, Part 2: What, Why, and How",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "We need to go deeper.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/preparing-for-tech-talk-part-2-what-why-and-how/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/preparing-for-tech-talk-part-2-what-why-and-how/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Mon, 07 Jan 2019 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>I’ve done a <a href=\\"https://www.youtube.com/watch?v=xsSnOQynTHs\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">few</a> <a href=\\"https://www.youtube.com/watch?v=nLF0n9SACd4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">tech</a> <a href=\\"https://www.youtube.com/watch?v=dpw9EHDh2bM\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">talks</a> that I think went well.</p>
<p>Sometimes people ask me how I prepare for a talk. For every speaker, the answer is very personal. I’m just sharing what works for me.</p>
<p><strong>This is the second post in a series</strong> where I explain my process preparing for a tech talk — from conceiving the idea to the actual day of the presentation:</p>
<ul>
<li><strong><a href=\\"https://overreacted.io/preparing-for-tech-talk-part-1-motivation/\\">Preparing for a Tech Talk, Part 1: Motivation</a></strong></li>
<li><strong>Preparing for a Tech Talk, Part 2: What, Why, and How (<em>this post</em>)</strong></li>
<li>To be continued</li>
</ul>
<p />
<hr>
<p><strong>In this post, I will focus on finding the What, Why, and How of my talk.</strong> Doing this early helps me avoid a lot of headache at a later stage.</p>
<hr>
<p>If you haven’t seen <a href=\\"https://en.wikipedia.org/wiki/Inception\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Inception</a>, watch it today. It’s an enjoyable blockbuster with mindbending visuals and a stimulating plot. But as <a href=\\"https://mobile.twitter.com/ryanflorence\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Ryan Florence</a> taught me, it also contains good advice for creating a memorable talk.</p>
<p>That movie is about putting ideas into other people’s heads while they sleep. This might sound a bit invasive (and is illegal in the movie). But if you signed up to give a tech talk, that’s a pretty accurate description of your challenge.</p>
<hr>
<p><strong>What is the one thing that you want people to take away from your talk?</strong> I try to formulate it as a sentence early on. This idea shouldn’t be longer than a dozen words. People will forget most of what you say so you need to pick carefully <em>what</em> you want to stick. It’s the seed you want to plant in their heads.</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/a5ccc/totem.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 55.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBA//EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAVyzrXIz/8QAHBAAAwABBQAAAAAAAAAAAAAAAQIDEQAEEiEi/9oACAEBAAEFApy6fyTEa27HFWbkztn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIxEBEh/9oACAEBAAY/AiK1bKwuln//xAAaEAEAAgMBAAAAAAAAAAAAAAABABEQMUFh/9oACAEBAAE/IaihB4C1HtsdGGrRWIf/2gAMAwEAAgADAAAAECgP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxC4VH//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EJpGf//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExUUFh/9oACAEBAAE/EMyFm4TTUL21SzAwp2UZmfSZ0xZXdT0ep//Z'); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"Spinning top from the Inception movie\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/f8fb9/totem.jpg\\"
        srcset=\\"https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/e8976/totem.jpg 148w,https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/63df2/totem.jpg 295w,https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/f8fb9/totem.jpg 590w,https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/85e3d/totem.jpg 885w,https://overreacted.io/static/75d0f71a5046459adaaed7f65f2f46c6/a5ccc/totem.jpg 900w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>

  </a>
    </p>
<p>For example, here’s the core ideas of my talks.</p>
<ul>
<li>
<p><a href=\\"https://www.youtube.com/watch?v=xsSnOQynTHs\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hot Reloading</a>: “Functional principles improve the development workflow.”</p>
</li>
<li>
<p><a href=\\"https://www.youtube.com/watch?v=nLF0n9SACd4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Beyond React 16</a>: “Waiting for CPU and IO has a unified solution.”</p>
</li>
<li>
<p><a href=\\"https://www.youtube.com/watch?v=dpw9EHDh2bM\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Introducing Hooks</a>: “Hooks make stateful logic reusable.”</p>
</li>
</ul>
<p>I don’t always explicitly <em>say</em> the central idea out loud or write it on a slide, but it is always the intellectual backbone of my talk. Everything I say and show must ultimately work towards supporting this idea. I want to prove it to you.</p>
<hr>
<p>An idea is the <strong>“What”</strong> of my talk. But there is also <strong>“How”</strong> and <strong>“Why”</strong>:</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/26cb4/how-what-why.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 57.40181268882175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVQoz3WR208TURDG+T99NtFnH4yh8clojAImmqJg0CpRGtju9kIFFGi9JmU1xRBsIZZYY9utYBuKMZru/Jy9tSh6TiYzZ+Y73/nmzAgnliAiQSRumHM03iJID+tRPMQLI39R+TsiE99/51d/HpdpPX3ElbCml13XHVhEeoIweimouziNh8zPnWZu9gyV7cu+WoR/rj8UHifzQk9Jm1U+/5xipzvNVnuSvaMpzSXpyT5O8ys7u1VqtRrlcpl6vT5UePwPIsJNeYElt8mTICczLKn34gx3mXh+kd1PVTr7HZrNhk/qOE5IGBL4v+cNQeOqvMXsx3nGLGOvRzl78xSXVs5xtXCehW6csdIF3pD7T8si4ecHE92jgskdVTLDIvd5fHiLRHtCbdz3Wc0v60MGk0q6TN8T4srgftCyGxzEadEqGTTsFC3bpLFhcLCZ4ejDEofbeQ7eZ2lupGgopmVbfCkl+VF5N5yBrzAi63QhtwgLWUipN9Rbeb7de4R9ZZzqjTi9B0kwvZq2m8oFuAUTqVSjnkOFvR7knyBGCkmnEcvCtUzIZmkldCixGJnYKKXr1xSXp2+aPiawtJIaiA4maNlTaNuw8hTWC7C2prbum6xqXCjCy1dQLA7yQwuxHs6zToffafwhsP6uyDEAAAAASUVORK5CYII='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"Pyramid: “How” is on top of “What”. “What” is on top of “Why”.\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/fb8a0/how-what-why.png\\"
        srcset=\\"https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/1a291/how-what-why.png 148w,https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/2bc4a/how-what-why.png 295w,https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/fb8a0/how-what-why.png 590w,https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/526de/how-what-why.png 885w,https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/fa2eb/how-what-why.png 1180w,https://overreacted.io/static/fb49faeb9e354bb061e253c3b490488b/26cb4/how-what-why.png 1324w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>

  </a>
    </p>
<p><strong>“How”</strong> is my method for delivering the idea to the audience. Personally, I prefer live demos, but there are many things that can work. I will talk more about “How” in the later blog posts in this series.</p>
<p>We’ve just discussed <strong>“What”</strong> which is the core idea of the talk. It’s the thought I want to plant in your head and the insight I want you to walk away with. It’s what I want people to share with their friends and colleagues.</p>
<p>Which brings us to <strong>“Why”</strong>. </p>
<hr>
<p>To explain <strong>“Why”</strong>, I’ll quote this dialog from the Inception movie:</p>
<p><strong>(warning: spoilers!)</strong></p>
<blockquote>
<p><strong>Cobb:</strong> “I will split up my father’s empire.” Now, this is obviously an idea that Robert himself will choose to reject. Which is why we need to plant it deep in his subconscious. The subconscious is motivated by emotion, right? Not reason. We need to find a way to translate this into an emotional concept.</p>
<p><strong>Arthur:</strong> How do you translate a business strategy into an emotion?</p>
<p><strong>Cobb:</strong> That’s what we’re here to figure out, right. Now Robert’s relationship with his father is stressed, to say the least.</p>
<p><strong>Eames:</strong> Well can we run with that? We could suggest him breaking up his fathers company as a “screw you” to the old man.</p>
<p><strong>Cobb:</strong> No, cause I think positive emotion trumps negative emotion every time. We all yearn for reconciliation, for catharsis. We need Robert Fischer to have a positive emotional reaction to all this.</p>
<p><strong>Eames:</strong> Alright, well, try this? “My father accepts that I want to create for myself, not follow in his footsteps.”</p>
<p><strong>Cobb:</strong> That might work.</p>
</blockquote>
<p>Now, I’m not suggesting that you break up empires with your talk.</p>
<p>But there must be a <a href=\\"https://overreacted.io/preparing-for-tech-talk-part-1-motivation/\\">reason</a> you get out in front of thousands of people to speak about something. You <em>believe</em> in something — and you want others to share that feeling. <strong>This is the “Why” — the emotional core of your talk.</strong></p>
<hr>
<p>Here’s the example “What”, “Why”, and “How” from my talks.</p>
<p><a href=\\"https://www.youtube.com/watch?v=xsSnOQynTHs\\" target=\\"_blank\\">
  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 57.40181268882175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVQoz3WSi08TQRCH+bMpKjEl9oGkCRUocoUYDRBsr8WIoiiv2gdoUYuaFiNYSV+UR0sJpS29/dx7FIvi7E12dnb2u9/sXQ9/mRCia6VhLsvS01374oZa03pugtVqNUqlIm1NP1pnP6eQztjRxA8DJYSxIR9zXAN2IPrciS/blzQaLT2i3QyzGbexEbvDWdUncwULZkHFdWjP/6TrdiCWybUm2Nr38rkwQvZcoShmORfHFuxf6JXCVqvF6WmVer1uFH0hSrg9xnjaycO0A9+3e4ykBlAbPtYIcK6d/YF2REm/AjabTY6PjqhXL9gjxVTexdj2AMPJfoY/9DO6bceTuIVP5vy/HGywQFtcXim0qN0tm8mf7ODduYs70YcrYcMZ68UZ72UoeRvPp34GN/twRm3cT9mIaosY+rqgpkJLtia/7GEyTOl9iEJClR4kFwuQe/eUfDxIaTNk5AobKsW4ykEywEXmoykOq+XTapV8uUz7WF704ivyvilSQ172xyfZG1UoTz4hO+anoDziu9dnxCX/Y756Rth9MAHqPCKTMfvTgbq25skJ2ouXEApzNjfHyfQ0WUXhrd1OzOUi6nISd7uJOBwkBt1k/QqVmRkqszMw/wwRVBG7e9Zvo0nklpS99AaxugqraxCJ0Hi9xKEszgWC1OTLdC+qISrPF2jJWtYjRq1YkWeWV0yvVPgNCogX14HVT9cAAAAASUVORK5CYII='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"How: “Live demo”. What: “Functional principles improve the developer experience”. Why: “Create your own tools to make programming fun”.\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/fb8a0/how-what-why-hot-reloading.png\\"
        srcset=\\"https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/1a291/how-what-why-hot-reloading.png 148w,https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/2bc4a/how-what-why-hot-reloading.png 295w,https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/fb8a0/how-what-why-hot-reloading.png 590w,https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/526de/how-what-why-hot-reloading.png 885w,https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/fa2eb/how-what-why-hot-reloading.png 1180w,https://overreacted.io/static/a65c15cd4ca2277599972b89da3cbf0b/26cb4/how-what-why-hot-reloading.png 1324w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>
  </a></p>
<p><em>(The above pyramid is for <a href=\\"https://www.youtube.com/watch?v=xsSnOQynTHs\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hot reloading with time travel</a>)</em></p>
<p><a href=\\"https://www.youtube.com/watch?v=nLF0n9SACd4\\" target=\\"_blank\\">
  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 57.40181268882175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACD0lEQVQoz3WS/U/TUBSG+a+FRGMIEFaIIEJWZRuCHz+MMWAbmwEUFhEEjRMhZMMQostkY7Z0HVr21ft42244Cd7m5PSee+/T972nPdwYQoiumY03LcvIdq2LW/Z6o+c2WLVapVQq0mo5Ry3yhQDZ4wFsceKihLBdpmg//wA7ECd33putJrVaQxYbNGtL7O30sbt9j8uKKlfPHOEetHOuC9rzP+nO0ElTFCEyhSkOyyr5WkiaD1Oj4l1IB9ql9Fpho9HANCtYluXa2TXXeWmMMS9VJZpBFi5VwoafBctPTJ+hWrsBdTgyroH1eh1N07gyrzhhn4kvd1HSvYy+7WVkS+atPiYz91E27zC618vrX/PSeattX3Sa0G3ZK37jmGWmpbpHPD17wFx5nGB+hEBeceeB7wqzZ2NEUXnPqoP0GiS6Lbdl27Kz5x+iaPsxLg5W0A8SMicwDleoHCXddzcfJtA+Jyh+nMfKZq7v0VVoVir8KJdp6TqkXmGHlziekA3wB/kZfE7h8QzFJ7N8fahyHnhGbtxPaXqOvBri94sILC4jcrm/lh1t9YsL7GQKEV2EeJyjqUnW+vt55/ORHhqUMcS24mPLN8zG4ICsD7OjKFgRCYzFEZEo4vS0/dvYEvlJyl5bx97YhM009dU1tFgMXcKNuLQmP3SZSnG+uISRkNcga+ZKEuR+4Zx5s+GFYfAHLWkantktagwAAAAASUVORK5CYII='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"How: “Live demo”. What: “Waiting for CPU and IO has a unified solution”. Why: “React cares about both user and developer experience”.\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/fb8a0/how-what-why-beyond-react-16.png\\"
        srcset=\\"https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/1a291/how-what-why-beyond-react-16.png 148w,https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/2bc4a/how-what-why-beyond-react-16.png 295w,https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/fb8a0/how-what-why-beyond-react-16.png 590w,https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/526de/how-what-why-beyond-react-16.png 885w,https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/fa2eb/how-what-why-beyond-react-16.png 1180w,https://overreacted.io/static/0d4310b34364a1ba80b55650f5e4c11c/26cb4/how-what-why-beyond-react-16.png 1324w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>
  </a></p>
<p><em>(The above pyramid is for <a href=\\"https://www.youtube.com/watch?v=nLF0n9SACd4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Beyond React 16</a>)</em></p>
<p><a href=\\"https://www.youtube.com/watch?v=dpw9EHDh2bM\\" target=\\"_blank\\">
  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 57.40181268882175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVQoz3WSj08SYRjH/afbpNZqy0JJSlcOHFhUWzWKA0J0xRJZ6sSGlo7URjYcAvHLA+cBx9376b0DFJu9t+fe93mf5/nc93nfG+OfIYQY8Uz6bkXa/khcXJPbH2PXwVqtFuVyCcOwSjWOCz72D+9hipyNEsK0mWLwXAEOIdY8XPeMHp2OLjd1jG6Y9IaDzfXbnKkeGS1awvvQYd0IdOx/0q1RZ5Wi6WenOMdexUO+s0CVIB3UAWwAHVF6oVDXdZrNJpqm2X66leBVbRpF8xHW5lHOvYQ7Pl43ZonWFjg3zq5CLY60C2C326VWraKpbXJ8I1CawpVy4N64ycMv43I9zvSaA2fiBk+zd1jVQ7LzXv8shx1aQC7vzH7n+YmCl2Ve8q7twbV1i0D5Ed5fTmZ27+I/dtkxK2eTjxiD0iHUVijMvmxT3mw5HaKUUahuR2l8j9HYW6SxG0PNxlF/xKUfoyZjfzIRCltvaR9sX5yjrbCpqpxUKhj1OsSX4P0HUOKceJ+TdT+hNB+g4HlGbtZLfs5PUfq/53zobxQIW/kK4uDwsmVLW+/0FLG0jAjJYDSKGQlzHgyyM/OY1IP7fHW7WZt0kpyYYH1qktKLAHooZOeKSERC5froaPDbWO1mMvApgVhJIj6v2EYqRVfuVSNRmotxzuQHT2Oy3ajsIJmUttrPkzVYs2VS2F9dcR5KTo4EJAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"How: “Live demo”. What: “Hooks make stateful logic reusable. Why: “Hooks reveal the true nature of React”.\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/fb8a0/how-what-why-introducing-hooks.png\\"
        srcset=\\"https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/1a291/how-what-why-introducing-hooks.png 148w,https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/2bc4a/how-what-why-introducing-hooks.png 295w,https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/fb8a0/how-what-why-introducing-hooks.png 590w,https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/526de/how-what-why-introducing-hooks.png 885w,https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/fa2eb/how-what-why-introducing-hooks.png 1180w,https://overreacted.io/static/cd27cea1fdca520d929385de0cc1581b/26cb4/how-what-why-introducing-hooks.png 1324w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>
  </a></p>
<p><em>(The above pyramid is for <a href=\\"https://www.youtube.com/watch?v=dpw9EHDh2bM\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Introducing Hooks</a>)</em></p>
<p>A memorable talk takes a concise idea, makes the audience care about it, and has a clear and convincing execution. That’s the “What”, “Why”, and “How”.</p>
<hr>
<p>In this post, I described how I organize the core ideas of my talks. Again, I want to emphasize I’m just sharing what works for me — there are <a href=\\"https://mobile.twitter.com/jackiehluo/status/1077717283026411520\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">many kinds of talks</a> and your outlook on this may be very different.</p>
<p>In the next posts in this series, I will talk about preparing the talk outline, slides, rehearsing the talks, and what I do on the day of the presentation.</p>
<p><strong>Previous in this series: <a href=\\"https://overreacted.io/preparing-for-tech-talk-part-1-motivation/\\">Preparing for a Tech Talk, Part 1: Motivation</a></strong>.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/preparing-for-tech-talk-part-2-what-why-and-how/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "The Elements of UI Engineering",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "What makes UI engineering difficult?",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/the-elements-of-ui-engineering/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/the-elements-of-ui-engineering/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Sun, 30 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>In my <a href=\\"https://overreacted.io/things-i-dont-know-as-of-2018/\\">previous post</a>, I talked about admitting our knowledge gaps. You might conclude that I suggest settling for mediocrity. I don’t! This is a broad field.</p>
<p>I strongly believe that you can “begin anywhere” and don’t need to learn technologies in any particular order. But I also place great value in gaining expertise. Personally I’ve mostly been interested in creating user interfaces.</p>
<p><strong>I’ve been mulling over what it is that I <em>do</em> know about and consider valuable.</strong> Sure, I’m familiar with a few technologies (e.g. JavaScript and React). But the more important lessons from experience are elusive. I never tried to put them into words. This is my first attempt to catalog and describe some of them.</p>
<hr>
<p>There are plenty of “learning roadmaps” about technologies and libraries. Which library is going to be in vogue in 2019? What about 2020? Should you learn Vue or React? Angular? What about Redux or Rx? Do you need to learn Apollo? REST or GraphQL? It’s easy to get lost. What if the author is wrong?</p>
<p><strong>My biggest learning breakthroughs weren’t about a particular technology.</strong> Rather, I learned the most when I struggled to solve a particular UI problem. Sometimes, I would later discover libraries or patterns that helped me. In other cases, I’d come up with my own solutions (both good and bad ones).</p>
<p>It’s this combination of understanding the <em>problems</em>, experimenting with the <em>solutions</em>, and applying different <em>strategies</em> that led to the most rewarding learning experiences in my life. <strong>This post focuses on just the problems.</strong></p>
<hr>
<p>If you worked a user interface, you’ve likely dealt with at least some of these challenges — either directly or using a library. In either case, I encourage you to create a tiny app with <em>no</em> libraries, and play with reproducing and solving these problems. There’s no one right solution to any of them. Learning comes from exploring the problem space and trying different possible tradeoffs.</p>
<hr>
<ul>
<li>
<p><strong>Consistency.</strong> You click on a “Like” button and the text updates: “You and 3 other friends liked this post.” You click it again, and the text flips back. Sounds easy. But maybe a label like this exists in several places on the screen. Maybe there is some other visual indication (such as the button background) that needs to change. The list of “likers” that was previously fetched from the server and is visible on hover should now include your name. If you navigate to another screen and go back, the post shouldn’t “forget” it was liked. Even local consistency <em>alone</em> creates a set of challenges. But other users might also modify the data we display (e.g. by liking a post we’re viewing). How do we keep the same data in sync on different parts of the screen? How and when do we make the local data consistent with the server, and the other way around?</p>
</li>
<li>
<p><strong>Responsiveness.</strong> People can only tolerate a lack of visual feedback to their actions for a limited time. For <em>continuous</em> actions like gestures and scroll, this limit is low. (Even skipping a single 16ms frame feels “janky”.) For <em>discrete</em> actions like clicks, there is research saying users perceive any &#x3C; 100ms delays as equally fast. If an action takes longer, we need to show a visual indicator. But there are some counter-intuitive challenges. Indicators that cause the page layout to “jump” or that go through several loading “stages” can make the action <em>feel longer</em> than it was. Similarly, handling an interaction within 20ms at the cost of dropping an animation frame can <em>feel slower</em> than handling it within 30ms and no dropped frames. Brains aren’t benchmarks. How do we keep our apps responsive to different kinds of inputs?</p>
</li>
<li>
<p><strong>Latency.</strong> Both computations and network access take time. <em>Sometimes</em> we can ignore the computational cost if it doesn’t hurt the responsiveness on our target devices (make sure to test your app on the low-end device spectrum). But handling network latency is unavoidable — it can take seconds! Our app can’t just freeze waiting for the data or code to load. This means any action that depends on new data, code, or assets is potentially asynchronous and needs to handle the “loading” case. But that can happen for almost every screen. How do we gracefully handle latency without displaying a “cascade” of spinners or empty “holes”? How do we avoid “jumpy” layout? And how do we change async dependencies without “rewiring” our code every time?</p>
</li>
<li>
<p><strong>Navigation.</strong> We expect that the UI remains “stable” as we interact with it. Things shouldn’t disappear from right under our noses. Navigation, whether started within the app (e.g. clicking a link) or due to an external event (e.g. clicking the “back” button), should also respect this principle. For example, switching between <code class=\\"language-text\\">/profile/likes</code> and <code class=\\"language-text\\">/profile/follows</code> tabs on a profile screen shouldn’t clear a search input outside the tabbed view. Even navigating to <em>another</em> screen is like walking into a room. People expect to go back later and find things as they left them (with, perhaps, some new items). If you’re in the middle of a feed, click on a profile, and go back, it’s frustrating to lose your position in the feed — or wait for it to load again. How do we architect our app to handle arbitrary navigation without losing important context?</p>
</li>
<li>
<p><strong>Staleness.</strong> We can make the “back” button navigation instant by introducing a local cache. In that cache, we can “remember” some data for quick access even if we could theoretically refetch it. But caching brings its own problems. Caches can get stale. If I change an avatar, it should update in the cache too. If I make a new post, it needs to appear in the cache immediately, or the cache needs to be invalidated. This can become difficult and error-prone. What if the posting fails? How long does the cache stay in memory? When we refetch the feed, do we “stitch” the newly fetched feed with the cached one, or throw the cache away? How is pagination or sorting represented in the cache?</p>
</li>
<li>
<p><strong>Entropy.</strong> The second law of thermodynamics says something like “with time, things turn into a mess” (well, not exactly). This applies to user interfaces too. We can’t predict the exact user interactions and their order. At any point in time, our app may be in one of a mind-boggling number of possible states. We do our best to make the result predictable and limited by our design. We don’t want to look at a bug screenshot and wonder “how did <em>that</em> happen”. For <em>N</em> possible states, there are <em>N×(N–1)</em> possible transitions between them. For example, if a button can be in one of 5 different states (normal, active, hover, danger, disabled), the code updating the button must be correct for 5×4=20 possible transitions — or forbid some of them. How do we tame the combinatorial explosion of possible states and make visual output predictable?</p>
</li>
<li>
<p><strong>Priority.</strong> Some things are more important than others. A dialog might need to appear physically “above” the button that spawned it and “break out” of its container’s clip boundaries. A newly scheduled task (e.g. responding to a click) might be more important than a long-running task that already started (e.g. rendering next posts below the screen fold). As our app grows, parts of its code written by different people and teams compete for limited resources like processor, network, screen estate, and the bundle size budget. Sometimes you can rank the contenders on a shared scale of “importance”, like the CSS <code class=\\"language-text\\">z-index</code> property. <a href=\\"https://blogs.msdn.microsoft.com/oldnewthing/20050607-00/?p=35413\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">But it rarely ends well.</a> Every developer is biased to think <em>their</em> code is important. And if everything is important, then nothing is! How do we get independent widgets to <em>cooperate</em> instead of fighting for resources?</p>
</li>
<li>
<p><strong>Accessibility.</strong> Inaccessible websites are <em>not</em> a niche problem. For example, in UK disability affects 1 in 5 people. <a href=\\"https://www.abrightclearweb.com/web-accessibility-in-the-uk/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">(Here’s a nice infographic.)</a> I’ve felt this personally too. Though I’m only 26, I struggle to read websites with thin fonts and low contrast. I try to use the trackpad less often, and I dread the day I’ll have to navigate poorly implemented websites by keyboard. We need to make our apps not horrible to people with difficulties — and the good news is that there’s a lot of low-hanging fruit. It starts with education and tooling. But we also need to make it easy for product developers to do the right thing. What can we do to make accessibility a <em>default</em> rather than an afterthought?</p>
</li>
<li>
<p><strong>Internationalization.</strong> Our app needs to work all over the world. Not only do people speak different languages, but we also need to support right-to-left layouts with the least amount of effort from product engineers. How do we support different languages without sacrificing latency and responsiveness?</p>
</li>
<li>
<p><strong>Delivery.</strong> We need to get our application code to the user’s computer. What transport and format do we use? This might sound straightforward but there are many tradeoffs here. For example, native apps tend to load all code in advance at the cost of a huge app size. Web apps tend to have smaller initial payload at the cost of more latency during use. How do we choose at which point to introduce latency? How do we optimize our delivery based on the usage patterns? What kind of data would we need for an optimal solution?</p>
</li>
<li>
<p><strong>Resilience.</strong> You might like bugs if you’re an entomologist, but you probably don’t enjoy seeing them in your programs. However, some of your bugs will inevitably get to production. What happens then? Some bugs cause wrong but well-defined behavior. For example, maybe your code displays incorrect visual output under some condition. But what if the rendering code <em>crashes</em>? Then we can’t meaningfully continue because the visual output would be inconsistent. A crash rendering a single post shouldn’t “bring down” an entire feed or get it into a semi-broken state that causes further crashes. How do we write code in a way that isolates rendering and fetching failures and keeps the rest of the app running? What does fault tolerance mean for user interfaces?</p>
</li>
<li>
<p><strong>Abstraction.</strong> In a tiny app, we can hardcode a lot of special cases to account for the above problems. But apps tend to grow. We want to be able to <a href=\\"https://overreacted.io/optimized-for-change/\\">reuse, fork, and join</a> parts of our code, and work on it collectively. We want to define clear boundaries between the pieces familiar to different people, and avoid making often-changing logic too rigid. How do we create abstractions that hide implementation details of a particular UI part? How do we avoid re-introducing the same problems that we just solved as our app grows?</p>
</li>
</ul>
<hr>
<p>Of course, there are many problems I haven’t mentioned. This list is by no means exhaustive! For example, I haven’t talked about the designer and engineering collaboration, or debugging and testing. Maybe another time.</p>
<p>It’s tempting to read about these problems with a particular view library or a data fetching library in mind as a solution. But I encourage you to pretend that these libraries don’t exist, and read again from that perspective. How would <em>you</em> approach solving these issues? Give them a try on a tiny app! (I’d love to see your experiments on GitHub — feel free to tweet me in response.)</p>
<p>What’s interesting about these problems is that most of them show up at any scale. You can see them both in small widgets like a typeahead or a tooltip, and in huge apps like Twitter and Facebook.</p>
<p><strong>Think of a non-trivial UI element from an app you enjoy using, and go through this list of problems. Can you describe some of the tradeoffs chosen by its developers? Try to recreate a similar behavior from scratch!</strong></p>
<p>I learned a lot about UI engineering by experimenting with these problems in small apps without using libraries. I recommend the same to anyone who wants to gain a deeper appreciation for the tradeoffs in UI engineering.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/the-elements-of-ui-engineering/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Things I Don’t Know as of 2018",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "We can admit our knowledge gaps without devaluing our expertise.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/things-i-dont-know-as-of-2018/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/things-i-dont-know-as-of-2018/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Fri, 28 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>People often assume that I know far more than I actually do. That’s not a bad problem to have and I’m not complaining. (Folks from minority groups often suffer the opposite bias despite their hard-earned credentials, and that <em>sucks</em>.)</p>
<p><strong>In this post I’ll offer an incomplete list of programming topics that people often wrongly assume that I know.</strong> I’m not saying <em>you</em> don’t need to learn them — or that I don’t know <em>other</em> useful things. But since I’m not in a vulnerable position myself right now, I can be honest about this.</p>
<p>Here’s why I think it’s important.</p>
<hr>
<p>First, there is often an unrealistic expectation that an experienced engineer knows every technology in their field. Have you seen a “learning roadmap” that consists of a hundred libraries and tools? It’s useful — but intimidating.</p>
<p>What’s more, no matter how experienced you get, you may still find yourself switching between feeling capable, inadequate (“Impostor syndrome”), and overconfident (“Dunning–Kruger effect”). It depends on your environment, job, personality, teammates, mental state, time of day, and so on.</p>
<p>Experienced developers sometimes open up about their insecurities to encourage beginners. But there’s a world of difference between a seasoned surgeon who still gets the jitters and a student holding their first scalpel!</p>
<p>Hearing how “we’re all junior developers” can be disheartening and sound like empty talk to the learners faced with an actual gap in knowledge. Feel-good confessions from well-intentioned practitioners like me can’t bridge it.</p>
<p>Still, even experienced engineers have many knowledge gaps. This post is about mine, and I encourage those who can afford similar vulnerability to share their own. But let’s not devalue our experience while we do that.</p>
<p><strong>We can admit our knowledge gaps, may or may not feel like impostors, and still have deeply valuable expertise that takes years of hard work to develop.</strong></p>
<hr>
<p>With that disclaimer out of the way, here’s just a few things I don’t know:</p>
<ul>
<li>
<p><strong>Unix commands and Bash.</strong> I can <code class=\\"language-text\\">ls</code> and <code class=\\"language-text\\">cd</code> but I look up everything else. I get the concept of piping but I’ve only used it in simple cases. I don’t know how to use <code class=\\"language-text\\">xargs</code> to create complex chains, or how to compose and redirect different output streams. I also never properly learned Bash so I can only write very simple (and often buggy) shell scripts.</p>
</li>
<li>
<p><strong>Low-level languages.</strong> I understand Assembly lets you store things in memory and jump around the code but that’s about it. I wrote a few lines of C and understand what a pointer is, but I don’t know how to use <code class=\\"language-text\\">malloc</code> or other manual memory management techniques. Never played with Rust.</p>
</li>
<li>
<p><strong>Networking stack.</strong> I know computers have IP addresses, and DNS is how we resolve hostnames. I know there’s low level protocols like TCP/IP to exchange packets that (maybe?) ensure integrity. That’s it — I’m fuzzy on details.</p>
</li>
<li>
<p><strong>Containers.</strong> I have no idea about how to use Docker or Kubernetes. (Are those related?) I have a vague idea that they let me spin up a separate VM in a predictable way. Sounds cool but I haven’t tried it.</p>
</li>
<li>
<p><strong>Serverless.</strong> Also sounds cool. Never tried it. I don’t have a clear idea of how that model changes backend programming (if it does at all).</p>
</li>
<li>
<p><strong>Microservices.</strong> If I understand correctly, this just means “many API endpoints talking to each other”. I don’t know what the practical advantages or downsides of this approach are because I haven’t worked with it.</p>
</li>
<li>
<p><strong>Python.</strong> I feel bad about this one — I <em>have</em> worked with Python for several years at some point and I’ve never bothered to actually learn it. There are many things there like import behavior that are completely opaque to me.</p>
</li>
<li>
<p><strong>Node backends.</strong> I understand how to run Node, used some APIs like <code class=\\"language-text\\">fs</code> for build tooling, and can set up Express. But I’ve never talked from Node to a database and don’t really know how to write a backend in it. I’m also not familiar with React frameworks like Next beyond a “hello world”.</p>
</li>
<li>
<p><strong>Native platforms.</strong> I tried learning Objective C at some point but it didn’t work out. I haven’t learned Swift either. Same about Java. (I could probably pick it up though since I worked with C#.)</p>
</li>
<li>
<p><strong>Algorithms.</strong> The most you’ll get out of me is bubble sort and maybe quicksort on a good day. I can probably do simple graph traversing tasks if they’re tied to a particular practical problem. I understand the O(n) notation but my understanding isn’t much deeper than “don’t put loops inside loops”.</p>
</li>
<li>
<p><strong>Functional languages.</strong> Unless you count JavaScript, I’m not fluent in any traditionally functional language. (I’m only fluent in C# and JavaScript — and I already forgot most of C#.) I struggle to read either LISP-inspired (like Clojure), Haskell-inspired (like Elm), or ML-inspired (like OCaml) code.</p>
</li>
<li>
<p><strong>Functional terminology.</strong> Map and reduce is as far as I go. I don’t know monoids, functors, etc. I know what a monad is but maybe that’s an illusion.</p>
</li>
<li>
<p><strong>Modern CSS.</strong> I don’t know Flexbox or Grid. Floats are my jam.</p>
</li>
<li>
<p><strong>CSS Methodologies.</strong> I used BEM (meaning the CSS part, not the original BEM) but that’s all I know. I haven’t tried OOCSS or other methodologies.</p>
</li>
<li>
<p><strong>SCSS / Sass.</strong> Never got to learn them.</p>
</li>
<li>
<p><strong>CORS.</strong> I dread these errors! I know I need to set up some headers to fix them but I’ve wasted hours here in the past.</p>
</li>
<li>
<p><strong>HTTPS / SSL.</strong> Never set it up. Don’t know how it works beyond the idea of private and public keys.</p>
</li>
<li>
<p><strong>GraphQL.</strong> I can read a query but I don’t really know how to express stuff with nodes and edges, when to use fragments, and how pagination works there.</p>
</li>
<li>
<p><strong>Sockets.</strong> My mental model is they let computers talk to each other outside the request/response model but that’s about all I know.</p>
</li>
<li>
<p><strong>Streams.</strong> Aside from Rx Observables, I haven’t worked with streams closely. I used old Node streams one or two times but always messed up error handling.</p>
</li>
<li>
<p><strong>Electron.</strong> Never tried it.</p>
</li>
<li>
<p><strong>TypeScript.</strong> I understand the concept of types and can read annotations but I’ve never written it. The few times I tried, I ran into difficulties.</p>
</li>
<li>
<p><strong>Deployment and devops.</strong> I can manage to send some files over FTP or kill some processes but that’s the limit of my devops skills.</p>
</li>
<li>
<p><strong>Graphics.</strong> Whether it’s canvas, SVG, WebGL or low-level graphics, I’m not productive in it. I get the overall idea but I’d need to learn the primitives.</p>
</li>
</ul>
<p>Of course this list is not exhaustive. There are many things that I don’t know.</p>
<hr>
<p>It might seem like a strange thing to discuss. It even feels wrong to write it. Am I boasting of my ignorance? My intended takeaway from this post is that:</p>
<ul>
<li>
<p><strong>Even your favorite developers may not know many things that you know.</strong></p>
</li>
<li>
<p><strong>Regardless of your knowledge level, your confidence can vary greatly.</strong></p>
</li>
<li>
<p><strong>Experienced developers have valuable expertise despite knowledge gaps.</strong></p>
</li>
</ul>
<p>I’m aware of my knowledge gaps (at least, some of them). I can fill them in later if I become curious or if I need them for a project.</p>
<p>This doesn’t devalue my knowledge and experience. There’s plenty of things that I can do well. For example, learning technologies when I need them.</p>
<blockquote>
<p>Update: I also <a href=\\"https://overreacted.io/the-elements-of-ui-engineering/\\">wrote</a> about a few things that I know.</p>
</blockquote>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/things-i-dont-know-as-of-2018/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Preparing for a Tech Talk, Part 1: Motivation",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Here’s my recipe for a good talk idea.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/preparing-for-tech-talk-part-1-motivation/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/preparing-for-tech-talk-part-1-motivation/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Wed, 26 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>I’ve done a <a href=\\"https://www.youtube.com/watch?v=xsSnOQynTHs\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">few</a> <a href=\\"https://www.youtube.com/watch?v=nLF0n9SACd4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">tech</a> <a href=\\"https://www.youtube.com/watch?v=dpw9EHDh2bM\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">talks</a> that I think went well.</p>
<p>Sometimes people ask me how I prepare for a talk. For every speaker, the answer is very personal. I’m just sharing what works for me.</p>
<p><strong>This is the first post in a series</strong> where I explain my process preparing for a tech talk — from conceiving the idea to the actual day of the presentation:</p>
<ul>
<li><strong>Preparing for a Tech Talk, Part 1: Motivation (<em>this post</em>)</strong></li>
<li><strong><a href=\\"https://overreacted.io/preparing-for-tech-talk-part-2-what-why-and-how/\\">Preparing for a Tech Talk, Part 2: What, Why, and How</a></strong></li>
<li>To be continued</li>
</ul>
<p />
<hr>
<p><strong>In this post, I will only focus on the first step: why and how I pick a topic.</strong> It’s not rich in practical tips but might help you ask yourself the right questions.</p>
<hr>
<p>What motivates <em>you</em> to give a talk?</p>
<p>Maybe giving talks is a part of your current job. Maybe you want to gain more recognition in the industry so you can land a better job or get a raise. Maybe you’re out there to bring more attention to your hobby or work project.</p>
<p>We’ll call these motivations <em>external</em>. They are about what other people think of you and your work. But if you already had all the respect and money that you wanted, would you still choose to give a talk? Why?</p>
<p>Maybe you find it rewarding to teach people. Maybe you enjoy learning, and giving a talk is a nice excuse to dig deeper. Maybe you want to start or change the conversation about a topic. Maybe you want to amplify or critique an idea.</p>
<p>Such <em>internal</em> motivations aren’t a proxy for another desire like professional recognition. These are the things that have intrinsic value to you. Different people are driven by different internal motivations. It’s helpful to be aware of yours. You can sometimes trace them all the way back to your childhood.</p>
<p>For example, here’s mine:</p>
<ul>
<li>
<p><strong>I enjoy sharing ideas that inspire me.</strong> Sometimes, an idea transforms the way I think. It opens many doors that I didn’t even know existed. But it’s lonely behind those doors. I want others to join me so that they can show me even more interesting doors inside. For me, a talk is a way to collect, curate, and amplify ideas that I find tasteful. (As a teenager I made mixtapes for crushes with no interest in my music taste. Now I do talks! Life, uh, finds a way.)</p>
</li>
<li>
<p><strong>I enjoy re-explaining things in a simpler way.</strong> When I understand an idea, I get a very pleasant feeling — better than eating sweets. But learning doesn’t come easy to me. So when I finally “get” something, I want to share that feeling with the people who are still struggling. I try to remember what it was like <em>before</em> the a-ha moment to help others “make the jump” while watching my talks. (I was also insufferable as a child because I insisted that everyone asks me questions. A talk is a more productive way to channel that energy.)</p>
</li>
</ul>
<hr>
<p>Combining these two internal motivations gives me a recipe for a personally satisfying talk: <strong>share an inspiring idea by re-explaining it in a simpler way</strong>.</p>
<hr>
<p>That is my formula. Yours might be different — think about it! Which talks made you feel in a special way? What are the structural similarities between them? (We’ll discuss the talk structure more in the next posts in this series.)</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/c1266/patronus.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 60.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAME/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAYs+agoiC//EABsQAAICAwEAAAAAAAAAAAAAAAECAAMQERIx/9oACAEBAAEFAk84Q1blbGHH/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BiP/EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAcEAABAwUAAAAAAAAAAAAAAAABAAIQERIhUWH/2gAIAQEABj8CRN9Hah/Mz//EABsQAQACAgMAAAAAAAAAAAAAAAEAESFhMUFx/9oACAEBAAE/ISb54uD7R7RFysPCZK6gYJ//2gAMAwEAAgADAAAAEPDv/8QAFREBAQAAAAAAAAAAAAAAAAAAECH/2gAIAQMBAT8Qgf/EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPxCgn//EABkQAQADAQEAAAAAAAAAAAAAAAEAESFBUf/aAAgBAQABPxBgAU0QDp7C27RQElo2twT6QlvHCaTVUBu8n//Z'); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"Luna Lovegood invoking a Patronus Charm. Image © 2007 Warner Bros. Ent\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/f8fb9/patronus.jpg\\"
        srcset=\\"https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/e8976/patronus.jpg 148w,https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/63df2/patronus.jpg 295w,https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/f8fb9/patronus.jpg 590w,https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/85e3d/patronus.jpg 885w,https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/d1924/patronus.jpg 1180w,https://overreacted.io/static/db2622db20b3b3b7774017caac1037ae/c1266/patronus.jpg 1200w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>

  </a>
    </p>
<p>Giving a talk that’s aligned with your motivations is helpful in several ways:</p>
<ol>
<li>
<p><strong>It’s easier to pick a topic.</strong> My formula is “explain an inspiring idea and why you should care about it”. I can create talk proposals by applying this formula to any interesting concept that I learned. I’ll always have something to talk about as long as I’m listening to smart people with good ideas that deserve more exposure. There are many other possible formulas — find yours.</p>
</li>
<li>
<p><strong>It’s less scary on stage.</strong> I get terrified 30 seconds before the talk but <em>the moment I start talking, I’m in my element</em>. The drive to share an inspiring idea overtakes the fear of being judged or doing something wrong. (Of course, this only works with good preparation which we’ll talk about in the next posts.)</p>
</li>
<li>
<p><strong>It’s more convincing.</strong> I can’t phrase it better than <a href=\\"https://mobile.twitter.com/sophiebits/status/1077723835481284608\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Sophie did</a>: if you’re enthusiastic about a topic, you can get the audience to care too. Enthusiasm doesn’t necessarily mean being loud or waving hands. Even if you’re calm, people can feel when there’s an emotional conviction behind a talk. (This is also why we can vibe to a <a href=\\"https://www.youtube.com/watch?v=6SWIwW9mg8s\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">song</a> even if we don’t understand the words.)</p>
</li>
</ol>
<hr>
<p>There’s one more reason it helps when you’re genuinely excited about a topic. Feeling that you’re a part of something bigger does wonders for confidence.</p>
<p>My talks aren’t about <em>me</em> — they’re about an idea, and I’m just a messenger. Thousands of people on the livestream and in the audience aren’t really there to judge me (even if they think so). They came to experience the idea that I brought to share. My role is just to be a conduit from one mind to another. A lot of nerves and pressure from the talks disappeared after internalizing this.</p>
<hr>
<p>Finding a formula that’s consistent with your motivations helps you establish your own voice. But how do you find a <em>specific</em> topic to which you can apply it?</p>
<p><strong>In my experience, good talks start as conversations.</strong> Somebody explains an idea to me, and then I try to explain it to someone else. I talk about it to a dozen people, and eventually I find explanations that “click”. Sometimes there’s a thought that seems neglected or misunderstood, and I try to get individual people to see it in a different light.</p>
<p>For me, a talk is just a way to generalize those conversations and make them one-to-many rather than one-to-one. It’s like a “library” you extract out of the “application code” of many in-person and social media conversations.</p>
<p>So if you want to give a great talk, <em>talking</em> to people is a good way to start.</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/db559/cauldron.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIEBQED/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAFne9TG5Okt54khX//EABwQAAICAgMAAAAAAAAAAAAAAAECABEDEgQjMf/aAAgBAQABBQLI3WwFt7l0hlTlOd9mssb/AP/EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAEDAQE/AWP/xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAgEBPwEI/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAECIRARMXH/2gAIAQEABj8Cl6RS7i3KQtPDpUdZ0//EABwQAAIDAQADAAAAAAAAAAAAAAABESExUUGBof/aAAgBAQABPyFSdO8HlptsXuSjQep4yrad/RJFtMgFDVWSj3bo7qf/2gAMAwEAAgADAAAAEMjvv//EABcRAAMBAAAAAAAAAAAAAAAAAAABMRD/2gAIAQMBAT8QaTXT/8QAFhEBAQEAAAAAAAAAAAAAAAAAEAFB/9oACAECAQE/ENCH/8QAHBABAAMAAwEBAAAAAAAAAAAAAQARITFBUWHx/9oACAEBAAE/EOSlczTd0xLS767H9g2EoxQY6GygDXg+oRjsBVdJWKT2uxXHT8xcygAAxRZa1nM//9k='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"Hermione Granger making a potion. Vials have text imposed on top: \\"motivations\\" and \\"conversations\\". Cauldron is a metaphor for your talk. Image © 2001 Warner Bros. Ent\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/f8fb9/cauldron.jpg\\"
        srcset=\\"https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/e8976/cauldron.jpg 148w,https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/63df2/cauldron.jpg 295w,https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/f8fb9/cauldron.jpg 590w,https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/db559/cauldron.jpg 640w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>

  </a>
    </p>
<hr>
<p>In this post, I described the framework that I find helpful for thinking about talk ideas. Again, I want to emphasize I’m just sharing what works for me — there are <a href=\\"https://mobile.twitter.com/jackiehluo/status/1077717283026411520\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">many kinds of talks</a> and your outlook on this may be very different.</p>
<p>In the next posts in this series, I will talk about preparing the talk outline, slides, rehearsing the talks, and what I do on the day of the presentation.</p>
<p><strong>Next in this series: <a href=\\"https://overreacted.io/preparing-for-tech-talk-part-2-what-why-and-how/\\">Preparing for a Tech Talk, Part 2: What, Why, and How</a></strong>.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/preparing-for-tech-talk-part-1-motivation/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Why Do React Hooks Rely on Call Order?",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Lessons learned from mixins, render props, HOCs, and classes.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-do-hooks-rely-on-call-order/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-do-hooks-rely-on-call-order/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Thu, 13 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>At React Conf 2018, the React team presented the <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hooks proposal</a>.</p>
<p>If you’d like to understand what Hooks are and what problems they solve, check out <a href=\\"https://www.youtube.com/watch?v=dpw9EHDh2bM\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">our talks</a> introducing them and <a href=\\"https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">my follow-up article</a> addressing common misconceptions.</p>
<p>Chances are you won’t like Hooks at first:</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/31287/hooks-hn1.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 19.826338639652676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1UlEQVQY01VQ266CMBDk/7/oJB5UKNDW0yLwIDExIl4QOCRG/YBxd6MPPkxmOzubTibo+yO67gDm67UVHscTHo9/wfM5Cd/v4xez/gG/b7eeMCAwJkaaLhFFM8RxiCRZII5+ZV6tElijZK/UHDpbIgx/oDXfLJCSlz0Z6bvdBpfLHkFdF2LIcwNrFZzTWK8tqsqjLB3pFrnXdJjC0459Wkcoij+ZvcvgvUFdl5I+YNFQCmalQjFWlZNkTbPFNHX0c0O1NDif91RJK0m4poHqGd4VsYe9L/zQGSMpPy/HAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"Negative HN comment\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/fb8a0/hooks-hn1.png\\"
        srcset=\\"https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/1a291/hooks-hn1.png 148w,https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/2bc4a/hooks-hn1.png 295w,https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/fb8a0/hooks-hn1.png 590w,https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/526de/hooks-hn1.png 885w,https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/fa2eb/hooks-hn1.png 1180w,https://overreacted.io/static/d498863e7382b4d5ee4d8753e6e74a1e/31287/hooks-hn1.png 1382w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>

  </a>
    </p>
<p>They’re like a music record that grows on you only after a few good listens:</p>
<p>
  <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/224d4/hooks-hn2.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >

  <span
    class=\\"gatsby-resp-image-wrapper\\"
    style=\\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\\"
  >
    <span
      class=\\"gatsby-resp-image-background-image\\"
      style=\\"padding-bottom: 23.871906841339154%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBklEQVQY0z1Q2XKCQBDk//8nFcsCUwJyhuUIBEuFeKBERcHyeuzMTkIeunp7pmd7apTNpsB2+4W6XqGqSuIljscKl8uB0bbfzF13+OM91fb//d5zvTZ4PFooInAQChdCOHBdA75v8TsIbCRJgDj2WUeRR70JfG8Cx9ZJ+9wLaN5zTf6j3i2hSNEP9RyGLqLQowAT6YdgyKAsC3/D3m0OlD4ZwEuRv2l2UIbDF5jmG0bagNm2xtDUAcZjFbquEWswjBFU9RW6rBFkkOPosMhrUs+mjaV3vV5Amc8zrFZzTPMEeR5jNkuJE+aynKIociwWn6zTVOB0rvF8drjfzwx5t9vtxJB3/AEwKl21CwjATgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\"
    >
      <img
        class=\\"gatsby-resp-image-image\\"
        style=\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\"
        alt=\\"Positive HN comment from the same person four days later\\"
        title=\\"\\"
        src=\\"https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/fb8a0/hooks-hn2.png\\"
        srcset=\\"https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/1a291/hooks-hn2.png 148w,https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/2bc4a/hooks-hn2.png 295w,https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/fb8a0/hooks-hn2.png 590w,https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/526de/hooks-hn2.png 885w,https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/fa2eb/hooks-hn2.png 1180w,https://overreacted.io/static/b31774c3ef4f2239bf9e62fe9272662b/224d4/hooks-hn2.png 1374w\\"
        sizes=\\"(max-width: 590px) 100vw, 590px\\"
      />
    </span>
  </span>

  </a>
    </p>
<p>When you read the docs, don’t miss <a href=\\"https://reactjs.org/docs/hooks-custom.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">the most important page</a> about building your own Hooks! Too many people get fixated on some part of our messaging they disagree with (e.g. that learning classes is difficult) and miss the bigger picture behind Hooks. And the bigger picture is that <strong>Hooks are like <em>functional mixins</em> that let you create and compose your own abstractions.</strong></p>
<p>Hooks <a href=\\"https://reactjs.org/docs/hooks-faq.html#what-is-the-prior-art-for-hooks\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">are influenced by some prior art</a> but I haven’t seen anything <em>quite</em> like them until Sebastian shared his idea with the team. Unfortunately, it’s easy to overlook the connection between the specific API choices and the valuable properties unlocked by this design. With this post I hope to help more people understand the rationale for the most controversial aspect of Hooks proposal.</p>
<p><strong>The rest of this post assumes you know the <code class=\\"language-text\\">useState()</code> Hook API and how to write a custom Hook. If you don’t, check out the earlier links. Also, keep in mind Hooks are experimental and you don’t have to learn them right now!</strong></p>
<p>(Disclaimer: this is a personal post and doesn’t necessarily reflect the opinions of the React team. It’s large, the topic is complex, and I may have made mistakes somewhere.)</p>
<hr>
<p>The first and probably the biggest shock when you learn about Hooks is that they rely on <em>persistent call index between re-renders</em>. This has some <a href=\\"https://reactjs.org/docs/hooks-rules.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">implications</a>.</p>
<p>This decision is obviously controversial. This is why, <a href=\\"https://www.reddit.com/r/reactjs/comments/9xs2r6/sebmarkbages_response_to_hooks_rfc_feedback/e9wh4um/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">against our principles</a>, we only published this proposal after we felt the documentation and talks describe it well enough for people to give it a fair chance.</p>
<p><strong>If you’re concerned about some aspects of the Hooks API design, I encourage you to read Sebastian’s <a href=\\"https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">full response</a> to the 1,000+ comment RFC discussion.</strong> It is thorough but also quite dense. I could probably turn every paragraph of this comment into its own blog post. (In fact, I already <a href=\\"https://overreacted.io/how-does-setstate-know-what-to-do/\\">did</a> that once!)</p>
<p>There is one specific part that I’d like to focus on today. As you may recall, each Hook can be used in a component more than once. For example, we can declare <a href=\\"https://reactjs.org/docs/hooks-state.html#tip-using-multiple-state-variables\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">multiple state variables</a> by calling <code class=\\"language-text\\">useState()</code> repeatedly:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>name<span class=\\"token punctuation\\">,</span> setName<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Mary'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>              <span class=\\"token comment\\">// State variable 1</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>surname<span class=\\"token punctuation\\">,</span> setSurname<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Poppins'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>     <span class=\\"token comment\\">// State variable 2</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// State variable 3</span></span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleResize</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setWidth</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handleResize<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handleResize<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleNameChange</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setName</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleSurnameChange</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">setSurname</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>name<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">onChange</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>handleNameChange<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>surname<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">onChange</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>handleSurnameChange<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello, </span><span class=\\"token punctuation\\">{</span>name<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"> </span><span class=\\"token punctuation\\">{</span>surname<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Window width: </span><span class=\\"token punctuation\\">{</span>width<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Note that we use array destructuring syntax to name <code class=\\"language-text\\">useState()</code> state variables but these names are not passed to React. Instead, in this example <strong>React treats <code class=\\"language-text\\">name</code> as “the first state variable”, <code class=\\"language-text\\">surname</code> as “the second state variable”, and so on</strong>. Their <em>call index</em> is what gives them a stable identity between re-renders. This mental model is well-described <a href=\\"https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">in this article</a>.</p>
<p>On a surface level, relying on the call index just <em>feels wrong</em>. A gut feeling is a useful signal but it can be misleading — especially if we haven’t fully internalized the problem we’re solving. <strong>In this post, I’ll take a few commonly suggested alternative designs for Hooks and show where they break down.</strong></p>
<hr>
<p>This post won’t be exhaustive. Depending on how granular you’re counting, we’ve seen from a dozen to <em>hundreds</em> of different alternative proposals. We’ve also been <a href=\\"https://github.com/reactjs/react-future\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">thinking</a> about alternative component APIs for the last five years.</p>
<p>Blog posts like this are tricky because even if you cover a hundred alternatives, somebody can tweak one and say: “Ha, you didn’t think of <em>that</em>!”</p>
<p>In practice, different alternative proposals tend to overlap in their downsides. Rather than enumerate <em>all</em> the suggested APIs (which would take me months), I’ll demonstrate the most common flaws with specific examples. Categorizing other possible APIs by these problems could be an exercise to the reader. 🧐</p>
<p><em>That is not to say that Hooks are flawless.</em> But once you get familiar with the flaws of other solutions, you might find that the Hooks design makes some sense.</p>
<hr>
<h3 id=\\"flaw-1-cant-extract-a-custom-hook\\"><a href=\\"#flaw-1-cant-extract-a-custom-hook\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #1: Can’t Extract a Custom Hook</h3>
<p>Surprisingly, many alternative proposals don’t allow <a href=\\"https://reactjs.org/docs/hooks-custom.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">custom Hooks</a> at all. Perhaps we didn’t emphasize custom Hooks enough in the “motivation” docs. It’s difficult to do until the primitives are well-understood. So it’s a chicken-and-egg problem. But custom Hooks are largely the point of the proposal.</p>
<p>For example, an alternative banned multiple <code class=\\"language-text\\">useState()</code> calls in a component. You’d keep state in one object. That works for classes, right?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>state<span class=\\"token punctuation\\">,</span> setState<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
    name<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Mary'</span><span class=\\"token punctuation\\">,</span>
    surname<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Poppins'</span><span class=\\"token punctuation\\">,</span>
    width<span class=\\"token punctuation\\">:</span> window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>To be clear, Hooks <em>do</em> allow this style. You don’t <em>have to</em> split your state into a bunch of state variables (see our <a href=\\"https://reactjs.org/docs/hooks-faq.html#should-i-use-one-or-many-state-variables\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">recommendations</a> in the FAQ).</p>
<p>But the point of supporting multiple <code class=\\"language-text\\">useState()</code> calls is so that you can <em>extract</em> parts of stateful logic (state + effects) out of your components into custom Hooks which can <em>also</em> independently use local state and effects:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Declare some state variables directly in component body</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>name<span class=\\"token punctuation\\">,</span> setName<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Mary'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>surname<span class=\\"token punctuation\\">,</span> setSurname<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Poppins'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// We moved some state and effects into a custom Hook</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Declare some state and effects in a custom Hook</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>window<span class=\\"token punctuation\\">.</span>innerWidth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// ...</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> width<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>If you only allow one <code class=\\"language-text\\">useState()</code> call per component, you lose the ability of custom Hooks to introduce local state. Which is the point of custom Hooks.</p>
<h3 id=\\"flaw-2-name-clashes\\"><a href=\\"#flaw-2-name-clashes\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #2: Name Clashes</h3>
<p>One common suggestion is to let <code class=\\"language-text\\">useState()</code> accept a key argument (e.g. a string) that uniquely identifies a particular state variable within a component.</p>
<p>There are a few variations on this idea, but they roughly look like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// We pass some kind of state key to useState()</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>name<span class=\\"token punctuation\\">,</span> setName<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>surname<span class=\\"token punctuation\\">,</span> setSurname<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'surname'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'width'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span></code></pre></div>
<p>This tries to avoid reliance on the call index (yay explicit keys!) but introduces another problem — name clashes.</p>
<p>Granted, you probably won’t be tempted to call <code class=\\"language-text\\">useState(&#39;name&#39;)</code> twice in the same component except by mistake. This can happen accidentally but we could argue that about any bug. However, it’s quite likely that when you work on a <em>custom Hook</em>, you’ll want to add or remove state variables and effects.</p>
<p>With this proposal, any time you add a new state variable inside a custom Hook, you risk breaking any components that use it (directly or transitively) because <em>they might already use the same name</em> for their own state variables.</p>
<p>This is an example of an API that’s not <a href=\\"https://overreacted.io/optimized-for-change/\\">optimized for change</a>. The current code might always look “elegant”, but it is very fragile to changes in requirements. We should <a href=\\"https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html#mixins-cause-name-clashes\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">learn</a> from our mistakes.</p>
<p>The actual Hooks proposal solves this by relying on the call order: even if two Hooks use a <code class=\\"language-text\\">name</code> state variable, they would be isolated from each other. Every <code class=\\"language-text\\">useState()</code> call gets its own “memory cell”.</p>
<p>There are still a few other ways we could work around this flaw but they also have their own issues. Let’s explore this problem space more closely.</p>
<h3 id=\\"flaw-3-cant-call-the-same-hook-twice\\"><a href=\\"#flaw-3-cant-call-the-same-hook-twice\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #3: Can’t Call the Same Hook Twice</h3>
<p>Another variation of the “keyed” <code class=\\"language-text\\">useState</code> proposal is to use something like Symbols. Those can’t clash, right?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">const</span> nameKey <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Symbol</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> surnameKey <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Symbol</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> widthKey <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Symbol</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// We pass some kind of state key to useState()</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>name<span class=\\"token punctuation\\">,</span> setName<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>nameKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>surname<span class=\\"token punctuation\\">,</span> setSurname<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>surnameKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>widthKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span></code></pre></div>
<p>This proposal seems to work for extracting the <code class=\\"language-text\\">useWindowWidth()</code> Hook:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">/*********************
 * useWindowWidth.js *
 ********************/</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">const</span> widthKey <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Symbol</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"> </span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>width<span class=\\"token punctuation\\">,</span> setWidth<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>widthKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// ...</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">return</span> width<span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token punctuation\\">}</span></span></code></pre></div>
<p>But if we attempt to extract input handling, it would fail:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> name <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> surname <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token comment\\">// ...</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token spread\\"><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">...</span><span class=\\"token attr-value\\">name</span><span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token spread\\"><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">...</span><span class=\\"token attr-value\\">surname</span><span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span><span class=\\"token comment\\">/* ... */</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">/*******************
 * useFormInput.js *
 ******************/</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">const</span> valueKey <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Symbol</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"> </span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>value<span class=\\"token punctuation\\">,</span> setValue<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>valueKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    value<span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">onChange</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token function\\">setValue</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token punctuation\\">}</span></span></code></pre></div>
<p>(I’ll admit this <code class=\\"language-text\\">useFormInput()</code> Hook isn’t particularly useful but you could imagine it handling things like validation and dirty state flag a la <a href=\\"https://github.com/jaredpalmer/formik\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Formik</a>.)</p>
<p>Can you spot the bug?</p>
<p>We’re calling <code class=\\"language-text\\">useFormInput()</code> twice but our <code class=\\"language-text\\">useFormInput()</code> always calls <code class=\\"language-text\\">useState()</code> with the same key. So effectively we’re doing something like:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>name<span class=\\"token punctuation\\">,</span> setName<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>valueKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>surname<span class=\\"token punctuation\\">,</span> setSurname<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>valueKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>And this is how we get a clash again.</p>
<p>The actual Hooks proposal doesn’t have this problem because <strong>each <em>call</em> to <code class=\\"language-text\\">useState()</code> gets its own isolated state.</strong> Relying on a persistent call index frees us from worrying about name clashes.</p>
<h3 id=\\"flaw-4-the-diamond-problem\\"><a href=\\"#flaw-4-the-diamond-problem\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #4: The Diamond Problem</h3>
<p>This is technically the same flaw as the previous one but it’s worth mentioning for its notoriety. It’s even <a href=\\"https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">described on Wikipedia</a>. (Apparently, it’s sometimes called “the deadly diamond of death” — cool beans.)</p>
<p>Our own mixin system <a href=\\"https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html#mixins-cause-name-clashes\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">suffered from it</a>.</p>
<p>Two custom Hooks like <code class=\\"language-text\\">useWindowWidth()</code> and <code class=\\"language-text\\">useNetworkStatus()</code> might want to use the same custom Hook like <code class=\\"language-text\\">useSubscription()</code> under the hood:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">StatusMessage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> isOnline <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useNetworkStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Window width is </span><span class=\\"token punctuation\\">{</span>width<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">You are </span><span class=\\"token punctuation\\">{</span>isOnline <span class=\\"token operator\\">?</span> <span class=\\"token string\\">'online'</span> <span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'offline'</span><span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useSubscription</span><span class=\\"token punctuation\\">(</span>subscribe<span class=\\"token punctuation\\">,</span> unsubscribe<span class=\\"token punctuation\\">,</span> getValue<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>state<span class=\\"token punctuation\\">,</span> setState<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">getValue</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleChange</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">getValue</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">subscribe</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">unsubscribe</span><span class=\\"token punctuation\\">(</span>handleChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> state<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useWindowWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> width <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSubscription</span><span class=\\"token punctuation\\">(</span></span><span class=\\"gatsby-highlight-code-line\\">    handler <span class=\\"token operator\\">=></span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    handler <span class=\\"token operator\\">=></span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'resize'</span><span class=\\"token punctuation\\">,</span> handler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> window<span class=\\"token punctuation\\">.</span>innerWidth</span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">return</span> width<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useNetworkStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> isOnline <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSubscription</span><span class=\\"token punctuation\\">(</span></span><span class=\\"gatsby-highlight-code-line\\">    handler <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'online'</span><span class=\\"token punctuation\\">,</span> handler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">addEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'offline'</span><span class=\\"token punctuation\\">,</span> handler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    handler <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'online'</span><span class=\\"token punctuation\\">,</span> handler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">removeEventListener</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'offline'</span><span class=\\"token punctuation\\">,</span> handler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> navigator<span class=\\"token punctuation\\">.</span>onLine</span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">return</span> isOnline<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This is a completely valid use case. <strong>It should be safe for a custom Hook author to start or stop using another custom Hook without worrying whether it is “already used” somewhere in the chain.</strong> In fact, <em>you can never know</em> the whole chain unless you audit every component using your Hook on every change.</p>
<p>(As a counterexample, the legacy React <code class=\\"language-text\\">createClass()</code> mixins did not let you do this. Sometimes you’d have two mixins that both do exactly what you need but are mutually incompatible due to extending the same “base” mixin.)</p>
<p>This is our “diamond”: 💎</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">       / useWindowWidth()   \\\\                   / useState()  🔴 Clash
Status                        useSubscription()
       \\\\ useNetworkStatus() /                   \\\\ useEffect() 🔴 Clash</code></pre></div>
<p>Reliance on the persistent call order naturally resolves it:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">                                                 / useState()  ✅ #1. State
       / useWindowWidth()   -&gt; useSubscription()
      /                                          \\\\ useEffect() ✅ #2. Effect
Status
      \\\\                                          / useState()  ✅ #3. State
       \\\\ useNetworkStatus() -&gt; useSubscription()
                                                 \\\\ useEffect() ✅ #4. Effect</code></pre></div>
<p>Function calls don’t have a “diamond” problem because they form a tree. 🎄 </p>
<h3 id=\\"flaw-5-copy-paste-breaks-things\\"><a href=\\"#flaw-5-copy-paste-breaks-things\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #5: Copy Paste Breaks Things</h3>
<p>Maybe we could salvage the keyed state proposal by introducing some sort of namespacing. There are a few different ways to do it.</p>
<p>One way could be to isolate state keys with closures. This would require you to “instantiate” custom Hooks and add a function wrapper around each of them:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">/*******************
 * useFormInput.js *
 ******************/</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createUseFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// Unique per instantiation</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> valueKey <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Symbol</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>  </span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>value<span class=\\"token punctuation\\">,</span> setValue<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>valueKey<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">{</span>
      value<span class=\\"token punctuation\\">,</span>
      <span class=\\"token function\\">onChange</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token function\\">setValue</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This approach is rather heavy-handed. One of the design goals of Hooks is to avoid the deeply nested functional style that is prevalent with higher-order components and render props. Here, we have to “instantiate” <em>any</em> custom Hook before its use — and use the resulting function <em>exactly once</em> in the body of a component. This isn’t much simpler than calling Hooks unconditionally.</p>
<p>Additionally, you have to repeat every custom Hook used in a component twice. Once in the top level scope (or inside a function scope if we’re writing a custom Hook), and once at the actual call site. This means you have to jump between the rendering and top-level declarations even for small changes:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">const</span> useNameFormInput <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createUseFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">const</span> useSurnameFormInput <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createUseFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> name <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useNameFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> surname <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useNameFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>You also need to be very precise with their names. You would always have “two levels” of names — factories like <code class=\\"language-text\\">createUseFormInput</code> and the instantiated Hooks like <code class=\\"language-text\\">useNameFormInput</code> and <code class=\\"language-text\\">useSurnameFormInput</code>.</p>
<p>If you call the same custom Hook “instance” twice you’d get a state clash. In fact, the code above has this mistake — have you noticed? It should be:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> name <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useNameFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> surname <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSurnameFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Not useNameFormInput!</span></code></pre></div>
<p>These problems are not insurmountable but I would argue that they add <em>more</em> friction than following the <a href=\\"https://reactjs.org/docs/hooks-rules.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Rules of Hooks</a>.</p>
<p>Importantly, they break the expectations of copy-paste. Extracting a custom Hook without an extra closure wrapper <em>still works</em> with this approach but only until you call it twice. (Which is when it creates a conflict.) It’s unfortunate when an API seems to work but then forces you to Wrap All the Things™️ once you realize there is a conflict somewhere deep down the chain.</p>
<h3 id=\\"flaw-6-we-still-need-a-linter\\"><a href=\\"#flaw-6-we-still-need-a-linter\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #6: We Still Need a Linter</h3>
<p>There is another way to avoid conflicts with keyed state. If you know about it, you were probably really annoyed I still haven’t acknowledged it! Sorry.</p>
<p>The idea is that we could <em>compose</em> keys every time we write a custom Hook. Something like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Form</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> name <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> surname <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'surname'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token comment\\">// ...</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token spread\\"><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">...</span><span class=\\"token attr-value\\">name</span><span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token spread\\"><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">...</span><span class=\\"token attr-value\\">surname</span><span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token punctuation\\">{</span><span class=\\"token comment\\">/* ... */</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useFormInput</span><span class=\\"token punctuation\\">(</span>formInputKey<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>value<span class=\\"token punctuation\\">,</span> setValue<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'useFormInput('</span> <span class=\\"token operator\\">+</span> formInputKey <span class=\\"token operator\\">+</span> <span class=\\"token string\\">').value'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">{</span>
    value<span class=\\"token punctuation\\">,</span>
    <span class=\\"token function\\">onChange</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">setValue</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Out of different alternatives, I dislike this approach the least. I don’t think it’s worth it though.</p>
<p>Code passing non-unique or badly composed keys would <em>accidentally work</em> until a Hook is called multiple times or clashes with another Hook. Worse, if it’s meant to be conditional (we’re trying to “fix” the unconditional call requirement, right?), we might not even encounter the clashes until later.</p>
<p>Remembering to pass keys through all layers of custom Hooks seems fragile enough that we’d want to lint for that. They would add extra work at runtime (don’t forget they’d need to serve <em>as keys</em>), and each of them is a paper cut for bundle size. <strong>But if we have to lint anyway, what problem did we solve?</strong></p>
<p>This might make sense if conditionally declaring state and effects was very desirable. But in practice I find it confusing. In fact, I don’t recall anyone ever asking to conditionally define <code class=\\"language-text\\">this.state</code> or <code class=\\"language-text\\">componentDidMount</code> either.</p>
<p>What does this code mean exactly?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">.</span>isActive<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'count'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
      <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Is <code class=\\"language-text\\">count</code> preserved when <code class=\\"language-text\\">props.isActive</code> is <code class=\\"language-text\\">false</code>? Or does it get reset because <code class=\\"language-text\\">useState(&#39;count&#39;)</code> wasn’t called?</p>
<p>If conditional state gets preserved, what about an effect?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// ⚠️ This is NOT the React Hooks API</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">.</span>isActive<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>count<span class=\\"token punctuation\\">,</span> setCount<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'count'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token keyword\\">const</span> id <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>c <span class=\\"token operator\\">=></span> c <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
      <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setCount</span><span class=\\"token punctuation\\">(</span>count <span class=\\"token operator\\">+</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        </span><span class=\\"token punctuation\\">{</span>count<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>It definitely can’t run <em>before</em> <code class=\\"language-text\\">props.isActive</code> is <code class=\\"language-text\\">true</code> for the first time. But once it becomes <code class=\\"language-text\\">true</code>, does it ever stop running? Does the interval reset when <code class=\\"language-text\\">props.isActive</code> flips to <code class=\\"language-text\\">false</code>? If it does, it’s confusing that effect behaves differently from state (which we said wouldn’t reset). If the effect keeps running, it’s confusing that <code class=\\"language-text\\">if</code> outside the effect doesn’t actually make the effect conditional. Didn’t we say we wanted conditional effects?</p>
<p>If the state <em>does</em> get reset when we don’t “use” it during a render, what happens if multiple <code class=\\"language-text\\">if</code> branches contain <code class=\\"language-text\\">useState(&#39;count&#39;)</code> but only one runs at any given time? Is that valid code? If our mental model is a “map with keys”, why do things “disappear” from it? Would the developer expect an early <code class=\\"language-text\\">return</code> from a component to reset all state after it? If we truly wanted to reset the state, we could make it explicit by extracting a component:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">.</span>isActive<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// Clearly has its own state</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>TickingCounter</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>That would probably become the “best practice” to avoid these confusing questions anyway. So whichever way you choose to answer them, I think the semantics of conditionally <em>declaring</em> state and effects itself end up weird enough that you might want to lint against it.</p>
<p>If we have to lint anyway, the requirement to correctly compose keys becomes “dead weight”. It doesn’t buy us anything we actually <em>want</em> to do. However, dropping that requirement (and going back to the original proposal) <em>does</em> buy us something. It makes copy-pasting component code into a custom Hook safe without namespacing it, reduces bundle size paper cuts from keys and unlocks a slightly more efficient implementation (no need for Map lookups).</p>
<p>Small things add up.</p>
<h3 id=\\"flaw-7-cant-pass-values-between-hooks\\"><a href=\\"#flaw-7-cant-pass-values-between-hooks\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #7: Can’t Pass Values Between Hooks</h3>
<p>One of the best features of Hooks is that you can pass values between them.</p>
<p>Here is a hypothetical example of a message recipient picker that shows whether the currently chosen friend is online:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">const</span> friendList <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>
  <span class=\\"token punctuation\\">{</span> id<span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> name<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Phoebe'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">{</span> id<span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">,</span> name<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Rachel'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">{</span> id<span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">3</span><span class=\\"token punctuation\\">,</span> name<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Ross'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">ChatRecipientPicker</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>recipientID<span class=\\"token punctuation\\">,</span> setRecipientID<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> isRecipientOnline <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFriendStatus</span><span class=\\"token punctuation\\">(</span>recipientID<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Circle</span> <span class=\\"token attr-name\\">color</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>isRecipientOnline <span class=\\"token operator\\">?</span> <span class=\\"token string\\">'green'</span> <span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'red'</span><span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>select</span>
        <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>recipientID<span class=\\"token punctuation\\">}</span></span>
        <span class=\\"token attr-name\\">onChange</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>e <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setRecipientID</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">Number</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span></span>
      <span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        </span><span class=\\"token punctuation\\">{</span>friendList<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span>friend <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">(</span>
          <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>option</span> <span class=\\"token attr-name\\">key</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">.</span>id<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">.</span>id<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">            </span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">          </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>option</span><span class=\\"token punctuation\\">></span></span>
        <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>select</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">useFriendStatus</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>isOnline<span class=\\"token punctuation\\">,</span> setIsOnline<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleStatusChange</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>status<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setIsOnline</span><span class=\\"token punctuation\\">(</span>status<span class=\\"token punctuation\\">.</span>isOnline<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    ChatAPI<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">subscribeToFriendStatus</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">,</span> handleStatusChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      ChatAPI<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">unsubscribeFromFriendStatus</span><span class=\\"token punctuation\\">(</span>friendID<span class=\\"token punctuation\\">,</span> handleStatusChange<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> isOnline<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>When you change the recipient, our <code class=\\"language-text\\">useFriendStatus()</code> Hook would unsubscribe from the previous friend’s status, and subscribe to the next one.</p>
<p>This works because we can pass the return value of the <code class=\\"language-text\\">useState()</code> Hook to the <code class=\\"language-text\\">useFriendStatus()</code> Hook:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>recipientID<span class=\\"token punctuation\\">,</span> setRecipientID<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> isRecipientOnline <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useFriendStatus</span><span class=\\"token punctuation\\">(</span>recipientID<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>Passing values between Hooks is very powerful. For example, <a href=\\"https://medium.com/@drcmda/hooks-in-react-spring-a-tutorial-c6c436ad7ee4\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">React Spring</a> lets you create a trailing animation of several values “following” each other:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span> pos1 <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSpring</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> pos1<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> config<span class=\\"token punctuation\\">:</span> fast <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span> pos2 <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSpring</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> pos2<span class=\\"token punctuation\\">:</span> pos1<span class=\\"token punctuation\\">,</span> config<span class=\\"token punctuation\\">:</span> slow <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span> pos3 <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSpring</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> pos3<span class=\\"token punctuation\\">:</span> pos2<span class=\\"token punctuation\\">,</span> config<span class=\\"token punctuation\\">:</span> slow <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>(Here’s a <a href=\\"https://codesandbox.io/s/ppxnl191zx\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">demo</a>.)</p>
<p>Proposals that put Hook initialization into default argument values or that write Hooks in a decorator form make it difficult to express this kind of logic.</p>
<p>If calling Hooks doesn’t happen in the function body, you can no longer easily pass values between them, transform those values without creating many layers of components, or add <code class=\\"language-text\\">useMemo()</code> to memoize an intermediate computation. You also can’t easily reference these values in effects because they can’t capture them in a closure. There are ways to work around these issues with some convention but they require you to mentally “match up” inputs and outputs. This is tricky and violates React’s otherwise direct style.</p>
<p>Passing values between Hooks is at the heart of our proposal. Render props pattern was the closest you could get to it without Hooks, but you couldn’t get full benefits without something like <a href=\\"https://ui.reach.tech/component-component\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Component Component</a> which has a lot of syntactic noise due to a “false hierarchy”. Hooks flatten that hierarchy to passing values — and function calls is the simplest way to do that.</p>
<h3 id=\\"flaw-8-too-much-ceremony\\"><a href=\\"#flaw-8-too-much-ceremony\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Flaw #8: Too Much Ceremony</h3>
<p>There are many proposals that fall under this umbrella. Most attempt to avoid the perceived dependency of Hooks on React. There is a wide variety of ways to do it: by making built-in Hooks available on <code class=\\"language-text\\">this</code>, making them an extra argument you have to pass through everything, and so on.</p>
<p>I think <a href=\\"https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Sebastian’s answer</a> addresses this way better than I could describe so I encourage you to check out its first section (“Injection Model”).</p>
<p>I’ll just say there is a reason programmers tend to prefer <code class=\\"language-text\\">try</code> / <code class=\\"language-text\\">catch</code> for error handling to passing error codes through every function. It’s the same reason why we prefer ES Modules with <code class=\\"language-text\\">import</code> (or CommonJS <code class=\\"language-text\\">require</code>) to AMD’s “explicit” definitions where <code class=\\"language-text\\">require</code> is passed to us.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Anyone miss AMD?</span>
<span class=\\"token function\\">define</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'require'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'dependency1'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'dependency2'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span>require<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">var</span> dependency1 <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'dependency1'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token keyword\\">var</span> dependency2 <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'dependency2'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">function</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>Yes, AMD may be more “honest” to the fact that modules aren’t actually synchronously loaded in a browser environment. But once you learn about that, writing the <code class=\\"language-text\\">define</code> sandwich becomes a mindless chore.</p>
<p><code class=\\"language-text\\">try</code> / <code class=\\"language-text\\">catch</code>, <code class=\\"language-text\\">require</code>, and React Context API are pragmatic examples of how we want to have some “ambient” handler available to us instead of explicitly threading it through every level — even if in general we value explicitness. I think the same is true for Hooks.</p>
<p>This is similar to how, when we define components, we just grab <code class=\\"language-text\\">Component</code> from <code class=\\"language-text\\">React</code>. Maybe our code would be more decoupled from React if we exported a factory for every component instead:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createModal</span><span class=\\"token punctuation\\">(</span>React<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Modal</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// ...</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>But in practice this ends up being just an annoying indirection. When we actually want to stub React with something else, we can always do that at the module system level instead.</p>
<p>The same applies to Hooks. Still, as <a href=\\"https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Sebastian’s answer</a> mentions, it is <em>technically possible</em> to “redirect” Hooks exported from <code class=\\"language-text\\">react</code> to a different implementation. (<a href=\\"https://overreacted.io/how-does-setstate-know-what-to-do/\\">One of my previous posts</a> mentions how.)</p>
<p>Another way to impose more ceremony is by making Hooks <a href=\\"https://paulgray.net/an-alternative-design-for-hooks/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">monadic</a> or adding a first-class concept like <code class=\\"language-text\\">React.createHook()</code>. Aside from the runtime overhead, any solution that adds wrappers loses a huge benefit of using plain functions: <em>they are as easy to debug as it gets</em>.</p>
<p>Plain functions let you step in and out with a debugger without any library code in the middle, and see exactly how values flow inside your component body. Indirections make this difficult. Solutions similar in spirit to either higher-order components (“decorator” Hooks) or render props (e.g. <code class=\\"language-text\\">adopt</code> proposal or <code class=\\"language-text\\">yield</code>ing from generators) suffer from the same problem. Indirections also complicate static typing.</p>
<hr>
<p>As I mentioned earlier, this post doesn’t aim to be exhaustive. There are other interesting problems with different proposals. Some of them are more obscure (e.g. related to concurrency or advanced compilation techniques) and might be a topic for another blog post in the future.</p>
<p>Hooks aren’t perfect either, but it’s the best tradeoff we could find for solving these problems. There are things we <a href=\\"https://github.com/reactjs/rfcs/pull/68#issuecomment-440780509\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">still need to fix</a>, and there exist things that are more awkward with Hooks than classes. That is also a topic for another blog post.</p>
<p>Whether I covered your favorite alternative proposal or not, I hope this writeup helped shed some light on our thinking process and the criteria we consider when choosing an API. As you can see, a lot of it (such as making sure that copy-pasting, moving code, adding and removing dependencies works as expected) has to do with <a href=\\"https://overreacted.io/optimized-for-change/\\">optimizing for change</a>. I hope that React users will appreciate these aspects.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/why-do-hooks-rely-on-call-order/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Optimized for Change",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "What makes a great API?",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/optimized-for-change/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/optimized-for-change/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Wed, 12 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>What makes a great API?</p>
<p><em>Good</em> API design is memorable and unambiguous. It encourages readable, correct and performant code, and helps developers fall into <a href=\\"https://blog.codinghorror.com/falling-into-the-pit-of-success/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">the pit of success</a>.</p>
<p>I call these design aspects “first order” because they are the first things a library developer tends to focus on. You might have to compromise on some of them and make tradeoffs but at least they’re always on your mind.</p>
<p>However, unless you’re sending a rover to Mars, your code will probably change over time. And so will the code of your API consumers.</p>
<p>The best API designers I know don’t stop at the “first order” aspects like readability. They dedicate just as much, if not more, effort to what I call the “second order” API design: <strong>how code using this API would evolve over time.</strong></p>
<p>A slight change in requirements can make the most elegant code fall apart.</p>
<p><em>Great</em> APIs anticipate that. They anticipate that you’ll want to move some code. Copy and paste some part. Rename it. Unify special cases into a generic reusable helper. Unwind an abstraction back into specific cases. Add a hack. Optimize a bottleneck. Throw away a part and start it anew. Make a mistake. Navigate between the cause and the effect. Fix a bug. Review the fix.</p>
<p>Great APIs not only let you fall into a pit of success, but help you <em>stay</em> there.</p>
<p>They’re optimized for change.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/optimized-for-change/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "How Does setState Know What to Do?",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Dependency injection is nice if you don’t have to think about it.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/how-does-setstate-know-what-to-do/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/how-does-setstate-know-what-to-do/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Sun, 09 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>When you call <code class=\\"language-text\\">setState</code> in a component, what do you think happens?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">import</span> React <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'react'</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">import</span> ReactDOM <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'react-dom'</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Button</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> clicked<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">false</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>handleClick <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>handleClick<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">bind</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token function\\">handleClick</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> clicked<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state<span class=\\"token punctuation\\">.</span>clicked<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Thanks</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
      <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">onClick</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>handleClick<span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">        Click me!</span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span>
    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

ReactDOM<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Button</span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token punctuation\\">,</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'container'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>Sure, React re-renders the component with the next <code class=\\"language-text\\">{ clicked: true }</code> state and updates the DOM to match the returned <code class=\\"language-text\\">&lt;h1&gt;Thanks&lt;/h1&gt;</code> element.</p>
<p>Seems straightforward. But wait, does <em>React</em> do it? Or <em>React DOM</em>?</p>
<p>Updating the DOM sounds like something React DOM would be responsible for. But we’re calling <code class=\\"language-text\\">this.setState()</code>, not something from React DOM. And our <code class=\\"language-text\\">React.Component</code> base class is defined inside React itself.</p>
<p>So how can <code class=\\"language-text\\">setState()</code> inside <code class=\\"language-text\\">React.Component</code> update the DOM?</p>
<p><strong>Disclaimer: Just like <a href=\\"https://overreacted.io/why-do-react-elements-have-typeof-property/\\">most</a> <a href=\\"https://overreacted.io/how-does-react-tell-a-class-from-a-function/\\">other</a> <a href=\\"https://overreacted.io/why-do-we-write-super-props/\\">posts</a> on this blog, you don’t actually <em>need</em> to know any of that to be productive with React. This post is for those who like to see what’s behind the curtain. Completely optional!</strong></p>
<hr>
<p>We might think that the <code class=\\"language-text\\">React.Component</code> class contains DOM update logic.</p>
<p>But if that were the case, how can <code class=\\"language-text\\">this.setState()</code> work in other environments? For example, components in React Native apps also extend <code class=\\"language-text\\">React.Component</code>. They call <code class=\\"language-text\\">this.setState()</code> just like we did above, and yet React Native works with Android and iOS native views instead of the DOM.</p>
<p>You might also be familiar with React Test Renderer or Shallow Renderer. Both of these testing strategies let you render normal components and call <code class=\\"language-text\\">this.setState()</code> inside them. But neither of them works with the DOM.</p>
<p>If you used renderers like <a href=\\"https://github.com/facebook/react/tree/master/packages/react-art\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">React ART</a>, you might also know that it’s possible to use more than one renderer on the page. (For example, ART components work inside a React DOM tree.) This makes a global flag or variable untenable.</p>
<p>So somehow <strong><code class=\\"language-text\\">React.Component</code> delegates handling state updates to the platform-specific code.</strong> Before we can understand how this happens, let’s dig deeper into how packages are separated and why.</p>
<hr>
<p>There is a common misconception that the React “engine” lives inside the <code class=\\"language-text\\">react</code> package. This is not true.</p>
<p>In fact, ever since the <a href=\\"https://reactjs.org/blog/2015/07/03/react-v0.14-beta-1.html#two-packages\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">package split in React 0.14</a>, the <code class=\\"language-text\\">react</code> package intentionally only exposes APIs for <em>defining</em> components. Most of the <em>implementation</em> of React lives in the “renderers”.</p>
<p><code class=\\"language-text\\">react-dom</code>, <code class=\\"language-text\\">react-dom/server</code>, <code class=\\"language-text\\">react-native</code>, <code class=\\"language-text\\">react-test-renderer</code>, <code class=\\"language-text\\">react-art</code> are some examples of renderers (and you can <a href=\\"https://github.com/facebook/react/blob/master/packages/react-reconciler/README.md#practical-examples\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">build your own</a>).</p>
<p>This is why the <code class=\\"language-text\\">react</code> package is useful regardless of which platform you target. All its exports, such as <code class=\\"language-text\\">React.Component</code>, <code class=\\"language-text\\">React.createElement</code>, <code class=\\"language-text\\">React.Children</code> utilities and (eventually) <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hooks</a>, are independent of the target platform. Whether you run React DOM, React DOM Server, or React Native, your components would import and use them in the same way.</p>
<p>In contrast, the renderer packages expose platform-specific APIs like <code class=\\"language-text\\">ReactDOM.render()</code> that let you mount a React hierarchy into a DOM node. Each renderer provides an API like this. Ideally, most <em>components</em> shouldn’t need to import anything from a renderer. This keeps them more portable.</p>
<p><strong>What most people imagine as the React “engine” is inside each individual renderer.</strong> Many renderers include a copy of the same code — we call it the <a href=\\"https://github.com/facebook/react/tree/master/packages/react-reconciler\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">“reconciler”</a>. A <a href=\\"https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html#migrating-to-google-closure-compiler\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">build step</a> smooshes the reconciler code together with the renderer code into a single highly optimized bundle for better performance. (Copying code is usually not great for bundle size but the vast majority of React users only needs one renderer at a time, such as <code class=\\"language-text\\">react-dom</code>.)</p>
<p>The takeaway here is that the <code class=\\"language-text\\">react</code> package only lets you <em>use</em> React features but doesn’t know anything about <em>how</em> they’re implemented. The renderer packages (<code class=\\"language-text\\">react-dom</code>, <code class=\\"language-text\\">react-native</code>, etc) provide the implementation of React features and platform-specific logic. Some of that code is shared (“reconciler”) but that’s an implementation detail of individual renderers.</p>
<hr>
<p>Now we know why <em>both</em> <code class=\\"language-text\\">react</code> and <code class=\\"language-text\\">react-dom</code> packages need to be updated for new features. For example, when React 16.3 added the Context API, <code class=\\"language-text\\">React.createContext()</code> was exposed on the React package.</p>
<p>But <code class=\\"language-text\\">React.createContext()</code> doesn’t actually <em>implement</em> the context feature. The implementation would need to be different between React DOM and React DOM Server, for example. So <code class=\\"language-text\\">createContext()</code> returns a few plain objects:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// A bit simplified</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createContext</span><span class=\\"token punctuation\\">(</span>defaultValue<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> context <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
    _currentValue<span class=\\"token punctuation\\">:</span> defaultValue<span class=\\"token punctuation\\">,</span>
    Provider<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
    Consumer<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span>Provider <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
    $$<span class=\\"token keyword\\">typeof</span><span class=\\"token punctuation\\">:</span> Symbol<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">for</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'react.provider'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _context<span class=\\"token punctuation\\">:</span> context
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span>Consumer <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
    $$<span class=\\"token keyword\\">typeof</span><span class=\\"token punctuation\\">:</span> Symbol<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">for</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'react.context'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _context<span class=\\"token punctuation\\">:</span> context<span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> context<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>When you use <code class=\\"language-text\\">&lt;MyContext.Provider&gt;</code> or <code class=\\"language-text\\">&lt;MyContext.Consumer&gt;</code> in the code, it’s the <em>renderer</em> that decides how to handle them. React DOM might track context values in one way, but React DOM Server might do it differently.</p>
<p><strong>So if you update <code class=\\"language-text\\">react</code> to 16.3+ but don’t update <code class=\\"language-text\\">react-dom</code>, you’d be using a renderer that isn’t yet aware of the special <code class=\\"language-text\\">Provider</code> and <code class=\\"language-text\\">Consumer</code> types.</strong> This is why an older <code class=\\"language-text\\">react-dom</code> would <a href=\\"https://stackoverflow.com/a/49677020/458193\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">fail saying these types are invalid</a>.</p>
<p>The same caveat applies to React Native. However, unlike React DOM, a React release doesn’t immediately “force” a React Native release. They have an independent release schedule. The updated renderer code is <a href=\\"https://github.com/facebook/react-native/commits/master/Libraries/Renderer/oss\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">separately synced</a> into the React Native repository once in a few weeks. This is why features become available in React Native on a different schedule than in React DOM.</p>
<hr>
<p>Okay, so now we know that the <code class=\\"language-text\\">react</code> package doesn’t contain anything interesting, and the implementation lives in renderers like <code class=\\"language-text\\">react-dom</code>, <code class=\\"language-text\\">react-native</code>, and so on. But that doesn’t answer our question. How does <code class=\\"language-text\\">setState()</code> inside <code class=\\"language-text\\">React.Component</code> “talk” to the right renderer?</p>
<p><strong>The answer is that every renderer sets a special field on the created class.</strong> This field is called <code class=\\"language-text\\">updater</code>. It’s not something <em>you</em> would set — rather, it’s something React DOM, React DOM Server or React Native set right after creating an instance of your class:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Inside React DOM</span>
<span class=\\"token keyword\\">const</span> inst <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">YourComponent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
inst<span class=\\"token punctuation\\">.</span>props <span class=\\"token operator\\">=</span> props<span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">inst<span class=\\"token punctuation\\">.</span>updater <span class=\\"token operator\\">=</span> ReactDOMUpdater<span class=\\"token punctuation\\">;</span></span>
<span class=\\"token comment\\">// Inside React DOM Server</span>
<span class=\\"token keyword\\">const</span> inst <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">YourComponent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
inst<span class=\\"token punctuation\\">.</span>props <span class=\\"token operator\\">=</span> props<span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">inst<span class=\\"token punctuation\\">.</span>updater <span class=\\"token operator\\">=</span> ReactDOMServerUpdater<span class=\\"token punctuation\\">;</span></span>
<span class=\\"token comment\\">// Inside React Native</span>
<span class=\\"token keyword\\">const</span> inst <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">YourComponent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
inst<span class=\\"token punctuation\\">.</span>props <span class=\\"token operator\\">=</span> props<span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">inst<span class=\\"token punctuation\\">.</span>updater <span class=\\"token operator\\">=</span> ReactNativeUpdater<span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>Looking at the <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react/src/ReactBaseClasses.js#L58-L67\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">setState</code> implementation in <code class=\\"language-text\\">React.Component</code></a>, all it does is delegate work to the renderer that created this component instance:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// A bit simplified</span>
<span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span>partialState<span class=\\"token punctuation\\">,</span> callback<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Use the \`updater\` field to talk back to the renderer!</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>updater<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">enqueueSetState</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">,</span> partialState<span class=\\"token punctuation\\">,</span> callback<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>React DOM Server <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-dom/src/server/ReactPartialRenderer.js#L442-L448\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">might want to</a> ignore a state update and warn you, whereas React DOM and React Native would let their copies of the reconciler <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-reconciler/src/ReactFiberClassComponent.js#L190-L207\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">handle it</a>.</p>
<p>And this is how <code class=\\"language-text\\">this.setState()</code> can update the DOM even though it’s defined in the React package. It reads <code class=\\"language-text\\">this.updater</code> which was set by React DOM, and lets React DOM schedule and handle the update.</p>
<hr>
<p>We know about classes now, but what about Hooks?</p>
<p>When people first look at the <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hooks proposal API</a>, they often wonder: how does <code class=\\"language-text\\">useState</code> “know what to do”? The assumption is that it’s more “magical” than a base <code class=\\"language-text\\">React.Component</code> class with <code class=\\"language-text\\">this.setState()</code>.</p>
<p>But as we have seen today, the base class <code class=\\"language-text\\">setState()</code> implementation has been an illusion all along. It doesn’t do anything except forwarding the call to the current renderer. And <code class=\\"language-text\\">useState</code> Hook <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react/src/ReactHooks.js#L55-L56\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">does exactly the same thing</a>.</p>
<p><strong>Instead of an <code class=\\"language-text\\">updater</code> field, Hooks use a “dispatcher” object.</strong> When you call <code class=\\"language-text\\">React.useState()</code>, <code class=\\"language-text\\">React.useEffect()</code>, or another built-in Hook, these calls are forwarded to the current dispatcher.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// In React (simplified a bit)</span>
<span class=\\"token keyword\\">const</span> React <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Real property is hidden a bit deeper, see if you can find it!</span>
  __currentDispatcher<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>

  <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>initialState<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> React<span class=\\"token punctuation\\">.</span>__currentDispatcher<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span>initialState<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>

  <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span>initialState<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> React<span class=\\"token punctuation\\">.</span>__currentDispatcher<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span>initialState<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>And individual renderers set the dispatcher before rendering your component:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// In React DOM</span>
<span class=\\"token keyword\\">const</span> prevDispatcher <span class=\\"token operator\\">=</span> React<span class=\\"token punctuation\\">.</span>__currentDispatcher<span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">React<span class=\\"token punctuation\\">.</span>__currentDispatcher <span class=\\"token operator\\">=</span> ReactDOMDispatcher<span class=\\"token punctuation\\">;</span></span><span class=\\"token keyword\\">let</span> result<span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">try</span> <span class=\\"token punctuation\\">{</span>
  result <span class=\\"token operator\\">=</span> <span class=\\"token function\\">YourComponent</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">finally</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// Restore it back</span></span><span class=\\"gatsby-highlight-code-line\\">  React<span class=\\"token punctuation\\">.</span>__currentDispatcher <span class=\\"token operator\\">=</span> prevDispatcher<span class=\\"token punctuation\\">;</span></span><span class=\\"token punctuation\\">}</span></code></pre></div>
<p>For example, the React DOM Server implementation is <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-dom/src/server/ReactPartialRendererHooks.js#L340-L354\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>, and the reconciler implementation shared by React DOM and React Native is <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-reconciler/src/ReactFiberHooks.js\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">here</a>.</p>
<p>This is why a renderer such as <code class=\\"language-text\\">react-dom</code> needs to access the same <code class=\\"language-text\\">react</code> package that you call Hooks from. Otherwise, your component won’t “see” the dispatcher! This may not work when you have <a href=\\"https://github.com/facebook/react/issues/13991\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">multiple copies of React</a> in the same component tree. However, this has always led to obscure bugs so Hooks force you to solve the package duplication before it costs you.</p>
<p>While we don’t encourage this, you can technically override the dispatcher yourself for advanced tooling use cases. (I lied about  <code class=\\"language-text\\">__currentDispatcher</code> name but you can find the real one in the React repo.) For example, React DevTools will use <a href=\\"https://github.com/facebook/react/blob/ce43a8cd07c355647922480977b46713bd51883e/packages/react-debug-tools/src/ReactDebugHooks.js#L203-L214\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">a special purpose-built dispatcher</a> to introspect the Hooks tree by capturing JavaScript stack traces. <em>Don’t repeat this at home.</em></p>
<p>This also means Hooks aren’t inherently tied to React. If in the future more libraries want to reuse the same primitive Hooks, in theory the dispatcher could move to a separate package and be exposed as a first-class API with a less “scary” name. In practice, we’d prefer to avoid premature abstraction until there is a need for it.</p>
<p>Both the <code class=\\"language-text\\">updater</code> field and the <code class=\\"language-text\\">__currentDispatcher</code> object are forms of a generic programming principle called <em>dependency injection</em>. In both cases, the renderers “inject” implementations of features like <code class=\\"language-text\\">setState</code> into the generic React package to keep your components more declarative.</p>
<p>You don’t need to think about how this works when you use React. We’d like React users to spend more time thinking about their application code than abstract concepts like dependency injection. But if you’ve ever wondered how <code class=\\"language-text\\">this.setState()</code> or <code class=\\"language-text\\">useState()</code> know what to do, I hope this helps.</p>
<hr>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/how-does-setstate-know-what-to-do/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "My Wishlist for Hot Reloading",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "I don't want a lot for Christmas. There is just one thing I need.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/my-wishlist-for-hot-reloading/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/my-wishlist-for-hot-reloading/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Sat, 08 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>Do you have a project that you approach repeatedly with a mix of success and failure, step aside for a while, and then try again — year after year? For some, it might be a router or a virtual list scroller. For me, it’s hot reloading.</p>
<p>My first exposure to the idea of changing code on the fly was a brief mention in a book about Erlang that I read as a teenager. Much later, like many others, I fell in love with <a href=\\"https://vimeo.com/36579366\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Bret Victor’s beautiful demos</a>. I’ve read somewhere Bret was unhappy with people cherry-picking “easy” parts of his demos and screwing up the big vision. (I don’t know if this is true.) <strong>In either case, to me shipping even small incremental improvements that people take for granted later is a success.</strong> Smarter people than me will work on Next Big Ideas.</p>
<p>Now, I want to be clear that none of the <em>ideas</em> discussed in this post are mine. I’ve been <a href=\\"https://redux.js.org/introduction/prior-art\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">inspired</a> by many projects and people. In fact, even people whose projects I’ve never tried occasionally told me I’ve ripped off their stuff.</p>
<p>I’m not an inventor. If I have a “principle”, it is to take a vision that inspires me, and share it with more people — through words, code, and demos.</p>
<p>And hot reloading inspires me.</p>
<hr>
<p>I’ve taken several attempts at implementing hot reloading for React.</p>
<p>In retrospect, <a href=\\"https://vimeo.com/100010922\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">the first demo</a> I cobbled together changed my life. It got me my first Twitter followers, first thousand GitHub stars, later first <a href=\\"https://news.ycombinator.com/item?id=8982620\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">HN frontpage</a> hit, and even my first <a href=\\"https://www.youtube.com/watch?v=xsSnOQynTHs\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">conference talk</a> (bringing Redux into existence, oops). This first iteration worked fairly well. However, soon React moved <em>away</em> from <code class=\\"language-text\\">createClass</code>, making a reliable implementation much more difficult.</p>
<p>Since then I’ve done <a href=\\"https://medium.com/@dan_abramov/hot-reloading-in-react-1140438583bf?source=user_profile---------6------------------\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">a few more attempts</a> to fix it, each flawed in a different way. One of them is still being used in React Native (hot reloading functions doesn’t work there because of my mistakes — sorry!)</p>
<p>Frustrated with my inability to work around some issues and the lack of time, I handed React Hot Loader over to a few talented contributors. They have been pushing it forward and found clever workarounds for my design flaws. I am grateful to them for keeping the project in a good state despite the challenges.</p>
<hr>
<p><strong>To be clear, hot reloading in React is quite usable today.</strong> In fact, this blog uses Gatsby which uses React Hot Loader under the hood. I save this post in my editor and it updates without refreshing. Magic! In some ways, the vision that I worried wouldn’t ever see mainstream usage is already almost boring.</p>
<p>But there are plenty of people who feel it isn’t as good as it could be. Some dismiss it as a gimmick and that breaks my heart a little bit, but I think what they’re really saying is: <strong>the experience is not seamless.</strong> It’s not worth it if you’re never sure whether a hot reload worked, if it breaks in confusing ways, or if it’s easier to just refresh. I agree with this 100%, but to me it means we have more work to do. And I’m excited to start thinking about what official React support for hot reloading could look like in the future.</p>
<p>(If you use a language like Elm, Reason or ClojureScript, maybe those problems are already solved in your ecosystem. I’m happy that you’re happy. This won’t stop me from trying and failing to bring good stuff to JavaScript.)</p>
<hr>
<p>I think I’m ready to take another attempt at implementing it. Here’s why.</p>
<p>Ever since <code class=\\"language-text\\">createClass</code> stopped being the primary way we define components, <strong>the biggest source of complexity and fragility in hot reloading components was dynamically replacing class methods.</strong> How do you patch existing instances of classes with new “versions” of their methods? The simple answer is “replace them on the prototype” but even with Proxies, in my experience there are too many gnarly edge cases for this to work reliably.</p>
<p>By comparison, hot reloading functions is easy. A Babel plugin could split any function component exported from a module into two functions:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Reassigns the latest version</span>
window<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">latest_Button</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">function</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Your actual code is moved here by a plugin</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// Think of this as a \\"proxy\\"</span>
<span class=\\"token comment\\">// that other components would use</span>
<span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">default</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Button</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Always points to latest version</span>
  <span class=\\"token keyword\\">return</span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">latest_Button</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Every time this module re-executes after an edit, <code class=\\"language-text\\">window.latest_Button</code> would point to the latest implementation. Reusing the same <code class=\\"language-text\\">Button</code> function between module evaluations would let us trick React into not unmounting our component even though we swapped out the implementation.</p>
<p>For a long time, it seemed to me that implementing reliable hot reloading for functions <em>alone</em> would encourage people to write convoluted code just to avoid using classes. But with <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hooks</a>, function components are fully featured so this is not a concern anymore. And this approach “just works” with Hooks:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Reassigns the latest version</span>
window<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">latest_Button</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">function</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Your actual code is moved here by a plugin</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>name<span class=\\"token punctuation\\">,</span> setName<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useState</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Mary'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">handleChange</span> <span class=\\"token operator\\">=</span> e <span class=\\"token operator\\">=></span> <span class=\\"token function\\">setName</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">.</span>target<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>input</span> <span class=\\"token attr-name\\">value</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>name<span class=\\"token punctuation\\">}</span></span> <span class=\\"token attr-name\\">onChange</span><span class=\\"token script language-javascript\\"><span class=\\"token script-punctuation punctuation\\">=</span><span class=\\"token punctuation\\">{</span>handleChange<span class=\\"token punctuation\\">}</span></span> <span class=\\"token punctuation\\">/></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">      </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello, </span><span class=\\"token punctuation\\">{</span>name<span class=\\"token punctuation\\">}</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>h1</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"token plain-text\\">    </span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span></span><span class=\\"token punctuation\\">></span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// Think of this as a \\"proxy\\"</span>
<span class=\\"token comment\\">// that other components would use</span>
<span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">default</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Button</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// Always points to latest version</span>
  <span class=\\"token keyword\\">return</span> window<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">latest_Button</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>As long as the Hook call order doesn’t change, we can preserve the state even as <code class=\\"language-text\\">window.latest_Button</code> is replaced between file edits. And replacing event handlers “just works” too — because Hooks rely on closures, and we replace the whole function.</p>
<hr>
<p>This was just a rough sketch of one possible approach. There are more (some are very different). How do we evaluate and compare them?</p>
<p>Before I get too attached to a specific approach that might be flawed in some way, <strong>I decided to write down a few principles that I think are important for judging any hot reloading implementation for component code.</strong></p>
<p>It would be nice to express some of these principles as tests later. These rules aren’t strict and there might be reasonable compromises. But if we decide to break them, that should be an explicit design decision and not something we accidentally discover later.</p>
<p>Here goes my wish list for hot reloading React components:</p>
<h3 id=\\"correctness\\"><a href=\\"#correctness\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Correctness</h3>
<ul>
<li>
<p><strong>Hot reloading should be unobservable before the first edit.</strong> Until you save a file, the code should behave exactly as it would if hot reloading was disabled. It’s expected that things like <code class=\\"language-text\\">fn.toString()</code> don’t match, which is already the case with minification. But it shouldn’t break reasonable application and library logic.</p>
</li>
<li>
<p><strong>Hot reload shouldn’t break React rules.</strong> Components shouldn’t get their lifecycles called in an unexpected way, accidentally swap state between unrelated trees, or do other non-Reacty things.</p>
</li>
<li>
<p><strong>Element type should always match the expected type.</strong> Some approaches wrap component types but this can break <code class=\\"language-text\\">&lt;MyThing /&gt;.type === MyThing</code>. This is a common source of bugs and should not happen.</p>
</li>
<li>
<p><strong>It should be easy to support all React types.</strong> <code class=\\"language-text\\">lazy</code>, <code class=\\"language-text\\">memo</code>, <code class=\\"language-text\\">forwardRef</code> — they should all be supported and it shouldn’t be hard to add support for more. Nested variations like <code class=\\"language-text\\">memo(memo(...))</code> should also work. We should always remount when the type shape changes.</p>
</li>
<li>
<p><strong>It shouldn’t reimplement a non-trivial chunk of React.</strong> It’s hard to keep up with React. If a solution reimplements React it poses problems in longer term as React adds features like Suspense.</p>
</li>
<li>
<p><strong>Re-exports shouldn’t break.</strong> If a component re-exports components from other modules (whether own or from <code class=\\"language-text\\">node_modules</code>), that shouldn’t cause issues.</p>
</li>
<li>
<p><strong>Static fields shouldn’t break.</strong> If you define a <code class=\\"language-text\\">ProfilePage.onEnter</code> method, you’d expect an importing module to be able to read it. Sometimes libraries rely on this so it’s important that it’s possible to read and write static properties, and for component itself to “see” the same values on itself.</p>
</li>
<li>
<p><strong>It is better to lose local state than to behave incorrectly.</strong> If we can’t reliably patch something (for example, a class), it is better to lose its local state than to do a mixed success effort at updating it. The developer will be suspicious anyway and likely force a refresh. We should be intentional about which cases we’re confident we can handle, and discard the rest.</p>
</li>
<li>
<p><strong>It is better to lose local state than use an old version.</strong> This is a more specific variation of the previous principle. For example, if a class couldn’t be hot reloaded, the code should force a remount for those components with the new version rather than keep rendering a zombie.</p>
</li>
</ul>
<h3 id=\\"locality\\"><a href=\\"#locality\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Locality</h3>
<ul>
<li>
<p><strong>Editing a module should re-execute as few modules as possible.</strong> Side effects during component module initialization are generally discouraged. But the more code you execute, the more likely something will cause a mess when called twice. We’re writing JavaScript, and React components are islands of (relative) purity but even there we don’t have strong guarantees. So if I edit a module, my hot reloading solution should re-execute that module and try to stop there if possible.</p>
</li>
<li>
<p><strong>Editing a component shouldn’t destroy the state of its parents or siblings.</strong> Similar to how <code class=\\"language-text\\">setState()</code> only affects the tree below, editing a component shouldn’t affect anything above it.</p>
</li>
<li>
<p><strong>Edits to non-React code should propagate upwards.</strong> If you edit a file with constants or pure functions that’s imported from several components, those components should update. It is acceptable to lose module state in such files.</p>
</li>
<li>
<p><strong>A runtime error introduced during hot reloading should not propagate.</strong> If you make a mistake in one component, it shouldn’t break your whole app. In React, this is usually solved by error boundaries. However, they are too coarse for the countless typos we make while editing. I should be able to make and fix runtime errors while I work on a component without its siblings or parents unmounting. However, errors that <em>don’t</em> happen during hot reload (and are legitimate bugs in my code) should go to the closest error boundary.</p>
</li>
<li>
<p><strong>Preserve own state unless it’s clear the developer doesn’t want to.</strong> If you’re just tweaking styles, it’s frustrating for the state to reset on every edit. On the other hand, if you just changed the state shape or the initial state, you’ll often prefer it to reset. By default we should try our best to preserve state. But if it leads to an error during hot reload, this is often a sign some assumption has changed, so we should reset state and <em>retry</em> rendering in that case. Commenting things out and back in is common so it’s important to handle that gracefully. For example, removing Hooks <em>at the end</em> shouldn’t reset state.</p>
</li>
<li>
<p><strong>Discard state when it’s clear the developer wants to.</strong> In some cases we can also proactively detect that the user wants to reset. For example, if the Hook order changed, or if primitive Hooks like <code class=\\"language-text\\">useState</code> change their initial state type. We can also offer a lightweight annotation that you can use to force a component to reset on every edit. Such as <code class=\\"language-text\\">// !</code> or some similar convention that’s fast to add and remove while you focus on how component mounts.</p>
</li>
<li>
<p><strong>Support updating “fixed” things.</strong> If a component is wrapped in <code class=\\"language-text\\">memo()</code>, hot reload should still update it. If an effect is called with <code class=\\"language-text\\">[]</code>, it should still be replaced. Code is like an invisible variable. Previously, I thought it was important to force deep updates below for things like <code class=\\"language-text\\">renderRow={this.renderRow}</code>. But in the Hooks world, we rely on closures anyway this seems unnecessary anymore. A different reference should be sufficient.</p>
</li>
<li>
<p><strong>Support multiple components in one file.</strong> It is a common pattern that multiple components are defined in the same file. Even if we only keep the state for function components, we want to make sure putting them in one file doesn’t cause them to lose state. Note these can be mutually recursive.</p>
</li>
<li>
<p><strong>When possible, preserve the state of children.</strong> If you edit a component, it’s always frustrating if its children unintentionally lose state. As long as the element types of children are defined in other files, we expect their state to be preserved. If they’re in the same file, we should do our best effort.</p>
</li>
<li>
<p><strong>Support custom Hooks.</strong> For well-written custom Hooks (some cases like <code class=\\"language-text\\">useInterval()</code> can be a bit tricky), hot reloading any arguments (including functions) should work. This shouldn’t need extra work and follows from the design of Hooks. Our solution just shouldn’t get in the way.</p>
</li>
<li>
<p><strong>Support render props.</strong> This usually doesn’t pose problems but it’s worth verifying they work and get updated as expected.</p>
</li>
<li>
<p><strong>Support higher-order components.</strong> Wrapping export into a higher-order component like <code class=\\"language-text\\">connect</code> shouldn’t break hot reloading or state preservation. If you use a component created from a HOC in JSX (such as <code class=\\"language-text\\">styled</code>), and that component is a class, it’s expected that it loses state when instantiated in the edited file. But a HOC that returns a function component (potentially using Hooks) shouldn’t lose state even if it’s defined in the same file. In fact, even edits to its arguments (e.g. <code class=\\"language-text\\">mapStateToProps</code>) should be reflected.</p>
</li>
</ul>
<h3 id=\\"feedback\\"><a href=\\"#feedback\\" aria-hidden class=\\"anchor\\"><svg aria-hidden=\\"true\\" height=\\"16\\" version=\\"1.1\\" viewBox=\\"0 0 16 16\\" width=\\"16\\"><path fill-rule=\\"evenodd\\" d=\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\"></path></svg></a>Feedback</h3>
<ul>
<li>
<p><strong>Both success and failure should provide visual feedback.</strong> You should always be confident whether a hot reload succeeded or failed. In case of a runtime or a syntax error you should see an overlay which should be automatically be dismissed after it is irrelevant. When hot reload is successful, there should be some visual feedback such as flashing updated components or a notification.</p>
</li>
<li>
<p><strong>A syntax error shouldn’t cause a runtime error or a refresh.</strong> When you edit the code and you have a syntax error, it should be shown in a modal overlay (ideally, with a click-through to the editor). If you make another syntax error, the existing overlay is updated. Hot reloading is only attempted <em>after</em> you fix your syntax errors. Syntax error shouldn’t make you lose the state.</p>
</li>
<li>
<p><strong>A syntax error after reload should still be visible.</strong> If you see a modal syntax error overlay and refresh, you should still be seeing it. It categorically should not let you run the last successful version (I’ve seen that in some setups).</p>
</li>
<li>
<p><strong>Consider exposing power user tools.</strong> With hot reloading, code itself can be your “terminal”. In addition to the hypothetical <code class=\\"language-text\\">// !</code> command to force remount, there could be e.g. an <code class=\\"language-text\\">// inspect</code> command that shows a panel with props values next to the component. Be creative!</p>
</li>
<li>
<p><strong>Minimize the noise.</strong> DevTools and warning messages shouldn’t expose that we’re doing something special. Avoid breaking <code class=\\"language-text\\">displayName</code>s or adding useless wrappers to the debug output.</p>
</li>
<li>
<p><strong>Debugging in major browsers should show the most recent code.</strong> While this doesn’t exactly depend on us, we should do our best to ensure the browser debugger shows the most recent version of any file and that breakpoints work as expected.</p>
</li>
<li>
<p><strong>Optimize for fast iteration, not long refactoring.</strong> This is JavaScript, not Elm. Any long-running series of edits likely won’t hot reload well due to a bunch of mistakes that need to be fixed one by one. When in doubt, optimize for the use case of tweaking a few components in a tight iteration loop rather than for a big refactor. And be predictable. Keep in mind that if you lose developer’s trust they’ll refresh anyway.</p>
</li>
</ul>
<hr>
<p>This was my wish list for how hot reloading in React — or any component system that offers more than templates — should work. There’s probably more stuff I will add here with time.</p>
<p>I don’t know how many of these goals we can satisfy with JavaScript. But there’s one more reason I’m looking forward to working on hot reloading again. As an engineer I’m more organized than before. In particular, <strong>I’ve finally learned my lesson to write up requirements like this before diving into another implementation.</strong></p>
<p>Maybe this one will actually work! But if it doesn’t, at least I’ve left some breadcrumbs for the next person who tries it.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/my-wishlist-for-hot-reloading/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Why Do React Elements Have a $$typeof Property?",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "It has something to do with security.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-do-react-elements-have-typeof-property/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-do-react-elements-have-typeof-property/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Mon, 03 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>You might think you’re writing JSX:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>marquee</span> <span class=\\"token attr-name\\">bgcolor</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span><span class=\\"token punctuation\\">\\"</span>#ffa7c4<span class=\\"token punctuation\\">\\"</span></span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">hi</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>marquee</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>But really, you’re calling a function:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">React<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">createElement</span><span class=\\"token punctuation\\">(</span>
  <span class=\\"token comment\\">/* type */</span> <span class=\\"token string\\">'marquee'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token comment\\">/* props */</span> <span class=\\"token punctuation\\">{</span> bgcolor<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'#ffa7c4'</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token comment\\">/* children */</span> <span class=\\"token string\\">'hi'</span>
<span class=\\"token punctuation\\">)</span></code></pre></div>
<p>And that function gives you back an object. We call this object a React <em>element</em>. It tells React what to render next. Your components return a tree of them.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token punctuation\\">{</span>
  type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'marquee'</span><span class=\\"token punctuation\\">,</span>
  props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
    bgcolor<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'#ffa7c4'</span><span class=\\"token punctuation\\">,</span>
    children<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'hi'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  key<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
  ref<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
<span class=\\"gatsby-highlight-code-line\\">  $$<span class=\\"token keyword\\">typeof</span><span class=\\"token punctuation\\">:</span> Symbol<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">for</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'react.element'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token comment\\">// 🧐 Who dis</span></span><span class=\\"token punctuation\\">}</span></code></pre></div>
<p>If you used React you might be familiar with <code class=\\"language-text\\">type</code>, <code class=\\"language-text\\">props</code>, <code class=\\"language-text\\">key</code>, and <code class=\\"language-text\\">ref</code> fields. <strong>But what is <code class=\\"language-text\\">$$typeof</code>? And why does it have a <code class=\\"language-text\\">Symbol()</code> as a value?</strong></p>
<p>That’s another one of those things that you don’t <em>need</em> to know to use React, but that will make you feel good when you do. There’s also some tips about security in this post that you might want to know. Maybe one day you’ll write your own UI library and all of this will come in handy. I certainly hope so.</p>
<hr>
<p>Before client-side UI libraries became common and added basic protection, it was common for app code to construct HTML and insert it into the DOM:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">const</span> messageEl <span class=\\"token operator\\">=</span> document<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getElementById</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'message'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
messageEl<span class=\\"token punctuation\\">.</span>innerHTML <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'&lt;p>'</span> <span class=\\"token operator\\">+</span> message<span class=\\"token punctuation\\">.</span>text <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'&lt;/p>'</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>That works fine, except when your <code class=\\"language-text\\">message.text</code> is something like <code class=\\"language-text\\">&#39;&lt;img src onerror=&quot;stealYourPassword()&quot;&gt;&#39;</code>. <strong>You don’t want things written by strangers to appear verbatim in your app’s rendered HTML.</strong></p>
<p>(Fun fact: if you only do client-side rendering, a <code class=\\"language-text\\">&lt;script&gt;</code> tag here wouldn’t let you run JavaScript. But <a href=\\"https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript/\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">don’t let this</a> lull you into a false sense of security.)</p>
<p>To protect against such attacks, you can use safe APIs like <code class=\\"language-text\\">document.createTextNode()</code> or <code class=\\"language-text\\">textContent</code> that only deal with text. You can also preemptively “escape” inputs by replacing potentially dangerous characters like <code class=\\"language-text\\">&lt;</code>, <code class=\\"language-text\\">&gt;</code> and others in any user-provided text.</p>
<p>Still, the cost of a mistake is high and it’s a hassle to remember it every time you interpolate a user-written string into your output. <strong>This is why modern libraries like React escape text content for strings by default:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
  </span><span class=\\"token punctuation\\">{</span>message<span class=\\"token punctuation\\">.</span>text<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>If <code class=\\"language-text\\">message.text</code> is a malicious string with an <code class=\\"language-text\\">&lt;img&gt;</code> or another tag, it won’t turn into a real <code class=\\"language-text\\">&lt;img&gt;</code> tag. React will escape the content and <em>then</em> insert it into the DOM. So instead of seeing the <code class=\\"language-text\\">&lt;img&gt;</code> tag you’ll just see its markup.</p>
<p>To render arbitrary HTML inside a React element, you have to write <code class=\\"language-text\\">dangerouslySetInnerHTML={{ __html: message.text }}</code>. <strong>The fact that it’s clumsy to write is a <em>feature</em>.</strong> It’s meant to be highly visible so that you can catch it in code reviews and codebase audits.</p>
<hr>
<p><strong>Does it mean React is entirely safe from injection attacks? No.</strong> HTML and DOM offer <a href=\\"https://github.com/facebook/react/issues/3473#issuecomment-90594748\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">plenty of attack surface</a> that is too difficult or slow for React or other UI libraries to mitigate against. Most of the remaining attack vectors involve attributes. For example, if you render <code class=\\"language-text\\">&lt;a href={user.website}&gt;</code>, beware of the user whose website is <code class=\\"language-text\\">&#39;javascript: stealYourPassword()&#39;</code>. Spreading user input like <code class=\\"language-text\\">&lt;div {...userData}&gt;</code> is rare but also dangerous.</p>
<p>React <a href=\\"https://github.com/facebook/react/issues/10506\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">could</a> provide more protection over time but in many cases these are consequences of server issues that <a href=\\"https://github.com/facebook/react/issues/3473#issuecomment-91327040\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">should</a> be fixed there anyway.</p>
<p>Still, escaping text content is a reasonable first line of defence that catches a lot of potential attacks. Isn’t it nice to know that code like this is safe?</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Escaped automatically</span>
<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">
  </span><span class=\\"token punctuation\\">{</span>message<span class=\\"token punctuation\\">.</span>text<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\">
</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p><strong>Well, that wasn’t always true either.</strong> And that’s where <code class=\\"language-text\\">$$typeof</code> comes in.</p>
<hr>
<p>React elements are plain objects by design:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token punctuation\\">{</span>
  type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'marquee'</span><span class=\\"token punctuation\\">,</span>
  props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
    bgcolor<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'#ffa7c4'</span><span class=\\"token punctuation\\">,</span>
    children<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'hi'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  key<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
  ref<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
  $$<span class=\\"token keyword\\">typeof</span><span class=\\"token punctuation\\">:</span> Symbol<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">for</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'react.element'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>While normally you create them with <code class=\\"language-text\\">React.createElement()</code>, it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldn’t <em>want</em> to write them like this — but this <a href=\\"https://github.com/facebook/react/pull/3583#issuecomment-90296667\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">can be</a> useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.</p>
<p>However, <strong>if your server has a hole that lets the user store an arbitrary JSON object</strong> while the client code expects a string, this could become a problem:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Server could have a hole that lets user store JSON</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">let</span> expectedTextButGotJSON <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">  type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'div'</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">  props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    dangerouslySetInnerHTML<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      __html<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'/* put your exploit here */'</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token comment\\">// ...</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></span><span class=\\"token keyword\\">let</span> message <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> text<span class=\\"token punctuation\\">:</span> expectedTextButGotJSON <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token comment\\">// Dangerous in React 0.13</span>
<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\"></span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token plain-text\\">  </span><span class=\\"token punctuation\\">{</span>message<span class=\\"token punctuation\\">.</span>text<span class=\\"token punctuation\\">}</span><span class=\\"token plain-text\\"></span></span><span class=\\"token plain-text\\"></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span></code></pre></div>
<p>In that case, React 0.13 would be <a href=\\"http://danlec.com/blog/xss-via-a-spoofed-react-element\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">vulnerable</a> to an XSS attack. To clarify, again, <strong>this attack depends on an existing server hole</strong>. Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.</p>
<p>The fix in React 0.14 was to <a href=\\"https://github.com/facebook/react/pull/4832\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">tag every React element with a Symbol</a>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token punctuation\\">{</span>
  type<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'marquee'</span><span class=\\"token punctuation\\">,</span>
  props<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
    bgcolor<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'#ffa7c4'</span><span class=\\"token punctuation\\">,</span>
    children<span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'hi'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  key<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
  ref<span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">,</span>
<span class=\\"gatsby-highlight-code-line\\">  $$<span class=\\"token keyword\\">typeof</span><span class=\\"token punctuation\\">:</span> Symbol<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">for</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'react.element'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This works because you can’t just put <code class=\\"language-text\\">Symbol</code>s in JSON. <strong>So even if the server has a security hole and returns JSON instead of text, that JSON can’t include <code class=\\"language-text\\">Symbol.for(&#39;react.element&#39;)</code>.</strong> React will check <code class=\\"language-text\\">element.$$typeof</code>, and will refuse to process the element if it’s missing or invalid.</p>
<p>The nice thing about using <code class=\\"language-text\\">Symbol.for()</code> specifically is that <strong>Symbols are global between environments like iframes and workers.</strong> So this fix doesn’t prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still “agree” on the valid <code class=\\"language-text\\">$$typeof</code> value.</p>
<hr>
<p>What about the browsers that <a href=\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">don’t support</a> Symbols?</p>
<p>Alas, they don’t get this extra protection. React still includes the <code class=\\"language-text\\">$$typeof</code> field on the element for consistency, but it’s <a href=\\"https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">set to a number</a> — <code class=\\"language-text\\">0xeac7</code>.</p>
<p>Why this number specifically? <code class=\\"language-text\\">0xeac7</code> kinda looks like “React”.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/why-do-react-elements-have-typeof-property/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "How Does React Tell a Class from a Function?",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "We talk about classes, new, instanceof, prototype chains, and API design.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/how-does-react-tell-a-class-from-a-function/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/how-does-react-tell-a-class-from-a-function/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Sun, 02 Dec 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>Consider this <code class=\\"language-text\\">Greeting</code> component which is defined as a function:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>React also supports defining it as a class:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Greeting</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>(Until <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">recently</a>, that was the only way to use features like state.)</p>
<p>When you want to render a <code class=\\"language-text\\">&lt;Greeting /&gt;</code>, you don’t care how it’s defined:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Class or function — whatever.</span>
<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>Greeting</span> <span class=\\"token punctuation\\">/></span></span></code></pre></div>
<p>But <em>React itself</em> cares about the difference!</p>
<p>If <code class=\\"language-text\\">Greeting</code> is a function, React needs to call it:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Your code</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// Inside React</span>
<span class=\\"token keyword\\">const</span> result <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// &lt;p>Hello&lt;/p></span></code></pre></div>
<p>But if <code class=\\"language-text\\">Greeting</code> is a class, React needs to instantiate it with the <code class=\\"language-text\\">new</code> operator and <em>then</em> call the <code class=\\"language-text\\">render</code> method on the just created instance:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Your code</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Greeting</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// Inside React</span>
<span class=\\"token keyword\\">const</span> instance <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Greeting {}</span>
<span class=\\"token keyword\\">const</span> result <span class=\\"token operator\\">=</span> instance<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// &lt;p>Hello&lt;/p></span></code></pre></div>
<p>In both cases React’s goal is to get the rendered node (in this example, <code class=\\"language-text\\">&lt;p&gt;Hello&lt;/p&gt;</code>). But the exact steps depend on how <code class=\\"language-text\\">Greeting</code> is defined.</p>
<p><strong>So how does React know if something is a class or a function?</strong></p>
<p>Just like in my <a href=\\"https://overreacted.io/why-do-we-write-super-props/\\">previous post</a>, <strong>you don’t <em>need</em> to know this to be productive in React.</strong> I didn’t know this for years. Please don’t turn this into an interview question. In fact, this post is more about JavaScript than it is about React.</p>
<p>This blog is for a curious reader who wants to know <em>why</em> React works in a certain way. Are you that person? Then let’s dig in together.</p>
<p><strong>This is a long journey. Buckle up. This post doesn’t have much information about React itself, but we’ll go through some aspects of <code class=\\"language-text\\">new</code>, <code class=\\"language-text\\">this</code>, <code class=\\"language-text\\">class</code>, arrow functions, <code class=\\"language-text\\">prototype</code>, <code class=\\"language-text\\">__proto__</code>, <code class=\\"language-text\\">instanceof</code>, and how those things work together in JavaScript. Luckily, you don’t need to think about those as much when you <em>use</em> React. If you’re implementing React though…</strong></p>
<p>(If you really just want to know the answer, scroll to the very end.)</p>
<hr>
<p>First, we need to understand why it’s important to treat functions and classes differently. Note how we use the <code class=\\"language-text\\">new</code> operator when calling a class:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// If Greeting is a function</span>
<span class=\\"token keyword\\">const</span> result <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// &lt;p>Hello&lt;/p></span>

<span class=\\"token comment\\">// If Greeting is a class</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">const</span> instance <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Greeting {}</span></span><span class=\\"token keyword\\">const</span> result <span class=\\"token operator\\">=</span> instance<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// &lt;p>Hello&lt;/p></span></code></pre></div>
<p>Let’s get a rough sense of what the <code class=\\"language-text\\">new</code> operator does in JavaScript.</p>
<hr>
<p>In the old days, JavaScript did not have classes. However, you could express a similar pattern to classes using plain functions. <strong>Concretely, you can use <em>any</em> function in a role similar to a class constructor by adding <code class=\\"language-text\\">new</code> before its call:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Just a function</span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">var</span> fred <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ Person {name: 'Fred'}</span>
<span class=\\"token keyword\\">var</span> george <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'George'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 🔴 Won’t work</span></code></pre></div>
<p>You can still write code like this today! Try it in DevTools.</p>
<p>If you called <code class=\\"language-text\\">Person(&#39;Fred&#39;)</code> <strong>without</strong> <code class=\\"language-text\\">new</code>, <code class=\\"language-text\\">this</code> inside it would point to something global and useless (for example, <code class=\\"language-text\\">window</code> or <code class=\\"language-text\\">undefined</code>). So our code would crash or do something silly like setting <code class=\\"language-text\\">window.name</code>.</p>
<p>By adding <code class=\\"language-text\\">new</code> before the call, we say: “Hey JavaScript, I know <code class=\\"language-text\\">Person</code> is just a function but let’s pretend it’s something like a class constructor. <strong>Create an <code class=\\"language-text\\">{}</code> object and point <code class=\\"language-text\\">this</code> inside the <code class=\\"language-text\\">Person</code> function to that object so I can assign stuff like <code class=\\"language-text\\">this.name</code>. Then give that object back to me.</strong>”</p>
<p>That’s what the <code class=\\"language-text\\">new</code> operator does.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">var</span> fred <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Same object as \`this\` inside \`Person\`</span></code></pre></div>
<p>The <code class=\\"language-text\\">new</code> operator also makes anything we put on <code class=\\"language-text\\">Person.prototype</code> available on the <code class=\\"language-text\\">fred</code> object:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>
<span class=\\"gatsby-highlight-code-line\\">Person<span class=\\"token punctuation\\">.</span>prototype<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">sayHi</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">function</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">alert</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Hi, I am '</span> <span class=\\"token operator\\">+</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token punctuation\\">}</span></span>
<span class=\\"token keyword\\">var</span> fred <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">fred<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">sayHi</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span></code></pre></div>
<p>This is how people emulated classes before JavaScript added them directly.</p>
<hr>
<p>So <code class=\\"language-text\\">new</code> has been around in JavaScript for a while. However, classes are more recent. They let us rewrite the code above to match our intent more closely:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Person</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token function\\">sayHi</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">alert</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Hi, I am '</span> <span class=\\"token operator\\">+</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">let</span> fred <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
fred<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">sayHi</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p><em>Capturing developer’s intent</em> is important in language and API design.</p>
<p>If you write a function, JavaScript can’t guess if it’s meant to be called like <code class=\\"language-text\\">alert()</code> or if it serves as a constructor like <code class=\\"language-text\\">new Person()</code>. Forgetting to specify <code class=\\"language-text\\">new</code> for a function like <code class=\\"language-text\\">Person</code> would lead to confusing behavior.</p>
<p><strong>Class syntax lets us say: “This isn’t just a function — it’s a class and it has a constructor”.</strong> If you forget <code class=\\"language-text\\">new</code> when calling it, JavaScript will raise an error:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> fred <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// ✅  If Person is a function: works fine</span>
<span class=\\"token comment\\">// ✅  If Person is a class: works fine too</span>

<span class=\\"token keyword\\">let</span> george <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'George'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// We forgot \`new\`</span>
<span class=\\"token comment\\">// 😳 If Person is a constructor-like function: confusing behavior</span>
<span class=\\"token comment\\">// 🔴 If Person is a class: fails immediately</span></code></pre></div>
<p>This helps us catch mistakes early instead of waiting for some obscure bug like <code class=\\"language-text\\">this.name</code> being treated as <code class=\\"language-text\\">window.name</code> instead of <code class=\\"language-text\\">george.name</code>.</p>
<p>However, it means that React needs to put <code class=\\"language-text\\">new</code> before calling any class. It can’t just call it as a regular function, as JavaScript would treat it as an error!</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Counter</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// 🔴 React can't just do this:</span>
<span class=\\"token keyword\\">const</span> instance <span class=\\"token operator\\">=</span> <span class=\\"token function\\">Counter</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This spells trouble.</p>
<hr>
<p>Before we see how React solves this, it’s important to remember most people using React use compilers like Babel to compile away modern features like classes for older browsers. So we need to consider compilers in our design.</p>
<p>In early versions of Babel, classes could be called without <code class=\\"language-text\\">new</code>. However, this was fixed — by generating some extra code:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// A bit simplified from Babel output:</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span> <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">throw</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">TypeError</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"Cannot call a class as a function\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// Our code:</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ Okay</span>
<span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'George'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>   <span class=\\"token comment\\">// 🔴 Cannot call a class as a function</span></code></pre></div>
<p>You might have seen code like this in your bundle. That’s what all those <code class=\\"language-text\\">_classCallCheck</code> functions do. (You can reduce the bundle size by opting into the “loose mode” with no checks but this might complicate your eventual transition to real native classes.)</p>
<hr>
<p>By now, you should roughly understand the difference between calling something with <code class=\\"language-text\\">new</code> or without <code class=\\"language-text\\">new</code>:</p>
<table>
<thead>
<tr>
<th></th>
<th><code class=\\"language-text\\">new Person()</code></th>
<th><code class=\\"language-text\\">Person()</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code class=\\"language-text\\">class</code></td>
<td>✅ <code class=\\"language-text\\">this</code> is a <code class=\\"language-text\\">Person</code> instance</td>
<td>🔴 <code class=\\"language-text\\">TypeError</code></td>
</tr>
<tr>
<td><code class=\\"language-text\\">function</code></td>
<td>✅ <code class=\\"language-text\\">this</code> is a <code class=\\"language-text\\">Person</code> instance</td>
<td>😳 <code class=\\"language-text\\">this</code> is <code class=\\"language-text\\">window</code> or <code class=\\"language-text\\">undefined</code></td>
</tr>
</tbody>
</table>
<p>This is why it’s important for React to call your component correctly. <strong>If your component is defined as a class, React needs to use <code class=\\"language-text\\">new</code> when calling it.</strong></p>
<p>So can React just check if something is a class or not?</p>
<p>Not so easy! Even if we could <a href=\\"https://stackoverflow.com/questions/29093396/how-do-you-check-the-difference-between-an-ecmascript-6-class-and-function\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">tell a class from a function in JavaScript</a>, this still wouldn’t work for classes processed by tools like Babel. To the browser, they’re just plain functions. Tough luck for React.</p>
<hr>
<p>Okay, so maybe React could just use <code class=\\"language-text\\">new</code> on every call? Unfortunately, that doesn’t always work either.</p>
<p>With regular functions, calling them with <code class=\\"language-text\\">new</code> would give them an object instance as <code class=\\"language-text\\">this</code>. It’s desirable for functions written as constructor (like our <code class=\\"language-text\\">Person</code> above), but it would be confusing for function components:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// We wouldn’t expect \`this\` to be any kind of instance here</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>That could be tolerable though. There are two <em>other</em> reasons that kill this idea.</p>
<hr>
<p>The first reason why always using <code class=\\"language-text\\">new</code> wouldn’t work is that for native arrow functions (not the ones compiled by Babel), calling with <code class=\\"language-text\\">new</code> throws an error:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">Greeting</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 🔴 Greeting is not a constructor</span></code></pre></div>
<p>This behavior is intentional and follows from the design of arrow functions. One of the main perks of arrow functions is that they <em>don’t</em> have their own <code class=\\"language-text\\">this</code> value — instead, <code class=\\"language-text\\">this</code> is resolved from the closest regular function:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Friends</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span>    <span class=\\"token keyword\\">const</span> friends <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>props<span class=\\"token punctuation\\">.</span>friends<span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">return</span> friends<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span>friend <span class=\\"token operator\\">=></span>
      <span class=\\"token operator\\">&lt;</span>Friend
<span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token comment\\">// \`this\` is resolved from the \`render\` method</span></span><span class=\\"gatsby-highlight-code-line\\">        size<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>props<span class=\\"token punctuation\\">.</span>size<span class=\\"token punctuation\\">}</span></span>        name<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">}</span>
        key<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>friend<span class=\\"token punctuation\\">.</span>id<span class=\\"token punctuation\\">}</span>
      <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
    <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Okay, so <strong>arrow functions don’t have their own <code class=\\"language-text\\">this</code>.</strong> But that means they would be entirely useless as constructors!</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">Person</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">// 🔴 This wouldn’t make sense!</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Therefore, <strong>JavaScript disallows calling an arrow function with <code class=\\"language-text\\">new</code>.</strong> If you do it, you probably made a mistake anyway, and it’s best to tell you early. This is similar to how JavaScript doesn’t let you call a class <em>without</em> <code class=\\"language-text\\">new</code>.</p>
<p>This is nice but it also foils our plan. React can’t just call <code class=\\"language-text\\">new</code> on everything because it would break arrow functions! We could try detecting arrow functions specifically by their lack of <code class=\\"language-text\\">prototype</code>, and not <code class=\\"language-text\\">new</code> just them:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>prototype <span class=\\"token comment\\">// undefined</span>
<span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">function</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>prototype <span class=\\"token comment\\">// {constructor: f}</span></code></pre></div>
<p>But this <a href=\\"https://github.com/facebook/react/issues/4599#issuecomment-136562930\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">wouldn’t work</a> for functions compiled with Babel. This might not be a big deal, but there is another reason that makes this approach a dead end.</p>
<hr>
<p>Another reason we can’t always use <code class=\\"language-text\\">new</code> is that it would preclude React from supporting components that return strings or other primitive types.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">'Hello'</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token function\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ 'Hello'</span>
<span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 😳 Greeting {}</span></code></pre></div>
<p>This, again, has to do with the quirks of the <a href=\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\"><code class=\\"language-text\\">new</code> operator</a> design. As we saw earlier, <code class=\\"language-text\\">new</code> tells the JavaScript engine to create an object, make that object <code class=\\"language-text\\">this</code> inside the function, and later give us that object as a result of <code class=\\"language-text\\">new</code>.</p>
<p>However, JavaScript also allows a function called with <code class=\\"language-text\\">new</code> to <em>override</em> the return value of <code class=\\"language-text\\">new</code> by returning some other object. Presumably, this was considered useful for patterns like pooling where we want to reuse instances:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token comment\\">// Created lazily</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">var</span> zeroVector <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">;</span></span>
<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Vector</span><span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>x <span class=\\"token operator\\">===</span> <span class=\\"token number\\">0</span> <span class=\\"token operator\\">&amp;&amp;</span> y <span class=\\"token operator\\">===</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>zeroVector <span class=\\"token operator\\">!==</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token comment\\">// Reuse the same instance</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token keyword\\">return</span> zeroVector<span class=\\"token punctuation\\">;</span></span>    <span class=\\"token punctuation\\">}</span>
    zeroVector <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>x <span class=\\"token operator\\">=</span> x<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>y <span class=\\"token operator\\">=</span> y<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">var</span> a <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Vector</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">var</span> b <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Vector</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">var</span> c <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Vector</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 😲 b === c</span></span></code></pre></div>
<p>However, <code class=\\"language-text\\">new</code> also <em>completely ignores</em> a function’s return value if it’s <em>not</em> an object. If you return a string or a number, it’s like there was no <code class=\\"language-text\\">return</code> at all.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Answer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token number\\">42</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token function\\">Answer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ 42</span>
<span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Answer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 😳 Answer {}</span></code></pre></div>
<p>There is just no way to read a primitive return value (like a number or a string) from a function when calling it with <code class=\\"language-text\\">new</code>. So if React always used <code class=\\"language-text\\">new</code>, it would be unable to add support components that return strings!</p>
<p>That’s unacceptable so we need to compromise.</p>
<hr>
<p>What did we learn so far? React needs to call classes (including Babel output) <em>with</em> <code class=\\"language-text\\">new</code> but it needs to call regular functions or arrow functions (including Babel output) <em>without</em> <code class=\\"language-text\\">new</code>. And there is no reliable way to distinguish them.</p>
<p><strong>If we can’t solve a general problem, can we solve a more specific one?</strong></p>
<p>When you define a component as a class, you’ll likely want to extend <code class=\\"language-text\\">React.Component</code> for built-in methods like <code class=\\"language-text\\">this.setState()</code>. <strong>Rather than try to detect all classes, can we detect only <code class=\\"language-text\\">React.Component</code> descendants?</strong></p>
<p>Spoiler: this is exactly what React does.</p>
<hr>
<p>Perhaps, the idiomatic way to check if <code class=\\"language-text\\">Greeting</code> is a React component class is by testing if <code class=\\"language-text\\">Greeting.prototype instanceof React.Component</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">A</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">B</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">A</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>

console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token constant\\">B</span><span class=\\"token punctuation\\">.</span>prototype <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">A</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// true</span></code></pre></div>
<p>I know what you’re thinking. What just happened here?! To answer this, we need to understand JavaScript prototypes.</p>
<p>You might be familiar with the “prototype chain”. Every object in JavaScript might have a “prototype”. When we write <code class=\\"language-text\\">fred.sayHi()</code> but <code class=\\"language-text\\">fred</code> object has no <code class=\\"language-text\\">sayHi</code> property, we look for <code class=\\"language-text\\">sayHi</code> property on <code class=\\"language-text\\">fred</code>’s prototype. If we don’t find it there, we look at the next prototype in the chain — <code class=\\"language-text\\">fred</code>’s prototype’s prototype. And so on.</p>
<p><strong>Confusingly, the <code class=\\"language-text\\">prototype</code> property of a class or a function <em>does not</em> point to the prototype of that value.</strong> I’m not kidding.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>

console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>Person<span class=\\"token punctuation\\">.</span>prototype<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 🤪 Not Person's prototype</span>
console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>Person<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 😳 Person's prototype</span></code></pre></div>
<p>So the “prototype chain” is more like <code class=\\"language-text\\">__proto__.__proto__.__proto__</code> than <code class=\\"language-text\\">prototype.prototype.prototype</code>. This took me years to get.</p>
<p>What’s the <code class=\\"language-text\\">prototype</code> property on a function or a class, then? <strong>It’s the <code class=\\"language-text\\">__proto__</code> given to all objects <code class=\\"language-text\\">new</code>ed with that class or a function!</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">Person</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>
Person<span class=\\"token punctuation\\">.</span>prototype<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">sayHi</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">function</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">alert</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Hi, I am '</span> <span class=\\"token operator\\">+</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">var</span> fred <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Person</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Fred'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Sets \`fred.__proto__\` to \`Person.prototype\`</span></span></code></pre></div>
<p>And that <code class=\\"language-text\\">__proto__</code> chain is how JavaScript looks up properties:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">fred<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">sayHi</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// 1. Does fred have a sayHi property? No.</span>
<span class=\\"token comment\\">// 2. Does fred.__proto__ have a sayHi property? Yes. Call it!</span>

fred<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toString</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// 1. Does fred have a toString property? No.</span>
<span class=\\"token comment\\">// 2. Does fred.__proto__ have a toString property? No.</span>
<span class=\\"token comment\\">// 3. Does fred.__proto__.__proto__ have a toString property? Yes. Call it!</span></code></pre></div>
<p>In practice, you should almost never need to touch <code class=\\"language-text\\">__proto__</code> from the code directly unless you’re debugging something related to the prototype chain. If you want to make stuff available on <code class=\\"language-text\\">fred.__proto__</code>, you’re supposed to put it on <code class=\\"language-text\\">Person.prototype</code>. At least that’s how it was originally designed.</p>
<p>The <code class=\\"language-text\\">__proto__</code> property wasn’t even supposed to be exposed by browsers at first because the prototype chain was considered an internal concept. But some browsers added <code class=\\"language-text\\">__proto__</code> and eventually it was begrudgingly standardized (but deprecated in favor of <code class=\\"language-text\\">Object.getPrototypeOf()</code>).</p>
<p><strong>And yet I still find it very confusing that a property called <code class=\\"language-text\\">prototype</code> does not give you a value’s prototype</strong> (for example, <code class=\\"language-text\\">fred.prototype</code> is undefined because <code class=\\"language-text\\">fred</code> is not a function). Personally, I think this is the biggest reason even experienced developers tend to misunderstand JavaScript prototypes.</p>
<hr>
<p>This is a long post, eh? I’d say we’re 80% there. Hang on.</p>
<p>We know that when we say <code class=\\"language-text\\">obj.foo</code>, JavaScript actually looks for <code class=\\"language-text\\">foo</code> in <code class=\\"language-text\\">obj</code>, <code class=\\"language-text\\">obj.__proto__</code>, <code class=\\"language-text\\">obj.__proto__.__proto__</code>, and so on.</p>
<p>With classes, you’re not exposed directly to this mechanism, but <code class=\\"language-text\\">extends</code> also works on top of the good old prototype chain. That’s how our React class instance gets access to methods like <code class=\\"language-text\\">setState</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"gatsby-highlight-code-line\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Greeting</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span></span>  <span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token plain-text\\">Hello</span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>p</span><span class=\\"token punctuation\\">></span></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">let</span> c <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>c<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Greeting.prototype</span>
<span class=\\"gatsby-highlight-code-line\\">console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>c<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// React.Component.prototype</span></span>console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>c<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">.</span>__proto__<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// Object.prototype</span>

c<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">render</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>      <span class=\\"token comment\\">// Found on c.__proto__ (Greeting.prototype)</span>
<span class=\\"gatsby-highlight-code-line\\">c<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>    <span class=\\"token comment\\">// Found on c.__proto__.__proto__ (React.Component.prototype)</span></span>c<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toString</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>    <span class=\\"token comment\\">// Found on c.__proto__.__proto__.__proto__ (Object.prototype)</span></code></pre></div>
<p>In other words, <strong>when you use classes, an instance’s <code class=\\"language-text\\">__proto__</code> chain “mirrors” the class hierarchy:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// \`extends\` chain</span>
Greeting
  → React<span class=\\"token punctuation\\">.</span>Component
    → <span class=\\"token function\\">Object</span> <span class=\\"token punctuation\\">(</span>implicitly<span class=\\"token punctuation\\">)</span>

<span class=\\"token comment\\">// \`__proto__\` chain</span>
<span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
  → Greeting<span class=\\"token punctuation\\">.</span>prototype
    → React<span class=\\"token punctuation\\">.</span>Component<span class=\\"token punctuation\\">.</span>prototype
      → Object<span class=\\"token punctuation\\">.</span>prototype</code></pre></div>
<p>2 Chainz.</p>
<hr>
<p>Since the <code class=\\"language-text\\">__proto__</code> chain mirrors the class hierarchy, we can check whether a <code class=\\"language-text\\">Greeting</code> extends <code class=\\"language-text\\">React.Component</code> by starting with <code class=\\"language-text\\">Greeting.prototype</code>, and then following down its <code class=\\"language-text\\">__proto__</code> chain:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// \`__proto__\` chain</span>
<span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
<span class=\\"gatsby-highlight-code-line\\">  → Greeting<span class=\\"token punctuation\\">.</span>prototype <span class=\\"token comment\\">// 🕵️ We start here</span></span><span class=\\"gatsby-highlight-code-line\\">    → React<span class=\\"token punctuation\\">.</span>Component<span class=\\"token punctuation\\">.</span>prototype <span class=\\"token comment\\">// ✅ Found it!</span></span>      → Object<span class=\\"token punctuation\\">.</span>prototype</code></pre></div>
<p>Conveniently, <code class=\\"language-text\\">x instanceof Y</code> does exactly this kind of search. It follows the <code class=\\"language-text\\">x.__proto__</code> chain looking for <code class=\\"language-text\\">Y.prototype</code> there.</p>
<p>Normally, it’s used to determine whether something is an instance of a class:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">let</span> greeting <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>greeting <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">Greeting</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// true</span>
<span class=\\"token comment\\">// greeting (🕵️‍ We start here)</span>
<span class=\\"token comment\\">//   .__proto__ → Greeting.prototype (✅ Found it!)</span>
<span class=\\"token comment\\">//     .__proto__ → React.Component.prototype </span>
<span class=\\"token comment\\">//       .__proto__ → Object.prototype</span>

console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>greeting <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// true</span>
<span class=\\"token comment\\">// greeting (🕵️‍ We start here)</span>
<span class=\\"token comment\\">//   .__proto__ → Greeting.prototype</span>
<span class=\\"token comment\\">//     .__proto__ → React.Component.prototype (✅ Found it!)</span>
<span class=\\"token comment\\">//       .__proto__ → Object.prototype</span>

console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>greeting <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">Object</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// true</span>
<span class=\\"token comment\\">// greeting (🕵️‍ We start here)</span>
<span class=\\"token comment\\">//   .__proto__ → Greeting.prototype</span>
<span class=\\"token comment\\">//     .__proto__ → React.Component.prototype</span>
<span class=\\"token comment\\">//       .__proto__ → Object.prototype (✅ Found it!)</span>

console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>greeting <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">Banana</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// false</span>
<span class=\\"token comment\\">// greeting (🕵️‍ We start here)</span>
<span class=\\"token comment\\">//   .__proto__ → Greeting.prototype</span>
<span class=\\"token comment\\">//     .__proto__ → React.Component.prototype </span>
<span class=\\"token comment\\">//       .__proto__ → Object.prototype (🙅‍ Did not find it!)</span></code></pre></div>
<p>But it would work just as fine to determine if a class extends another class:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>Greeting<span class=\\"token punctuation\\">.</span>prototype <span class=\\"token keyword\\">instanceof</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token comment\\">// greeting</span>
<span class=\\"token comment\\">//   .__proto__ → Greeting.prototype (🕵️‍ We start here)</span>
<span class=\\"token comment\\">//     .__proto__ → React.Component.prototype (✅ Found it!)</span>
<span class=\\"token comment\\">//       .__proto__ → Object.prototype</span></code></pre></div>
<p>And that check is how we could determine if something is a React component class or a regular function.</p>
<hr>
<p>That’s not what React does though. 😳</p>
<p>One caveat to the <code class=\\"language-text\\">instanceof</code> solution is that it doesn’t work when there are multiple copies of React on the page, and the component we’re checking inherits from <em>another</em> React copy’s <code class=\\"language-text\\">React.Component</code>. Mixing multiple copies of React in a single project is bad for several reasons but historically we’ve tried to avoid issues when possible. (With Hooks, we <a href=\\"https://github.com/facebook/react/issues/13991\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">might need to</a> force deduplication though.)</p>
<p>One other possible heuristic could be to check for presence of a <code class=\\"language-text\\">render</code> method on the prototype. However, at the time it <a href=\\"https://github.com/facebook/react/issues/4599#issuecomment-129714112\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">wasn’t clear</a> how the component API would evolve. Every check has a cost so we wouldn’t want to add more than one. This would also not work if <code class=\\"language-text\\">render</code> was defined as an instance method, such as with the class property syntax.</p>
<p>So instead, React <a href=\\"https://github.com/facebook/react/pull/4663\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">added</a> a special flag to the base component. React checks for the presence of that flag, and that’s how it knows whether something is a React component class or not.</p>
<p>Originally the flag was on the base <code class=\\"language-text\\">React.Component</code> class itself:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Inside React</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Component</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>
Component<span class=\\"token punctuation\\">.</span>isReactClass <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token comment\\">// We can check it like this</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Greeting</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">Component</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>
console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>Greeting<span class=\\"token punctuation\\">.</span>isReactClass<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ Yes</span></code></pre></div>
<p>However, some class implementations we wanted to target <a href=\\"https://github.com/scala-js/scala-js/issues/1900\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">did not</a> copy static properties (or set the non-standard <code class=\\"language-text\\">__proto__</code>), so the flag was getting lost.</p>
<p>This is why React <a href=\\"https://github.com/facebook/react/pull/5021\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">moved</a> this flag to <code class=\\"language-text\\">React.Component.prototype</code>: </p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Inside React</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Component</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>
Component<span class=\\"token punctuation\\">.</span>prototype<span class=\\"token punctuation\\">.</span>isReactComponent <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token comment\\">// We can check it like this</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Greeting</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">Component</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>
console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>Greeting<span class=\\"token punctuation\\">.</span>prototype<span class=\\"token punctuation\\">.</span>isReactComponent<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ Yes</span></code></pre></div>
<p><strong>And this is literally all there is to it.</strong></p>
<p>You might be wondering why it’s an object and not just a boolean. It doesn’t matter much in practice but early versions of Jest (before Jest was Good™️) had automocking turned on by default. The generated mocks omitted primitive properties, <a href=\\"https://github.com/facebook/react/pull/4663#issuecomment-136533373\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">breaking the check</a>. Thanks, Jest.</p>
<p>The <code class=\\"language-text\\">isReactComponent</code> check is <a href=\\"https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/react-reconciler/src/ReactFiber.js#L297-L300\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">used in React</a> to this day.</p>
<p>If you don’t extend <code class=\\"language-text\\">React.Component</code>, React won’t find <code class=\\"language-text\\">isReactComponent</code> on the prototype, and won’t treat component as a class. Now you know why <a href=\\"https://stackoverflow.com/a/42680526/458193\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">the most upvoted answer</a> for <code class=\\"language-text\\">Cannot call a class as a function</code> error is to add <code class=\\"language-text\\">extends React.Component</code>. Finally, a <a href=\\"https://github.com/facebook/react/pull/11168\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">warning was added</a> that warns when <code class=\\"language-text\\">prototype.render</code> exists but <code class=\\"language-text\\">prototype.isReactComponent</code> doesn’t.</p>
<hr>
<p>You might say this story is a bit of a bait-and-switch. <strong>The actual solution is really simple, but I went on a huge tangent to explain <em>why</em> React ended up with this solution, and what the alternatives were.</strong></p>
<p>In my experience, that’s often the case with library APIs. For an API to be simple to use, you often need to consider the language semantics (possibly, for several languages, including future directions), runtime performance, ergonomics with and without compile-time steps, the state of the ecosystem and packaging solutions, early warnings, and many other things. The end result might not always be the most elegant, but it must be practical.</p>
<p><strong>If the final API is successful, <em>its users</em> never have to think about this process.</strong> Instead they can focus on creating apps.</p>
<p>But if you’re also curious… it’s nice to know how it works.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/how-does-react-tell-a-class-from-a-function/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Why Do We Write super(props)?",
        },
        "description" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "There’s a twist at the end.",
        },
        "link" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-do-we-write-super-props/",
        },
        "guid" => Object {
          "attrs": Map {
            "isPermaLink" => "false",
          },
          "meta": Map {},
          "uri": "",
          "value": "https://overreacted.io/why-do-we-write-super-props/",
        },
        "pubDate" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "",
          "value": "Fri, 30 Nov 2018 00:00:00 GMT",
        },
        "content:encoded" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://purl.org/rss/1.0/modules/content/",
          "value": "<p>I heard <a href=\\"https://reactjs.org/docs/hooks-intro.html\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">Hooks</a> are the new hotness. Ironically, I want to start this blog by describing fun facts about <em>class</em> components. How about that!</p>
<p><strong>These gotchas are <em>not</em> important for using React productively. But you might find them amusing if you like to dig deeper into how things work.</strong></p>
<p>Here’s the first one.</p>
<hr>
<p>I wrote <code class=\\"language-text\\">super(props)</code> more times in my life than I’d like to know:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Checkbox</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> isOn<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Of course, the <a href=\\"https://github.com/tc39/proposal-class-fields\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">class fields proposal</a> lets us skip the ceremony:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Checkbox</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> isOn<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>A syntax like this was <a href=\\"https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#es7-property-initializers\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">planned</a> when React 0.13 added support for plain classes in 2015. Defining <code class=\\"language-text\\">constructor</code> and calling <code class=\\"language-text\\">super(props)</code> was always intended to be a temporary solution until class fields provide an ergonomic alternative.</p>
<p>But let’s get back to this example using only ES2015 features:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Checkbox</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> isOn<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p><strong>Why do we call <code class=\\"language-text\\">super</code>? Can we <em>not</em> call it? If we have to call it, what happens if we don’t pass <code class=\\"language-text\\">props</code>? Are there any other arguments?</strong> Let’s find out.</p>
<hr>
<p>In JavaScript, <code class=\\"language-text\\">super</code> refers to the parent class constructor. (In our example, it points to the <code class=\\"language-text\\">React.Component</code> implementation.)</p>
<p>Importantly, you can’t use <code class=\\"language-text\\">this</code> in a constructor until <em>after</em> you’ve called the parent constructor. JavaScript won’t let you:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Checkbox</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token comment\\">// 🔴 Can’t use \`this\` yet</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token comment\\">// ✅ Now it’s okay though</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> isOn<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>There’s a good reason for why JavaScript enforces that parent constructor runs before you touch <code class=\\"language-text\\">this</code>. Consider a class hierarchy:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Person</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">=</span> name<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">PolitePerson</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">Person</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">greetColleagues</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 🔴 This is disallowed, read below why</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>name<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token function\\">greetColleagues</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">alert</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Good morning folks!'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Imagine using <code class=\\"language-text\\">this</code> before <code class=\\"language-text\\">super</code> call <em>was</em> allowed. A month later, we might change <code class=\\"language-text\\">greetColleagues</code> to include the person’s name in the message:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">greetColleagues</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token function\\">alert</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Good morning folks!'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">alert</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'My name is '</span> <span class=\\"token operator\\">+</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>name <span class=\\"token operator\\">+</span> <span class=\\"token string\\">', nice to meet you!'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>But we forgot that <code class=\\"language-text\\">this.greetColleagues()</code> is called before the <code class=\\"language-text\\">super()</code> call had a chance to set up <code class=\\"language-text\\">this.name</code>. So <code class=\\"language-text\\">this.name</code> isn’t even defined yet! As you can see, code like this can be very difficult to think about.</p>
<p>To avoid such pitfalls, <strong>JavaScript enforces that if you want to use <code class=\\"language-text\\">this</code> in a constructor, you <em>have to</em> call <code class=\\"language-text\\">super</code> first.</strong> Let the parent do its thing! And this limitation applies to React components defined as classes too:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token comment\\">// ✅ Okay to use \`this\` now</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>state <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> isOn<span class=\\"token punctuation\\">:</span> <span class=\\"token boolean\\">true</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This leaves us with another question: why pass <code class=\\"language-text\\">props</code>?</p>
<hr>
<p>You might think that passing <code class=\\"language-text\\">props</code> down to <code class=\\"language-text\\">super</code> is necessary so that the base <code class=\\"language-text\\">React.Component</code> constructor can initialize <code class=\\"language-text\\">this.props</code>:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Inside React</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>props <span class=\\"token operator\\">=</span> props<span class=\\"token punctuation\\">;</span>
    <span class=\\"token comment\\">// ...</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>And that’s not far from truth — indeed, that’s <a href=\\"https://github.com/facebook/react/blob/1d25aa5787d4e19704c049c3cfa985d3b5190e0d/packages/react/src/ReactBaseClasses.js#L22\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">what it does</a>.</p>
<p>But somehow, even if you call <code class=\\"language-text\\">super()</code> without the <code class=\\"language-text\\">props</code> argument, you’ll still be able to access <code class=\\"language-text\\">this.props</code> in the <code class=\\"language-text\\">render</code> and other methods. (If you don’t believe me, try it yourself!)</p>
<p>How does <em>that</em> work? It turns out that <strong>React also assigns <code class=\\"language-text\\">props</code> on the instance right after calling <em>your</em> constructor:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\">  <span class=\\"token comment\\">// Inside React</span>
  <span class=\\"token keyword\\">const</span> instance <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">YourComponent</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  instance<span class=\\"token punctuation\\">.</span>props <span class=\\"token operator\\">=</span> props<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>So even if you forget to pass <code class=\\"language-text\\">props</code> to <code class=\\"language-text\\">super()</code>, React would still set them right afterwards. There is a reason for that.</p>
<p>When React added support for classes, it didn’t just add support for ES6 classes alone. The goal was to support as wide range of class abstractions as possible. It was <a href=\\"https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#other-languages\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">not clear</a> how relatively successful would ClojureScript, CoffeeScript, ES6, Fable, Scala.js, TypeScript, or other solutions be for defining components. So React was intentionally unopinionated about whether calling <code class=\\"language-text\\">super()</code> is required — even though ES6 classes are.</p>
<p>So does this mean you can just write <code class=\\"language-text\\">super()</code> instead of <code class=\\"language-text\\">super(props)</code>?</p>
<p><strong>Probably not because it’s still confusing.</strong> Sure, React would later assign <code class=\\"language-text\\">this.props</code> <em>after</em> your constructor has run. But <code class=\\"language-text\\">this.props</code> would still be undefined <em>between</em> the <code class=\\"language-text\\">super</code> call and the end of your constructor:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token comment\\">// Inside React</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>props <span class=\\"token operator\\">=</span> props<span class=\\"token punctuation\\">;</span>
    <span class=\\"token comment\\">// ...</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token comment\\">// Inside your code</span>
<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Button</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 😬 We forgot to pass props</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>      <span class=\\"token comment\\">// ✅ {}</span>
<span class=\\"gatsby-highlight-code-line\\">    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 😬 undefined </span></span>  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>It can be even more challenging to debug if this happens in some method that’s called <em>from</em> the constructor. <strong>And that’s why I recommend always passing down <code class=\\"language-text\\">super(props)</code>, even though it isn’t strictly necessary:</strong></p>
<div class=\\"gatsby-highlight\\" data-language=\\"jsx\\"><pre class=\\"language-jsx\\"><code class=\\"language-jsx\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Button</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">React<span class=\\"token punctuation\\">.</span>Component</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ We passed props</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>      <span class=\\"token comment\\">// ✅ {}</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>props<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// ✅ {}</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token comment\\">// ...</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This ensures <code class=\\"language-text\\">this.props</code> is set even before the constructor exits.</p>
<hr>
<p>There’s one last bit that longtime React users might be curious about.</p>
<p>You might have noticed that when you use the Context API in classes (either with the legacy <code class=\\"language-text\\">contextTypes</code> or the modern <code class=\\"language-text\\">contextType</code> API added in React 16.6), <code class=\\"language-text\\">context</code> is passed as a second argument to the constructor.</p>
<p>So why don’t we write <code class=\\"language-text\\">super(props, context)</code> instead? We could, but context is used less often so this pitfall just doesn’t come up as much.</p>
<p><strong>With the class fields proposal this whole pitfall mostly disappears anyway.</strong> Without an explicit constructor, all arguments are passed down automatically. This is what allows an expression like <code class=\\"language-text\\">state = {}</code> to include references to <code class=\\"language-text\\">this.props</code> or <code class=\\"language-text\\">this.context</code> if necessary.</p>
<p>With Hooks, we don’t even have <code class=\\"language-text\\">super</code> or <code class=\\"language-text\\">this</code>. But that’s a topic for another day.</p>
                <div style=\\"margin-top=55px; font-style: italic;\\">(This is an article posted to my blog at overreacted.io. You can read it online by <a href=\\"https://overreacted.io/why-do-we-write-super-props/\\">clicking here</a>.)</div>",
        },
      },
      "uri": "",
    },
  ],
}
`;

exports[`Snapshots: simple.atom 1`] = `
Object {
  "feed": Object {
    "attrs": Map {
      "xmlns" => "http://www.w3.org/2005/Atom",
    },
    "meta": Map {
      "title" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "Example Feed",
      },
      "subtitle" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "A subtitle.",
      },
      "link" => Array [
        Object {
          "attrs": Map {
            "href" => "http://example.org/feed/",
            "rel" => "self",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
        },
        Object {
          "attrs": Map {
            "href" => "http://example.org/",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
        },
      ],
      "id" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "urn:uuid:60a76c80-d399-11d9-b91C-0003939e0af6",
      },
      "updated" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "2003-12-13T18:30:02Z",
      },
    },
    "type": "atom",
    "uri": "http://www.w3.org/2005/Atom",
    "version": "1.0",
  },
  "items": Array [
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Atom-Powered Robots Run Amok",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "http://example.org/2003/12/13/atom03",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "alternate",
              "type" => "text/html",
              "href" => "http://example.org/2003/12/13/atom03.html",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "edit",
              "href" => "http://example.org/2003/12/13/atom03/edit",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2003-12-13T18:30:02Z",
        },
        "summary" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Some text.",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>This is the entry content.</p></div>",
        },
        "author" => Object {
          "attrs": Map {},
          "meta": Map {
            "name" => Object {
              "attrs": Map {},
              "meta": Map {},
              "uri": "http://www.w3.org/2005/Atom",
              "value": "John Doe",
            },
            "email" => Object {
              "attrs": Map {},
              "meta": Map {},
              "uri": "http://www.w3.org/2005/Atom",
              "value": "johndoe@example.com",
            },
          },
          "uri": "http://www.w3.org/2005/Atom",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
  ],
}
`;

exports[`Snapshots: tbray.org.atom 1`] = `
Object {
  "feed": Object {
    "attrs": Map {
      "xmlns" => "http://www.w3.org/2005/Atom",
      "xmlns:thr" => "http://purl.org/syndication/thread/1.0",
      "xml:lang" => "en-us",
    },
    "meta": Map {
      "title" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "ongoing by Tim Bray",
      },
      "link" => Array [
        Object {
          "attrs": Map {
            "rel" => "hub",
            "href" => "http://pubsubhubbub.appspot.com/",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
        },
        Object {
          "attrs": Map {
            "href" => "https://www.tbray.org/ongoing/",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
        },
        Object {
          "attrs": Map {
            "rel" => "self",
            "href" => "https://www.tbray.org/ongoing/ongoing.atom",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
        },
        Object {
          "attrs": Map {
            "rel" => "replies",
            "thr:count" => "101",
            "href" => "https://www.tbray.org/ongoing/comments.atom",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
        },
      ],
      "id" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "https://www.tbray.org/ongoing/",
      },
      "logo" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "rsslogo.jpg",
      },
      "icon" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "/favicon.ico",
      },
      "updated" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "2019-02-22T10:33:02-08:00",
      },
      "author" => Object {
        "attrs": Map {},
        "meta": Map {
          "name" => Object {
            "attrs": Map {},
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
            "value": "Tim Bray",
          },
        },
        "uri": "http://www.w3.org/2005/Atom",
      },
      "subtitle" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "ongoing fragmented essay by Tim Bray",
      },
      "rights" => Object {
        "attrs": Map {},
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "All content written by Tim Bray and photos by Tim Bray Copyright Tim Bray, some rights reserved, see /ongoing/misc/Copyright",
      },
      "generator" => Object {
        "attrs": Map {
          "uri" => "/misc/Colophon",
        },
        "meta": Map {},
        "uri": "http://www.w3.org/2005/Atom",
        "value": "Generated from XML source code using Perl, Expat, Emacs, Mysql, Ruby, Java, and ImageMagick.  Industrial-strength technology, baby.",
      },
    },
    "type": "atom",
    "uri": "http://www.w3.org/2005/Atom",
    "version": "1.0",
  },
  "items": Array [
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Tech Office Sketches",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/02/15/Walking-Around-the-Office",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "7",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/02/15/Walking-Around-the-Office#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/02/15/Walking-Around-the-Office",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-02-15T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-02-18T18:24:36-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Software",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Software",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Internet",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Internet",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Herewith notes from the white-hot center of the Internet software profession. Maybe the reality these reflect prevails across other technology territories, but I wouldnâ€™t know.  In no particular order:</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Herewith notes from the white-hot center of the Internet software profession. Maybe the reality these reflect prevails across
other technology territories, but I wouldnâ€™t know.  In no particular order:</p><h2 id=\\"p-1\\">Videoconferencing</h2><p>Generally it sucks. Thereâ€™s Skype â€™nâ€™ TeamViewer â€™nâ€™ Zoom â€™nâ€™ Webex â€™nâ€™ our own<a href=\\"https://aws.amazon.com/chime/\\">Chime</a>â€™nâ€™ GoToMeeting â€™nâ€™ join.me and they all suck in their own unlovable idiosyncratic
ways. The visual glitches I can tolerate, but the audio problems make me want to scream; dropouts, static, echoes, the noise of
hands softly leafing through a document drowning out any non-booming voice.</p><p>In my decades-long career, Iâ€™ve used one videoconferencing system that was reliable and almost always Just Worked. It was by
Polycom, but then the infrastructure people said â€œsuper old schoolâ€ and replaced it with something modern that often doesnâ€™t. I
suspect darkly that the technology is passable but a bean-counter somewhere has refused to buy enough bandwidth to make it sing?
Blecch.</p><h2 id=\\"p-2\\">Screens</h2><p>The amount of screen real-estate per geek grows monotonically. Dual-27\\" screens plus your laptopâ€™s own screen are table
stakes, and Iâ€™m seeing the occasional massive 50\\"-plus 4K screen. I asked one guy
â€œHow can you<em>use</em>all that space?â€ He said â€œI canâ€™t of course, all the stuff Iâ€™m actively working on is in the middle third,
bottom half. But having everything else within visible reach is such a win.â€  OK then.</p><p>I have to admit that Iâ€™m becoming increasingly conscious that the pixels on my<a href=\\"/ongoing/When/201x/2016/02/24/Dell-U3415W\\">curved 34\\" Dell U3415W</a><em>are</em>in fact visible,
and the contrast between that and my Retina laptop screens is a perceptible irritant. #FirstWorldProblem.</p><h2 id=\\"p-3\\">Desks</h2><p>The proportion that are motorized is higher every quarter.  Iâ€™d find it hard to live without mine.  The mix of people standing
and sitting makes the otherwise-dreary rows of software-engineer desks a little easier on the eye, which welcomes disorderly human
distributions.</p><h2 id=\\"p-4\\">Office space</h2><p>Since I mentioned it: All the high-tech companies Iâ€™ve worked for have resolutely ignored the research I hear about that seems to
say putting expensive engineers out on the floor with no separating walls leads to grievous productivity losses. Isnâ€™t this biz
supposed to be data-driven?</p><h2 id=\\"p-5\\">Diversity</h2><p>We do<a href=\\"/ongoing/When/201x/2019/02/09/D-and-I-training\\">work on the problem</a>, but the gender ratios are still not good.</p><p>If you can get past that (I canâ€™t) there are grounds for good cheer.  Here in Vancouver we draw from the very considerable
Canadian talent pool, but our immigration law lets us hire major distributed-systems talent from almost anywhere in the
world.
The resulting mix actually makes me feel optimistic about humanity; the AWS Service groups that
surround me offer visible in-the-flesh proof that thereâ€™s plenty of software talent in any ethnic, linguistic, or geographic slice
across the membership of<i>Homo sapiens</i>.</p><p>Iâ€™m amused that when chance lands two engineers on a problem who happen to share a native
tongue, they immediately drop out of English and into Polish or some south-central Han dialect or whatever it is Nigerian
geeks speak to each other.  Thereâ€™s this one group near me that has three guys named Muhammad; one them is called by his actual name, then
thereâ€™s â€œMoâ€ and â€œMomoâ€. It seems to work, and by the way Momo seems to be the leading expert on AWS Region Build Automation, which
is a big freaking hairy deal around here. Protip to the industry: If youâ€™re not recruiting out of West Africa, youâ€™re missing out on
major engineering talent.</p><h2 id=\\"p-6\\">Darkness</h2><p>Iâ€™m talking about screens. What with the advent of Mojave, light text on a dark background has officially re-entered the GUI
mainstream.  But more or less all the younger engineers had already switched their IDEs over to light-on-dark. My
white-background IntelliJ and Goland screens mark me as a dinosaur.</p><p>Iâ€™ve cared deeply about typography and presentation for a long
time and the issues here are interesting. I freely acknowledge that my preference for dark-on-light is probably an artifact of my
having tuned my brain, in my youth, to ink-on-paper.  Since screens are, at the end of the day, light-displaying devices, thereâ€™s an
argument that the natural on-screen design language for typography and information display is light-on-dark. I wonder if thereâ€™s
quantitative research in the space?</p><h2 id=\\"p-7\\">Speaking of IDEs</h2><p>I guess the big story is the decline of Eclipse from â€œmore or less everybodyâ€™s defaultâ€ to â€œthere are still people using itâ€.  VS
Code has momentum
but IntelliJ has a plenty of loyalists, and then the front-end tribe are often in Atom and Sublime.  Iâ€™m happy to report that
neither Vim nor Emacs have gone away.  But recently our license server was having problems and I couldnâ€™t use Goland and found the Emacs
go-mode story pretty weak.</p><h2 id=\\"p-8\\">Speaking of languages</h2><p>Itâ€™s no secret that the Internet still runs, more than anything else, on Java. Could be worse, I remember when it all ran on PHP
and Perl. And I donâ€™t want to diss Java<em>too</em>much.  The tooling story is exceptional, and once your JVM gets properly warmed
up, thereâ€™s nothing that runs usefully faster. And these days, for new stuff you should spell Java â€œKotlinâ€.  Especially since if
you let those young pups who wonâ€™t get off my lawn use Java, theyâ€™ll emit all this Java 8+ stream/lambda stuff that is easy to make
indecipherable.</p><p>Whatâ€™s happening out on the front-end frontier, the Cambrian explosion of JS-based technologies, makes me happy that I mostly
donâ€™t go there.</p><p>On the back end where I live, weâ€™ve got Go and Rust creeping in big-time. Iâ€™m no longer surprised when I pull up some package
buried deep in our serverless infrastructure and it turns out to be in Go. Well, and for serverless code too, if only because of the
fast startup.</p><p>If you live in the world of ML or data science, youâ€™re using Python; you donâ€™t have a choice and itâ€™s not
terrible.</p><p>Then Rust, for when you get close to the metal.  There was an internal new-languages thread where someone said â€œIf you canâ€™t
tolerate GC, use Rust. Otherwise use Go.â€  Sounds reasonable.
A few zealots are saying everything new should be in Rust because otherwise youâ€™re being
wilfullly unsafe. But I like having the runtime manage memory for me, whenever I can get away with it.</p><h2 id=\\"p-9\\">Inside the software</h2><p>REST is still a really good way to piece pieces of the software world together. Of course, what with the rise of HTTP/2 and QUIC,
what the programmer thinks of as RESTful requests are something quite other, out on the wire.  This feels about like us
thinking weâ€™re using x86 instructions on our silicon even though what the circuits are doing is really totally different.</p><p>To the extent that interfaces arenâ€™t REST, theyâ€™re mostly event streams of one kind or another. Where by â€œEventâ€ I mean â€œJSON
blobâ€; by and large good enough.  This is the area Iâ€™m working on this year, lots of opportunities for improvement.</p><p>The good news: Each generation of devs that comes along is a little more test-infected than its predecessors.  I still run
across islands of ignorance where they think itâ€™s OK to ship code now and do the unit tests later (as if that ever happens), but
less and less each year.</p><h2 id=\\"p-10\\">Which computers?</h2><p>Still more Macs than anything else, although thereâ€™s an undeniable Windows renaissance. Having said that, even the smart people
with the coolest Surface devices are often bitching about problems with things called â€œdriversâ€<span class=\\"dashes\\">â€‰â€”</span>â€‰what
are those for, anyhow?<span class=\\"dashes\\">â€‰â€”</span>â€‰and lockups, and saying â€œSorry, just a moment while I get my computer goingâ€.</p><p>If I were a little less aged and cynical, Iâ€™d be boiling over with anger at Appleâ€™s inexcusable stewardship of the Mac franchise;<a href=\\"https://daringfireball.net/2019/02/my_2018_apple_report_card\\">Gruberâ€™s â€œDâ€ grade</a>is maybe even generous. This is a
product that used to feature instant wake-up (gone), MagSafe (gone), lots of useful I/O ports including SD card readers (gone), a
good built-in photo editor (gone), and the worldâ€™s best keyboards (gone). It absolutely shocks me that a company can get away with
making its product successively
worse and then worse again, year after year. Among other things it speaks to how good the core design of MacOS is.</p><p>But maybe 2020 is the year of Linux on the desktop?</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "D&I Soundbites",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/02/09/D-and-I-training",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "8",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/02/09/D-and-I-training#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/02/09/D-and-I-training",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-02-09T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-02-09T16:57:09-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Politics",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Politics",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">I went to a two-day â€œD&I workshop for leadersâ€. Many in biz will know what that stands for: Diversity and Inclusion. The people facilitating were<a href=\\"https://www.wmfdp.com/\\">WMFDP</a>, which stands for â€œWhite Men as Full Diversity Partnersâ€. Having said that, only one of the two was a white man, and the audience was more gender-diverse than the high-tech norm.  Everyone was senior, there were lots of VPs in the room. It had a strong effect on me.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>I went to a two-day â€œD&I workshop for leadersâ€. Many in biz will know what that stands for: Diversity and
Inclusion. The people facilitating were<a href=\\"https://www.wmfdp.com/\\">WMFDP</a>, which stands for â€œWhite Men as Full Diversity Partnersâ€. Having said that, only one of
the two was a white man, and the audience was more gender-diverse than the high-tech norm.
Everyone was senior, there were lots of VPs in the room. It had a strong effect on me.</p><h2 id=\\"p-1\\">Truths</h2><p>In the technology space, we suck at diversity.  Weâ€™re broadly better than average at LGBTQ, probably not far off the mainstream
at Under-Represented Minorities, and terrible at gender.  Tech leadership is by and large aware of the problem, takes it seriously,
and would be very happy if there were a lever they could pull to fix it.  They are investing considerable energy,
including a nontrivial amount of leadership time, a very scarce resource.</p><h2 id=\\"p-3\\">Reportage</h2><p>Iâ€™ve been trying for weeks to figure out my take on the workshop, turn it into a nice narrative with a story arc
and Big Lessons.  That hasnâ€™t worked. But when I went back to review my notes I found a few really resonated.
So what the hell, here are the ones I think worth reading.  Draw your own conclusions.</p><p>Some of these are what the facilitators were saying. Some of them are quotes from other people. Some are
me talking to myself.  They start out pretty business-y but get personal.</p><ol><li><p>We were trying to close a $100M deal, and the customer wanted to see our D&I numbers, including diversity among our
suppliers.</p></li><li><p>In hiring, look for â€œReturneesâ€, people whoâ€™ve taken a break and want to come back to work. In
practical terms, these are almost all women whoâ€™ve been doing family caregiving.</p></li><li><p>Shortening the list of qualifications in job postings can be useful, because of menâ€™s propensity to be aspirational in
describing their qualifications.</p></li><li><p>When we get women into the interview process, we hire them at the same rate as men. So we need to interview more.</p></li><li><p>I am the tech business. Iâ€™ve had all the jobs, done all the things. If a diverse population  doesnâ€™t want to join it, Iâ€™m what
they donâ€™t want to join.</p></li><li><p>If you look at the Fortune 500â€™s diversity programs, theyâ€™re basically all led by women.  So weâ€™re asking the outsider group
to do all the work of fixing the discrimination against them.  A few white guys running some of these things might not be a terrible
thing.  Thereâ€™s a parallel with husbands who say theyâ€™re happy to help at home but ask their wives to do all the hard emotional/logistical
work.</p></li><li><p>The evidence of bias and anti-diversity prejudice is statistically overwhelming, no matter how many individual leaders deny
having it.</p></li><li><p>Men will remain indifferent unless they perceive they will benefit from D&I.</p></li><li><p>In tech, the bias is present and measurable, but is rarely explicit or intentional, and the people who empirically<em>must</em>be responsible will hotly deny being part of the problem. (But maybe less so based on attendance at this
exercise?)</p></li><li><p>People donâ€™t know how to talk about it. Talking about it is difficult, and thatâ€™s OK.</p></li><li><p>Short meetings are a form of discrimination<span class=\\"dashes\\">â€‰â€”</span>â€‰shy people donâ€™t get words in.</p></li><li><p>This black guy in the sales organization, super senior and successful, says â€œI havenâ€™t told anybody, but Iâ€™ve been keeping
count, in meetings, of black people among the customers at my level. Still havenâ€™t got to ten.â€</p></li><li><p>â€œInsider cultureâ€<span class=\\"dashes\\">â€‰â€”</span>â€‰individualism<span class=\\"dashes\\">â€‰â€”</span>â€‰low tolerance for
uncertainty<span class=\\"dashes\\">â€‰â€”</span>â€‰action vs reflection<span class=\\"dashes\\">â€‰â€”</span>â€‰rationality
over emotion<span class=\\"dashes\\">â€‰â€”</span>â€‰time is linear and future-focused<span class=\\"dashes\\">â€‰â€”</span>â€‰status and rank win over
correctness.</p></li><li><p>The ultimate privilege is being listened to.</p></li><li><p>When I mentor people, should I encourage them to be more like me?</p></li><li><p>Who should be teaching about male privilege? Ideally not always women.</p></li><li><p>Women say they have to do a<em>lot</em>more thinking before they get their clothes on and walk out the door.</p></li><li><p>So disappointed at the times Iâ€™ve heard â€œIâ€™m used to it.â€</p></li><li><p>Insiders are identified as individuals, not as members of a group.</p></li><li><p>Itâ€™s totally reasonable for outsiders to see me as â€œjust another white guyâ€.</p></li><li><p>Itâ€™s not my fault but Iâ€™m responsible.</p></li></ol><h2 id=\\"p-5\\">A conversation</h2><p>In one of the exercises, we were in smallish groups and were asked: â€œEveryone look inside themselves and find a dimension along
which youâ€™re an outsider.  Say a few words on what that is and how you feel about it.â€  Wellâ€¦ I came up empty, and said so.  Iâ€™m
white, male, live in the nation where I was born, straight, able-bodied, well-paid, lucky, and have mainstream tastes.</p><p>There was a short uneasy silence. Then this smart,
polished, accomplished, person who unlike me is<em>not</em>an insider-on-every-axis looked me in the eye and said â€œSo, why are you
here?â€  The honest truth is Iâ€™m really freaking sick of spending all my time in rooms full of men, so I said that but it felt
unsatisfactory.  I looked for something deeper to say but came up empty.</p><h2 id=\\"p-2\\">My crazy idea</h2><p>I think we in big tech companies should publicly face down our problems, starting with the worst ones.  To start with,
Iâ€™d like us to disclose the actual gender-diversity numbers in our engineering organizations and take a public goal of
changing them, say by 5% over a couple of years, and then disclose the results.</p><p>Because hereâ€™s the thing: The people in the management
ranks in big tech are, by and large, pretty smart and resourceful.  Tell them theyâ€™re going to be judged on any given number,
and theyâ€™ll figure out a way to move that number in the right direction.</p><p>â€œItâ€™s not my fault but Iâ€™m responsible.â€</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Jag Diary 9: Google Mapocalypse",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/01/23/I-Pace-UX",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "5",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/01/23/I-Pace-UX#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/01/23/I-Pace-UX",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-23T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-25T09:31:03-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">2019 is definitely the year of Linux onâ€¦ the dashboard. This Jaguar is the first car Iâ€™ve owned with a serious infotainment system, and itâ€™s opened my eyes to a few things, one of which might be a real Google vulnerability:  serious competition in the map space.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>2019 is definitely the year of Linux onâ€¦ the dashboard. This Jaguar is the first
car Iâ€™ve owned with a serious infotainment system, and itâ€™s opened my eyes to a few things, one of which might be a real
Google vulnerability:  serious competition in the map space.</p><p>Thatâ€™s the main story here, but Iâ€™ll tack on a few random observations about the infotainment system for the Jaguar-obsessed that
have been reading this series.</p><h2 id=\\"p-3\\">About those mapsâ€¦</h2><p>At breakfast on my recent road trip, I got some crud in the socket on my Pixel 2 so Android Auto wouldnâ€™t connect, and I was
looking for a place in Seattle Iâ€™d never been.  So I pulled over and puzzled my way through the Jagâ€™s navigation system; this
required, among other things, setting up a<a href=\\"https://www.here.com/\\">Here.com</a>account; This is harder than it should be.  Since I guess the software is mostly
Here.comâ€™s, Iâ€™m going to call these the Here maps.</p><p>Here.com<a href=\\"https://en.wikipedia.org/wiki/Here_(company)\\">is an interesting story</a>; the old Navteq, they spent some time in the
Nokia portfolio, are now owned by a consortium of car companies and Intel, and now appear in German cars, in Garmin, and at
Bing.</p><p>Once I got going, I really liked the Here maps.
The presentation is way prettier than Google via Android auto, with nicely-rendered geography highlights like
buildings and parks.  Also, it keeps your position at the bottom of the screen with the area youâ€™re going in front of you.  Iâ€™m
going to guess that thereâ€™s a way to switch Android Auto maps away from the default mode where North is at the top and much of the
map is filled with area youâ€™ve already traversed, but Iâ€™ve not found it.</p><p>The Here maps also make terrific use of the fact theyâ€™re on two screens. Most times, the little screen behind the steering wheel
shows an intelligently-selected subset of the main screen, but then when youâ€™re coming up to a tricky multi-lane corner or freeway
exit, the small screen has a picture showing you which lane you need to be in, or a picture of what the freeway exit sign looks
like.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/23/IMG_20190122_200642.png\\" alt=\\"Jaguar I-Pace map display\\"/><div class=\\"caption\\"><p>Pardon the low-res picture; trying to shoot the dashboard while navigating, at night, is not exactly
recommended practice.  Note the lane-choice detail behind the steering wheel.  In this case, the detail readout is also echoed on
the main screen, but sometimes the displays are completely disjoint.</p></div><p>As for accuracy, in my small sample size it was fine; there were a couple of odd-feeling routings, but I got where I was going.
Any other criticisms?  The keyboard for entering destinations is sluggish; but then I havenâ€™t tried the voice search, which
apparently is available. Speaking of slow, the nav system is<em>really</em>slow to boot up; youâ€™ll need to wait fifteen seconds or
more after turning the car on before itâ€™s ready to take and give directions.</p><p>But when Iâ€™d cleaned out my phoneâ€™s USB (Protip: toothbrush) and Android Auto was working again, I didnâ€™t go back, I stayed
with Here. I wonder which of Google and Here has better information about where the traffic jams are?</p><p>Thereâ€™s a widespread perception that Google Maps are unbeatably far ahead; for example check out Justin Oâ€™Beirneâ€™s<a href=\\"https://www.justinobeirne.com/google-maps-moat\\">masterful not
to say exaustingly exhaustive drill-downs</a>on the relative merits of Google and Apple maps. But, maybe not.</p><h2 id=\\"p-4\\">News flash</h2><p>In the last couple of months Iâ€™ve switched from Google to DuckDuckGo for my everyday searching, and from Google to Here for
auto navigation.  Iâ€™m wondering if Iâ€™m looking at cracks in the armor.</p><h2 id=\\"p-2\\">The rest of the stuff</h2><p>The Jaguar infotainment software has been panned by several reviewers, who say Tesla and Audi are the gold
standard.  Iâ€™m thinking those guys must be pretty good, because there are a lot of things I like about the
I-Pace UX.</p><ol><li><p>Multi-screen is good. As I mentioned, you can put the big-screen maps on the little screen, but then you can also put the big
screen audio readout on the little climate-control screen, leaving the big screen free, for maps I guess.</p></li><li><p>That audio readout is pretty nice.  I may have abandoned Android Auto maps, but Iâ€™m still spinning tunes through<a href=\\"https://play.google.com/music/listen?u=0#/home\\">Google Music</a>, for reasons<a href=\\"/ongoing/When/201x/2015/08/02/Google-Music\\">I described in 2015</a>.</p><p>It turns out you donâ€™t have to switch over to the Android Auto screens to do that. The Jag infotainment system recognizes Android
Auto as another music source, and will show you what youâ€™re listening to, along with album art, in a visually-pleasing display,
way nicer than Googleâ€™s.</p></li><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/23/IMG_20190122_201035.png\\" alt=\\"Jaguar I-Pace music display\\"/><li><p>The reviewers particularly griped about the system being laggy.  Yeah, but it just doesnâ€™t bother me.  There are one
or two corners that are<em>really</em>slow, but theyâ€™re fripperies I donâ€™t need.  One thing I do is switch from high-regen for
city streets to low-regen on the highway. There are a couple of routes to get there, involving both swipes and taps.  But neither of
them adds up to more than two or three seconds, and glancing at the road between the steps makes me feel safer.</p></li><li><p>Thereâ€™s a â€œfavoriteâ€ button you can assign loads of different functions to (I picked pause/restart audio) and quite a few
other opportunities for customization.</p></li><li><p>Thereâ€™s actually a built-in Web browser. It does a great job of displaying<span class=\\"o\\">ongoing</span>, so it must be OK.
Thereâ€™s also some canned news and financial applications, what I believe on a computer weâ€™d call â€œbloatwareâ€.</p></li></ol><p>That I-Pace cabin, itâ€™s the nicest car interior Iâ€™ve ever spent time in.  And itâ€™s not close.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Jag Diary 8: Road Trip!",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/01/22/I-Pace-Range",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "2",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/01/22/I-Pace-Range#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/01/22/I-Pace-Range",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-22T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-23T22:16:14-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Today I drove the new I-Pace 290.3 mostly highway kilometers. In the best online I-Pace community, the top topic, with 1,115 posts as I write, is<a href=\\"https://www.ipaceforums.co.uk/viewtopic.php?f=8&amp;t=409\\">I-Pace range</a>.  Because when you come to electric cars, range anxiety is a thing.  Todayâ€™s road-trip report will cover the general highway experience but, since itâ€™s the hot topic, will zero in on range.  Spoiler: You can almost always go 300km without trying too hard.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Today I drove the new I-Pace 290.3 mostly highway kilometers. In the best online I-Pace community, the top topic, with 1,115 posts as I
write, is<a href=\\"https://www.ipaceforums.co.uk/viewtopic.php?f=8&t=409\\">I-Pace range</a>.  Because when you come to electric
cars, range anxiety is a thing.  Todayâ€™s road-trip report will cover the general highway experience but,
since itâ€™s the hot topic, will zero in on range.  Spoiler: You can almost always go 300km without trying too hard.</p><p>Hereâ€™s the trip.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/22/Long-leg.png\\" alt=\\"290.3 km of travel\\"/><div class=\\"caption\\"><p>It was a three-leg trip, from Seattleâ€™s downtown to one of its western neighborhoods, then to SeaTac
airport, then home to Vancouver; only the last (longest) leg is illustrated.  This picture is from the JLR â€œIncontrolâ€ app, which
runs on your mobile and is also a Web site.</p></div><h2 id=\\"p-2\\">What it feels like</h2><p>The I-Pace is a dream on the big highway.  To be fair, this is largely due to it being a
well-built modern car with modern features.</p><ol><li><p>I think I already mentioned the seats are fabulous, but itâ€™s worth saying again: really great.</p></li><li><p>The weather was lousy, between 5Â°C and 8Â°C pretty well the whole way, alternating between drizzle and lashing rain.  The
climate control is actually not as vanishingly perfect as our old 2003 Audiâ€™s, as in sometimes you notice the fans are blowing a
little harder than youâ€™d like on your torso or thighs; easy to correct though.</p></li><li><p>The automatic setting on the wipers did the job, shifting from extra-slow intermittent in the drizzle to banginâ€™
â€™em hard in a tractor-trailerâ€™s wake in a downpour.</p></li><li><p>The assisted-cruise-control is a treat.  You set a maximum cruising
speed and when thereâ€™s someone in front of you (i.e. almost all the
time) it follows them automatically; the default follow distance gives
you exactly the two-second gap recommended in safety tips.</p><p>By the way, I am not remotely interested in any â€œself-drivingâ€ capability that falls short of â€œTim can open up his laptop and do a
code review.â€  Seriously, whatâ€™s the point?</p><p>But I think the assisted-cruise makes the highways globally safer at a level related to the number of people using it.</p><p>I read at least one reviewer who said the Jagâ€™s assisted-cruise implementation wasnâ€™t up there with the best.  I can believe it;
when a slowpoke pulls out in front of you, the Jag deploys the heavy regen and it can be kind of shocking.  And when you get out from
behind someone whoâ€™s going a whole lot slower than youâ€™ve set the cruise, the Jag decides itâ€™s on a
drag-strip.</p></li><li><p>On the subject of raw power:
I drove conservatively, assuming that this lurid-blue lightning bolt would be a cop magnet.  But there were a few occasions when I
booted it, for example when asshats tried to dart into my two-second gap, and on one occasion when I realized that I was
about to be seriously in the way of three cars trying to merge from an on-ramp I hadnâ€™t noticed, and there was no room to move over.
Well, tee-hee-hee, there are very few cars in the world that can rocket-launch forward from a starting speed well over 100km/h
the way this does.</p></li><li><p>The carâ€™s whisper-quiet around town (so nice) but when youâ€™re doing 70+mph on rough asphalt in a driving rainstorm, itâ€™s not
dramatically quieter than a decent modern fossil car; the tires and all the air and water hitting the car can get in the way if
youâ€™re playing soft music.</p></li></ol><p>Bottom line: Iâ€™ve driven this route too many times, in a variety of
automobiles, my own and rented.  The I-Pace got me home feeling a really a lot less
stressed and wasted than anything else Iâ€™ve done the trip in.</p><h2 id=\\"p-1\\">Now, about range</h2><p>The wisest thing Iâ€™ve seen on the subject is on the<a href=\\"https://www.ipaceforums.co.uk/\\">ipaceforums.co.uk</a>site in<a href=\\"https://www.ipaceforums.co.uk/viewtopic.php?f=8&t=409&start=1030#p11690\\">a post</a>by<a href=\\"https://www.ipaceforums.co.uk/memberlist.php?mode=viewprofile&u=837\\">DougTheMac</a>.  Itâ€™s worth reading in full, but here are
a couple of excerpts. This point, on how to think about range, is crucial:</p><blockquote><p>I think thereâ€™s a big difference between the required behaviour on a longer-than-usual trip and a very-long-trip. The difference is because on a road trip, you are reluctant to let the SoC get below maybe 20% in case the charger you are relying on isnâ€™t available and you have to divert. Also, on a road trip, you probably only want to recharge up to 80% because the last 20% is very slow. So, the distance between recharging stops on a very long trip is perhaps 60% of the actual achievable range.</p><p>But if you start from home with a full charge and pre-conditioned, and your destination at the end of the day is either home
again or a destination with 100% certainty of an overnight charge, then you can use 95%+ of the battery capacity with reasonable
confidence.</p></blockquote><p>Explanatory note on â€œconditioningâ€. You can tell the car what time you plan to depart, and on schedule itâ€™ll get the
cabin all pre-heated for you, and if itâ€™s plugged in, also boost the battery to the correct operating temperature. This is said to
increase range, but I have no idea how much.</p><p>Here are his conclusions (for those of us in metric-land, his breakpoints of 100M, 150M, and 190M are around,
respectively, 160km, 240km, and 300km):</p><blockquote><ul><li><p>Trip distance <100M: Charge to 80% (! q.v.), pre-condition, drive to have fun.</p></li><li><p>Trip distance <150M: Charge to 100%, pre-condition, drive to have fun.</p></li><li><p>Trip distance <190M: Charge to 100%, pre-condition, drive a bit more gently, monitor, but expect to get to destination without a charge en route, albeit perhaps down to <5% on arrival.</p></li><li><p>Trip distance 190-310M: Plan for a single en-route charge, ideally from c20% SoC (to give the safety margin required in case
the planned charger is unavailable) but only up to the SoC required to get to the final destination with a minimal SoC (5%?). A
single 20%-80% charge should add 120M (80%-20%=60%x200M), hence 190+120=310M with 5% on arrival at the â€œsafeâ€ destination. But if
you only need an extra 50M, you only put in the required amount to just get you to your safe destination.</p></li></ul></blockquote><p>Like I said at the top: You can go 300km, assuming youâ€™re sure of having a place to charge when you get there. The road to Seattle
is 230km with lots of hills, and there are long stretches where the speed limit is 70mph and everyone cruises at
80.  So while a chilly day like today isnâ€™t the North American worst case<span class=\\"dashes\\">â€‰â€”</span>â€‰that would be something like
Canadaâ€™s Rogers Pass in midwinter<span class=\\"dashes\\">â€‰â€”</span>â€‰itâ€™s worse than average.</p><p>I used the carâ€™s â€œcomfort modeâ€ both ways; itâ€™s got an â€œeco modeâ€ which could probably have done better.
On the trip down I still had 90km of advertised range when I pulled up to a charger in the basement of an Amazon building, which suggests a
total of 320km. Today I went 290.3km at an average speed of 87km/h and had 8% charge when I got home. The car
said it had 26km of range left; do the math.</p><h2 id=\\"p-2\\">Recharge</h2><p>After I unloaded, I headed over to the handy neighborhood fast-charger, where by â€œfastâ€ I mean 50kW.  This is about as close to a
â€œfull chargeâ€ as the Jag is ever likely to get: 78.174 kWh in 2 hours.</p><h2 id=\\"p-3\\">Conclusion</h2><p>Modern battery-electric cars are just fine for medium-long road trips.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Jag Diary 7: I-Pace Over 100",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/01/15/I-Pace-Over-100",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "0",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/01/15/I-Pace-Over-100#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/01/15/I-Pace-Over-100",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-15T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-18T23:00:54-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Thatâ€™s over a hundred kilometers of course, which it took three days to achieve.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Thatâ€™s over a hundred kilometers of course, which it took three days to achieve.</p><ol><li><p>Iâ€™m enjoying learning how to deploy that electric-Jag power gracefully.  Yeah, you can floor it, which
is shocking if brutish fun and might damage your neck vertebrae. But you know whatâ€™s way sweeter? Coming out of a
corner, or around a slower car, and easing the accelerator down, and then further and further down,<em>smoothly</em>. You canâ€™t do
this for more than a few seconds without being in seriously unlawful territory anywhere this side of the Autobahn, but oh my
goodness those are really very pleasing seconds; the pool of acceleration is bottomless.</p></li><li><p>Iâ€™ve had two charging experiences so far (havenâ€™t needed any, just trying to learn the ropes), both from<a href=\\"https://www.chargepoint.com/en-ca/\\">ChargePoint</a>, both perfectly smooth. You plug in the big heavy connector, fire up
the app, hold your phone up to the machine, and away it goes.</p><p>But Iâ€™m glad Iâ€™m going to have my own charger before the month is over, because the â€œfastâ€ chargers like the one illustrated here
are in demand and not well maintained; of the two in the picture, one is out of order and apparently has been for a couple of
months</p></li><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/15/IMG_20190117_170440.png\\" alt=\\"I-Pace at fast charger\\"/><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/15/IMG_20190117_170532.png\\" alt=\\"I-Pace, fast charger and its infrastructure\\"/><div class=\\"caption\\"><p>Above, charging in progress; below, another angle. The black box at the right below is supporting infrastructure;
the label on the side says 80A worth of 3-cycle power.</p></div><li><p>Thereâ€™ve been stories of people having trouble getting their I-Paces to connect to one charger model or another, but Iâ€™ve
had none on two out of two experiences.  The â€œfast chargerâ€ took me from 86% to 96% full in a half-hour.  (Thatâ€™s 11.26 kWh, or
almost exactly one Canadian dollarâ€™s worth at<a href=\\"https://app.bchydro.com/accounts-billing/rates-energy-use/electricity-rates/residential-rates.html\\">residential rates</a>.)
This is not as lame
as it sounds, because the charging speed declines as the battery fills up, notably slowing down past 80%.  Thus, when on
a road trip, itâ€™s considered to be smart and courteous, at a roadside fast-charger, to unplug and go at 80%.</p></li><li><p>The turning radius is large, bigger than our old Honda vanâ€™s.  Maybe something to do with the wheels being
pushed out to the corners? This is particularly annoying because any fool can get into the rhythm of jamming a shift-stick back and
forth between Drive/1st and R while three-pointing on a narrow street, but my fingers are nowhere near learning how to hit the Jagâ€™s
D and R buttons without looking.</p></li><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/15/seat.png\\" alt=\\"I-Pace car seat adjustments\\"/><li><p>Iâ€™m dealing with angst about the seat position; itâ€™s a paradox-of-choice problem, there are just too many
controls.  I may have to go all engineer and take a systematic approach, making one change at a time on one lever at a
time.  I should be clear that itâ€™s a fabulously comfortable seat, itâ€™s just that I canâ€™t prove it couldnâ€™t be better.</p></li><li><p>The â€œPark Assistâ€ feature, which has two dedicated buttons, doesnâ€™t work.  Itâ€™s not just me, I<a href=\\"https://www.ipaceforums.co.uk/viewtopic.php?f=8&t=905\\">asked my peers</a>and everyone agrees that yeah, itâ€™s just
broken. Shame on Jaguar, other modern cars get this right. I wonder if it can be fixed in software?</p></li><li><p>In fact, itâ€™s a good thing that the I-Pace is so much fun to drive, because itâ€™s generally a pain in the ass to park.  The
visibility through the tiny dim near-horizontal back window is laughable, the rear-view camera is a little laggy (great picture
though), and the car is wide.  Iâ€™m sure Iâ€™ll figure out a way to curve into place, reasonably close to and parallel to the curb, but
I havenâ€™t yet.</p></li><li><p>Driving my fossil car to work was dumb and this one being electric doesnâ€™t change that.  Parking is still
expensive, as are the L2 chargers in Vancouver office-building basements.</p></li></ol></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Jag Diary 3: What We Know",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/07/07/I-PACE-3",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "4",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/07/07/I-PACE-3#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/07/07/I-PACE-3",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-07-07T12:00:00-07:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-16T21:15:07-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Between June 4th, when the first wave of reviews of the New Jag hit (offically the I-PACE, what a dumb name) and the time the salesman called me saying â€œTime to sign the order if you want to be in the first waveâ€, I had to decide whether to spend a lot of money on a car Iâ€™d never seen or touched.  So I paid damn close attention to those reviews. Iâ€™m a critical reader, and suspicious about the motives of product reviewers, and I think the picture that emerges is pretty clear.  This post is to enumerate what I think itâ€™s possible to know for sure about the car without having owned or even driven one.<i>[Updated based on hands-on experience.]</i></div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Between June 4th, when the first wave of reviews of the New Jag hit (offically the I-PACE, what a dumb name) and the time the
salesman called me saying â€œTime to sign the order if you want to be in the first waveâ€, I had to decide whether to spend a lot of
money on a car Iâ€™d never seen or touched.  So I paid damn close attention to those reviews. Iâ€™m a critical reader, and suspicious
about the motives of product reviewers, and I think the picture that emerges is pretty clear.  This post is to enumerate what I think itâ€™s
possible to know for sure about the car without having owned or even
driven one.<i>[Updated based on hands-on experience.]</i></p><p>Iâ€™ll throw in a bunch of links down at the bottom to reviews that I think are particularly useful.</p><h2 id=\\"p-1\\">Facts</h2><ul><li><p>The story starts in 2014, when Jag leadership decided to go all-in on a from-scratch electric model.  They put an integrated
development team all in one room at the University of Warwick<span class=\\"dashes\\">â€‰â€”</span>â€‰not exactly traditional auto-biz
practice<span class=\\"dashes\\">â€‰â€”</span>â€‰and eventually brought the new car from nothing to market in â€œonlyâ€ four years, which is
considered very good in that industry.</p></li><li><p>It has two motors, one wrapped round each axle, with the space between full of battery, then the cabin perched on
top. At moderate speeds, only the back wheels drive.</p></li></ul><img src=\\"underneath.png\\" alt=\\"Underneath\\"/><ul><li><p>Itâ€™s almost all aluminium and, despite that, is still super-heavy (2100kg), mostly because of the battery.</p></li><li><p>Iâ€™m not going to recite horsepower and torque numbers that I donâ€™t understand, but people who do understand them sound
impressed.</p></li><li><p>I donâ€™t understand charging issues well enough to have an intelligent opinion, but<a href=\\"https://twitter.com/llsethj\\">Seth Weintraub</a>does, and<a href=\\"https://electrek.co/2018/06/14/jaguar-i-pace-review-the-240-mile-luxury-sport-utility-is-everything/\\">his review</a>is
full of useful detail. Tl;dr: The range is competitive with other high-end electrics.</p></li><li><p>It doesnâ€™t have gears as such, just buttons: P, N, R, D.  The North American edition comes only with air suspension, and has
a thing where you can elevate the car for a tricky driveway or rutted gravel, and it settles down automatically at high
speeds. I gather the Euro model can be bought with springs.</p></li><li><p>Another difference: The Euro model comes with either a standard or glass roof; in the New World itâ€™s all-glass all the time.
Personally, Iâ€™d prefer a layer of metal between me and the sun, but they claim itâ€™s sufficiently shaded and
UV-impervious.</p></li><li><p>Electrics are super quiet inside so, if you want, the Jag will play you a spaceship-y acceleration sound that changes with
the speed. Fortunately itâ€™s optional; although one of the journos who took it out on the racetrack said he found it useful in
situations where you donâ€™t have time to look at the speedometer.</p></li><li><p>Thereâ€™s a screen behind the steering wheel where you can display speed and charge and maps and so on.  Front center, thereâ€™s
a biggish (but not Tesla size) screen above for Infotainment, and a smaller one below for climate control.  On the subject of
climate control, the console has a couple of actual physical knobs for that.</p></li></ul><img src=\\"black-interior.png\\" alt=\\"Black interior\\"/><img src=\\"white-interior.png\\" alt=\\"White interior\\"/><ul><li><p>Itâ€™s got a fair-size trunk at the back (the back seats fold down 60/40) and a tiny one under the front hood; someone
suggested it was just big enough to carry your cat.</p></li><li><p>As with most electrics, you can do one-pedal driving, where easing off the accelerator goes into regeneration mode and
provides enough breaking for all but exceptional circumstances.</p></li><li><p>You can actually take it off-road, up and down stupidly steep hills, through really deep puddles, and so on: The â€œLRâ€ part of
JLR is Land Rover, and that part of the company knows something about those things.</p></li><li><p>Thereâ€™s plenty of room inside for four big adults. The person in the middle of the back seat should be on the small
side.</p></li><li><p>Nobody has seen either Apple CarPlay or Android Auto at work, but the company claims that both will be supported.  My own Jag
dealer said heâ€™d heard that theyâ€™d done the technology work were just doing licensing and payment.<i>[Hands-on: It works fine!]</i></p></li><li><p>It has a SIM slot and over-the-air software update.</p></li><li><p>You can equip it with a tow-bar and bike-rack and roof-rack.</p></li><li><p>Itâ€™s built, not by JLR themselves, but by<a href=\\"https://en.wikipedia.org/wiki/Magna_Steyr\\">Magna Steyr</a>, a contract manufacturer in Graz, Austria, that also builds
the Mercedes G-Class and BMW 5 Series.</p></li></ul><h2 id=\\"p-2\\">Things that are good</h2><ul><li><p>Everyone agrees that itâ€™s a blast to drive.  Whatâ€™s interesting is that the most common comment was â€œfeels just like a
Teslaâ€. The<cite>Top Gear</cite>scribe pointed out, in a melancholy tone, that apparently all electric motors feel more or less
like all others.  This is a big change from the days of
internal-combustion engines, which have all sorts of personality.  Itâ€™s fast, maneuverable, and comfortable.<i>[Hands-on: Oh yeah!]</i></p></li><li><p>The one-pedal driving mode takes a bit of getting used to but all the journos ended up loving it, and assuming that pretty
everyone would use it all the time.</p></li><li><p>The seats are said to be super-comfortable.<i>[Hands-on: Yup.]</i></p></li><li><p>It has all the bells and whistles and technology gadgets anyone could want.</p></li><li><p>The cabin has all sorts of storage space in bins here and there and under the back seats and so on.</p></li><li><p>It has more than enough range for people who drive around town and then occasionally go 200+ km for business.</p></li></ul><h2 id=\\"p-4\\">Things that are not so good</h2><ul><li><p>If youâ€™re a road warrior, Jag doesnâ€™t have anything to compete with Teslaâ€™s supercharger network.  Iâ€™ve started poking around<a href=\\"https://www.plugshare.com/\\">PlugShare</a>and<a href=\\"https://www.chargepoint.com/en-ca/\\">ChargePoint</a>and so on, and I think you could manage road trips, but itâ€™s not going
to be as slick as with a Tesla. Perhaps this situation will improve?</p><p>Me, I have a carport on the back alley and Iâ€™ll put in a charger and I should be fine.</p></li><li><p>The infotainment system is slow and laggy, and some important settings are deeply nested into the menus.
Android Auto is my answer to that.<i>[Hands-on: The lag is not really an irritant once you get into the systemâ€™s rhythm but yeah,
the menus could be better-organized.]</i></p></li><li><p>The storage space isnâ€™t that well-organized and itâ€™s not obvious where to stow the charging cables.</p></li><li><p>The fifth person in the car is going to be kind of cramped.</p></li><li><p>Visibility out the back window is lousy, with big rear posts getting in the way.<i>[Hands-on: The window is tiny, nearly
horizontal, and shaded, so the view is ludicrously bad.  Thereâ€™s a back-up camera to help with parking though.]</i></p></li><li><p>The brake pedal tries to combine regenerative and friction braking and as a result is said to feel soft and weird.<i>[Hands-on: Donâ€™t know what was bothering them, my leg likes it fine.]</i></p></li><li><p>The air-suspension ride has been reported as feeling a bit jittery and unstable at low/moderate speeds.<i>[Hands-on: Nope, but Iâ€™ve found the regen braking can be a bit quease-inducing for passengers while driving in traffic.]</i></p></li><li><p>The center console crowds the driverâ€™s leg a bit; more of a problem in left-hand drive vehicles, obviously.<i>[Hands-on: Not at all, thereâ€™s plenty of room for my legs, and Iâ€™m 5â€™11\\".]</i></p></li></ul><h2 id=\\"p-6\\">My conclusion</h2><p>What happened was, when the first buzz of publicity hit in March I was interested enough to drop by<a href=\\"https://www.jaguarvancouver.ca/en\\">Vancouver Jaguar</a>and talk to Caleb Kwok, the sales manager. Heâ€™s a plausible guy,
responsive to email, and anyhow, he convinced me to put down a refundable deposit, buying me a place near the front of the
line at the time actual orders would open up.  Which turned out to be last week.</p><p>By which time Iâ€™d read all the material summarized in this piece.  On balance, I liked what I heard; the pluses were pretty big
and none of the minuses bothered me that much. Remember, the longest trip I normally take is 230km to Seattle, where I park for a
couple of days then drive home.</p><p>So I signed on the dotted line, and my deposit is no longer refundable.</p><p>The big worry, of course, is reliability and manufacturing quality.  Jaguar, at various times in its history, has had a miserable
reputation.  Of one famous model, they used to say â€œItâ€™s a great car, so buy two, because one will always be in the shop.â€  Itâ€™s
worse than that; Jag at one point had a particularly stinky track record around electrical systems.</p><p>But there are stats suggesting Jagâ€™s doing better in recent years. And then thereâ€™s the fact that itâ€™s being built in a plant where
they also make Mercedes and BMW.  Granted, Iâ€™m taking a chance here.</p><h2 id=\\"p-5\\">Helpful reviews</h2><ul><li><p><a href=\\"https://arstechnica.com/cars/2018/06/forget-about-that-tesla-the-jaguar-i-pace-is-the-most-compelling-ev-yet/\\">Forget about that Teslaâ€”the Jaguar I-Pace is the most compelling EV yet</a>at<cite>Ars Technica</cite>.</p></li><li><p><a href=\\"https://www.engadget.com/2018/06/14/2019-jaguar-ipace-review/\\">Jaguar I-Pace review: A luxury EV that can tackle anything</a>at<cite>Engadget</cite>.</p></li><li><p><a href=\\"https://www.topgear.com/car-reviews/jaguar/i-pace\\">The Top Gear car review: Jaguar I-Pace</a>at<cite>BBC Top Gear</cite>.</p></li><li><p><a href=\\"https://www.edmunds.com/car-news/first-impressions/2019-jaguar-i-pace-first-drive.html\\">2019 Jaguar I-Pace First Drive</a>at<cite>Edmunds</cite>.  By the way,
Edmundsâ€™<a href=\\"https://www.edmunds.com/car-reviews/long-term-road-tests/\\">Long-Term Road Tests</a>are the gold standard in automotive
reportage.  Iâ€™m sure theyâ€™ll onboard one of the new Jags and if youâ€™re thinking â€œmaybeâ€, I strongly advise watching out for
that.</p></li><li><p><a href=\\"https://www.motortrend.ca/en/news/2019-jaguar-i-pace-review-london-to-berlin-electric-jag/\\">2019 Jaguar I-PACE Review: From
London To Berlin In An All-Electric Jag</a>at<cite>Motor Trend</cite>.</p></li><li><p><a href=\\"https://www.youtube.com/watch?v=FILPOpickH4\\">Jaguar I-Pace SUV 2019 in-depth review | Mat Watson Reviews</a>at<cite>CarWow</cite><span class=\\"dashes\\">â€‰â€”</span>â€‰this is the most negative
review I ran across, and really highlights all the places where the new Jag could have been better.</p></li></ul></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Jag Diary 6: I-Pace Day Two",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/01/14/I-Pace-Day-2",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "3",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/01/14/I-Pace-Day-2#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/01/14/I-Pace-Day-2",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-14T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-15T18:19:08-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">No highways were harmed in the preparing of this blog fragment; our new I-Pace is for the moment an urban runabout.  In town, it doesnâ€™t get you anywhere faster than a Honda Fit or 20-year old Ford Focus would. But those burn fossil fuels and we should all try to stop doing that.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>No highways were harmed in the preparing of this blog fragment; our new I-Pace is for the moment an urban runabout.  In town, it
doesnâ€™t get you anywhere faster than a Honda Fit or 20-year old Ford Focus would. But those burn fossil fuels and we
should all try to stop doing that.</p><p><i>[Yes, I said I was going to do live updates to Sundayâ€™s<a href=\\"/ongoing/When/201x/2019/01/13/My-I-Pace\\">Green Light</a>piece, but that turns out to be annoying. Sorry.]</i></p><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/14/IMG_20190113_202700.png\\" alt=\\"Jaguar projection\\"/><div class=\\"caption\\"><p>The door handles are flush when parked, but slide out when you unlock.
When you unlock at night they glow and project, absurdly albeit with decent kerning,
on the adjacent pavement.</p></div><ol><li><p>I originally wanted to get white paint because I unhealthily loved the red-leather-seats option and thought the
white/red combo was cool.  And I still think so, but Iâ€™m glad Lauren convinced me to go for<a href=\\"https://duckduckgo.com/?q=caesium+blue&atb=v147-4__&iax=images&ia=images\\">Caesium Blue</a>.  Itâ€™s a lovely color,
lighter than it seems in online pictures.</p><p>I was afraid the blue/red would look kind of garish but now that Iâ€™ve seen it I donâ€™t
care. If I worried about that kind of thing I wouldnâ€™t buy a Jaaag, right?  I do wish they offered a nice forest green
though.</p></li><li><p>Itâ€™s dead cool to pull out your phone, pop open the carâ€™s remote-control app, and set the internal climate to 20Â°C
ten minutes before you go out to drive somewhere on a Canadian winter night.</p></li><li><p>The headlights have autonomic voodoo; they click into high-beam mode when they think nobodyâ€™s in front of you
(correctly, so far) and apparently try to point away from the eyes of drivers in oncoming lanes.</p></li><li><p>Yeah, the infotainment screen navigation is kinda klunky and slow, and the menu tree isnâ€™t the most intuitive thing.
But itâ€™s not<em>that</em>big.</p><p>I found that within a day, I had perfected a leisurely wave gesture, somewhat in the style of a Tai Chi master or opium
smoker, and achieved menu mastery.</p></li><li><p>When I plugged in my Pixel 2, Android Auto initially coughed and belched, but the kinks worked
themselves out and itâ€™s now a first-class citizen of the big middle screen.  Itâ€™s kind of cool having Google maps on the big screen
and Jagâ€™s own maps, which are more eyecandyful, up on the â€œinstrument
panelâ€ screen behind the steering wheel.</p></li><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/14/IMG_20190115_081506.png\\" alt=\\"Jaguar I-Pace screens including Google Play\\"/><div class=\\"caption\\"><p>Aesthetics by Jaguar on the left, by Google on the right.</p></div><li><p>Prior to buying the car, Iâ€™d blown off negative comments on its infotainment app by saying â€œwho cares, Iâ€™m going
to use software from a software company.â€  But I have to say that the general presentation of the Jag software on Jagâ€™s screens is
prettier than Android manages. Thereâ€™s been attention to typography, there are tonal gradients in the background, and so on.</p><p>Having said that, it doesnâ€™t have my 13,096 songs in the cloud like Google does, and doesnâ€™t know what â€œOK Google, text Laurenâ€
means, nor â€œOK Google, Calgary weather.â€</p><p>Iâ€™m not actually sure what outcome Iâ€™d like to see on this one.</p></li><li><p>The user manual is available as a<a href=\\"https://play.google.com/store/apps/details?id=com.jaguar.iguideapp&hl=en_us\\">mobile app</a>; the Android version gets
horrible reviews mostly because it only covers a couple of Jaguar models. Itâ€™s actually not bad, with a search function and visual guide
and rich hyperlinking.  Thereâ€™s also a PDF version online at<a href=\\"http://www.ownerinfo.jaguar.com/\\">ownerinfo.jaguar.com</a>, and then when you get the car thereâ€™s a hefty slab of dead
trees in the glovebox.</p><p>However, all of these are sadly incomplete in their coverage.  For example: The car comes with a feature where you can have it
play whooshy spaceship crescendos as you accelerate, to help petrol-heads who are missing that fossil-combustion roar. No form
of the manual told me where in the menus it was hiding. OK, I was trying to impress a 12-year-old, but still.</p><p>Also, I wanted to fool with the instrument panel display, which has many modes.  The manual is full of English
sentences that have subjects and verbs and objects but somehow failed to map, in my mind, to what I was seeing on the carâ€™s
screens. I appreciated the advice Iâ€™d picked up in the online Jaguar community, which is that this wisdom is best consumed with the
help of a couple of glasses of the Famous Grouse. So I went and bought some, but there are lots better Scotches and it didnâ€™t help<em>that</em>much.</p></li><li><p>Oh right, online communities.  The best for my money is at<a href=\\"https://www.ipaceforums.co.uk/\\">ipaceforums.co.uk</a>although, as the name suggests, itâ€™s Euro-heavy.  Thereâ€™s also<a href=\\"https://www.i-paceforum.com/\\">i-paceforum.com</a>(note the hyphen) but itâ€™s not as good.  On Reddit thereâ€™s<a href=\\"https://www.reddit.com/r/jaguar\\">r/jaguar</a>and the still-embryonic<a href=\\"https://www.reddit.com/r/ipace\\">r/ipace</a>.</p></li><li><p>Iâ€™ve signed the car into the home WiFi network and turned
mobile data on.  It came with an AT&T Canada SIM and despite several pleading emails from AT&T, I have no idea what that does.  It
was already network-connected somehow because the remote-control app tells me where it is and how charged it is and lets me do
things like turn on the heating inside.</p><p>I also turned network updates on, and noticed that the software is a couple releases behind the latest.
More investigation is<em>definitely</em>required.</p></li><li><p>Speaking of apps and suchlike, someone is<a href=\\"https://github.com/ardevd/jlrpy\\">building a Python library</a>to talk to the I-Paceâ€™s API, and making good progress.
There are lots of interesting APIs, many of which Jaguarâ€™s remote-control app doesnâ€™t use. Hmmmâ€¦</p></li></ol><p><i>[Life lesson: A really good time to write about something is while youâ€™re learning about it. I learned this from Mark Pilgrim
and if youâ€™ve never heard of him thatâ€™s
OK (if sad).]</i></p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Jag Diary 5: The Green Light",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/01/13/My-I-Pace",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "2",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/01/13/My-I-Pace#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/01/13/My-I-Pace",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-13T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-13T16:59:34-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Jaguar Diary",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">I picked up the new family wheels, a 2019<a href=\\"https://en.wikipedia.org/wiki/Jaguar_I-Pace\\">Jaguar I-Pace</a>, on January 12th.  Current plans are for this blog fragment to get updates for the next couple of weeks, through a planned road trip, per the â€œdiaryâ€ part of the series title.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>I picked up the new family wheels, a 2019<a href=\\"https://en.wikipedia.org/wiki/Jaguar_I-Pace\\">Jaguar I-Pace</a>, on January 12th.  Current plans are for this blog fragment
to get updates for the next couple of weeks, through a planned road trip, per the â€œdiaryâ€ part of the series title.</p><h2 id=\\"p-2\\">The wait</h2><p>Iâ€™d reserved a spot in March and ordered the
car in July, so itâ€™s been a wait, and Iâ€™ve been in a sort of Gatsby-and-the-green-light mode.  Itâ€™s not as simple as expectations
being high, although the carâ€™s<a href=\\"https://en.wikipedia.org/wiki/Jaguar_I-Pace#Awards\\">won loads of awards</a>; the early shipments have<a href=\\"https://www.ipaceforums.co.uk/viewforum.php?f=11&sid=616ddf0c1b89a313c4b3aa32405434a8\\">not been problem-free</a>,
and the car has picked up a legion of haters<span class=\\"dashes\\">â€‰â€”</span>â€‰chiefly<a href=\\"https://finance.yahoo.com/quote/TSLA\\">$TSLA</a>longs, but still.</p><h2 id=\\"p-4\\">JLR fail</h2><p>During the 5-month wait for the car, the number of times Jaguar contacted me: zero.  The number of status updates they gave
me: zero. The typical delay when I emailed asking what was up: Days.  Mind you, I was dealing with salespeople and,
from their point of view, the sale was already made.</p><p>Maybe Iâ€™m just dealing with a particularly lame salesperson or dealership, but in the event that I want to consider another
JLR product, you can bet I am<em>not</em>going back to<a href=\\"https://www.jaguarvancouver.ca/en\\">Jaguar Vancouver</a>and I wouldnâ€™t particularly recommend them.</p><p>In fairness, they handled the Big Day processes of paperwork shuffling, insurance coverage, taking my money, getting the<a href=\\"https://play.google.com/store/apps/details?id=com.jaguar.incontrolremote&hl=en\\">remote-control app</a>set up,
and explaining the carâ€™s workings, with perfect competence.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/13/IMG_20190112_141008.png\\" alt=\\"Jaguar I-Pace close-up\\"/><h2 id=\\"p-1\\">About as expected</h2><p>First important finding: If youâ€™ve been tracking the online traffic about the I-Pace, which I summarized in<a href=\\"/ongoing/When/201x/2018/07/07/I-PACE-3\\">Jag Diary 3: What We Know</a>, getting in the car and driving it around wonâ€™t
present that many surprises.  It is more or less what it says on the box, and what the Internet said about the box.</p><p>So Iâ€™m going to try to restrict myself in this space to findings that are new or refreshing or surprising, which probably means
of specific relevance to those who are some combination of Pacific Northwesterners, Internet geeks, urban dwellers,
environmentalists, and parents of teenagers.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2019/01/13/Journey-1.png\\" alt=\\"Journey 1\\" class=\\"inline\\"/><h2 id=\\"p-3\\">Day 1 impressions</h2><p>We picked up the car in the morning, then drove from Vancouver down to Steveston for lunch, then back home with stops for
photography and shopping. To the right, the Journey graphic
from the I-Pace remote app, which gets scathing reviews on Google Play.</p><ol><li><p>Itâ€™s smaller than youâ€™d think.  My carportâ€™s still under construction so the Jagâ€™s parked on the street in front of the house, and
itâ€™s not one of the larger cars along the block.  The contrast between small outside and spacious inside is shocking.</p></li><li><p>Itâ€™s nimble!  That electric-motor acceleration is awesome; Unless youâ€™ve stomped the accelerator in a Tesla or I-Pace you
just canâ€™t imagine what it feels like.  But in practice, it means that if youâ€™re trying to get out of the supermarket parking lot across
a couple lanes of oncoming traffic you can Just Do It, it feels like teleportation.</p></li><li><p>The seats are just awesomely comfortable<span class=\\"dashes\\">â€‰â€”</span>â€‰I sprung for the upscale-but-not-racing level, with
some huge number of adjustments, and it feels like Iâ€™m being cradled by a huge warm benevolent being.</p></li><li><p>The Meridian audio, at first listen, is underwhelming, the bass sounding unnaturally light to my ears. Will report back
after further adjustment.</p></li><li><p>The regen braking is fun, but when Lauren was driving and I was passenging, I found it a little uncomfortable.  Perhaps a
combination of us developing better one-pedal driving skills and passengers just getting used to it will change this finding.
But in the online I-Pace forums, a lot of people are recommending low-regen for comfort, especially on the highway.</p></li><li><p>Lauren, whoâ€™s 5â€™5\\" with a light build, found the driving position perfectly comfortable and loved the handling.
Sheâ€™s right<span class=\\"dashes\\">â€‰â€”</span>â€‰this car<em>loves</em>to warp around a corner at speed.</p></li><li><p>Parking takes some getting used to. It has lots of sensors and alarms which moan piteously if you get anywhere near the curb
or cars fore and aft.  My first attempt left it halfway out in the street, and crooked.</p></li></ol></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Oil Fail",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2019/01/06/Oil-Fail",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "5",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2019/01/06/Oil-Fail#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2019/01/06/Oil-Fail",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-06T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2019-01-06T23:45:53-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Environment",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Environment",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Business",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Business",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Today I learned things that I think every environmentalist and investment manager should know: A coherent argument that we are more or less at Peak Oil. Not the Nineties version, which worried that we might be running out of fossil fuels, but rather that global human petroleum demand is about at its all-time peak and about to start drifting down.  Some of the key data points involve electric cars, which I care a lot about, and China, which is always interesting.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Today I learned things that I think every environmentalist and investment manager should know: A
coherent argument that we are more or less at Peak Oil. Not the Nineties version, which worried that we might be running out of
fossil fuels, but rather that global human petroleum demand is about at its all-time peak and about to start
drifting down.  Some of the key data points involve electric cars, which I care a lot about, and China, which is always interesting.</p><p>The effects are likely not enough to avert the oncoming global-warming disaster, but there are grounds for optimism about reducing its
devastation.
However, this will very likely tear the guts out of the global petroleum business.</p><img src=\\"Gregor-Tweet.png\\" alt=\\"Tweet thread\\"/><p>What happened was, I ran across an<a href=\\"https://twitter.com/GregorMacdonald/status/1082018027967664128\\">interesting Twitter thread</a>starting with the bold claim
that the internal combustion engineâ€™s future had been killed and that the coming energy transition would pay for itself.  It was compelling
and I gave it a retweet, noting that people who live in an environmentalist-green bubble (for example, me) need to be
skeptical about things that weâ€™d like to be true.  And so we should.</p><p>But I was intrigued enough to buy a 105-page PDF called<cite>Oil Fall</cite>; you<a href=\\"https://gumroad.com/terrajoule\\">can too, for $9</a>, from its author<a href=\\"http://gregor.us/\\">Gregor Macdonald</a>.  If you care about these subjects, you should.
I sure enjoyed it.</p><p>(If you buy it: While you<em>can</em>read it on a Kindle, donâ€™t try, the typeâ€™s too small. It might be OK on an iPad.
Or you can just pop it open in
Preview on a Mac or whatever the Windows equivalent is.  Itâ€™s nicely typeset and illustrated; the print isnâ€™t dense and the 105 pages
go by fast.)</p><img src=\\"Oil-Fail-Cover.png\\" alt=\\"Oil Fall by Gregor Macdonald\\"/><p>The larger stories<span class=\\"dashes\\">â€‰â€”</span>â€‰of the increasingly-threatening specter of climate change, and the growing
viability of renewable energy<span class=\\"dashes\\">â€‰â€”</span>â€‰arenâ€™t new at all.  But thereâ€™s one piece of new news: The shocking surge of
Electric Vehicles (hereinafter EVs) in China in 2018, concurrent with a<em>decline</em>in overall vehicle sales there. Probably 1.2
million or so EVs were sold, surging to comprise 7% of all sales toward the end of the year.  Here are a couple of instructive
links:<a href=\\"https://cleantechnica.com/2018/11/03/china-has-record-electric-car-sales-month-china-electric-car-sales-report/\\">CleanTechnica</a>and<a href=\\"https://qz.com/1492452/car-sales-in-china-are-slowing-but-sales-of-electric-vehicles-evs-continue-to-grow/\\">Quartz.com</a>.</p><p>The argument in<cite>Oil Fall</cite>spends a lot of time on electric cars, since they are at a point of surprisingly high leverage in the
global energy economy.</p><p>Iâ€™m not going to replicate the<cite>Oil Fall</cite>narrative, but hereâ€™s a quick sort-of outline.</p><ol><li><p>Los Angeles as a case study in EV adoption. Itâ€™s not the US leader (thatâ€™d be the Bay Area) but itâ€™s got huge
leverage.</p></li><li><p>The politics and economics of renewable energy in California and across the US.</p></li><li><p>The special leverage of the EV on the energy economy.</p></li><li><p>The structure of Chinaâ€™s (historically coal-dominated) energy economy.</p></li><li><p>Why China is crucial to the future price of fossil fuel</p></li><li><p>The timing of the peak in global oil demand.</p></li><li><p>Efficiencies and inefficiencies in fossil and renewable energy sources.</p></li><li><p>The issue of energy storage.</p></li><li><p>Economic cost of transition to renewables; estimates have been around 2% of GDP, but Macdonald thinks itâ€™ll be closer to
zero, or even negative. Thatâ€™s what Alexandria Ocasio-Cortez and the young US progressives are arguing with their â€œGreen New Dealâ€
proposal.</p></li><li><p>Global-warming prospects.</p></li></ol><h2 id=\\"p-4\\">On the writing</h2><p>I donâ€™t know much about Macdonald. His resume sounds respectable, and I quote: â€œHe has written for<cite>Nature</cite>,<cite>The Economist
Intelligence Unit</cite>,<cite>The Financial Times</cite>of London,<cite>The Harvard Business Review</cite>, Atlantic Mediaâ€™s<cite>Route Fifty</cite>,<cite>The Petroleum
Economist</cite>, and<cite>Talking Points Memo</cite>.â€</p><p>The text is well-supplied with numbers and supporting infographics. He is careful to address,
for each key point, the objections to his reasoning and alternative scenarios that arise in the case that heâ€™s wrong.
I didnâ€™t check his numbers exhaustively, but every one of those that I did try to verify checked out.</p><p>The style is that of a professional journalist: Not colorful but extremely clear, readable, and full of named real-world
examples illustrating his arguments.</p><p>Iâ€™m going to dig a little deeper into a couple of points that were new to me and resonated.</p><h2 id=\\"p-5\\">On EVs and storage</h2><p>Anybody whoâ€™s a renewable-energy fan needs to have thought a lot about energy storage. The sun only shines during the daytime and
sometimes even prevailing winds donâ€™t blow.  Macdonald goes deep on the subject, and offered a pretty compelling argument that there
are plausible market-driven solutions to meet storage needs.</p><p>One part of the argument involves electric cars, and is obvious once you think of it.  Planet-wide, we are now building millions
per year, and every one is built around a battery ranging in capacity between 20 and 90KWh.  Do some multiplication and you get a
damn big energy-storage capability, made up of a huge number of independently-owned consumer products. They arenâ€™t terribly fussy what time of
day you charge them, they are network-connected, and managing the network to charge them when the capacity is most available
feels like a straightforward application of the sort that I work on every day.</p><h2 id=\\"p-6\\">On EVs and negawatts</h2><p>That term â€œnegawattâ€ was coined way back in 1985 by<a href=\\"https://en.wikipedia.org/wiki/Amory_Lovins\\">Amory Lovins</a>, one of the original big energy-policy thinkers.  He did
the math and showed that the cheapest way to get more power while doing less damage was simply to cut waste.  And itâ€™s worked: Our
houses are better insulated now, our cars get more mileage, and our appliances run cooler and smarter.</p><p>But the global energy-efficiency picture is still terrible.  The whole fossil-combustion ecosystem wastes something in the
neighborhood of 50% of the available energy.  Itâ€™s not uniform: For example, a modern natural-gas based generator wastes less. But
internal-combustion vehicles waste a lot more, even today the figure is in
the 70%-wasted range.</p><p>EVs, on the other hand, turn electrons into kilometers at an efficiency well over 90%.  Of course, that
doesnâ€™t help if youâ€™re using
electricity that was generated in a fossil-fueled plant; but traveling in a renewable-fed EV is a rich source of negawatts.</p><p>To quote Macdonald: â€œBut, the loss is quite a bit worse with every gallon of petrol poured
into an internal combustion engine. Indeed, if your goal was to waste
as much energy as possible, you could do no better than to feed
gasoline into a billion vehicles, each with their own separate engine,
with multiple surfaces from which heat can rise.â€</p><h2 id=\\"p-8\\">Is oil over?</h2><p>Of course not, donâ€™t be silly.  Everyone agrees that coal is â€œoverâ€ and yet its usage hasnâ€™t plummeted, itâ€™s just been drifting down
for a long time, with a temporary spike as China industrialized.  Petroleum remains useful in a huge number of industrial chemical processes,
and in certain particularly energy-intensive transportation applications, like heavy trucks and probably almost all aviation.
We donâ€™t need to stamp out oil to save the planet, just burn less.</p><p>My own particular guess is that natural gas is going to be strategic. Itâ€™s relatively energy-dense, straightforward to extract
and transport, and carbon-light; it feels like a good fit for filling in
renewable-energy gaps.</p><h2 id=\\"p-7\\">On investing</h2><p>Thereâ€™s a trend where â€œethical investorsâ€ try to steer capital away from the petroleum industries, and I broadly
approve, mostly due to fear of climate change. But if Macdonald is right (and heâ€™s pretty convincing) this is also a good way to
remove a major source of risk from your portfolio.</p><p>Donâ€™t say I didnâ€™t warn you.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Serverlessness",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/09/Serverlessness",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "3",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/09/Serverlessness#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/09/Serverlessness",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-09T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-30T17:39:17-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">I work in AWSâ€™s Serverless group, and in the process of pulling together my<a href=\\"https://www.youtube.com/watch?v=IPOvrK3S3gQ\\">presentation at re:Invent</a>, discovered that I have a lot of opinions on the subject and, while they may well be wrong, are at least well-informed.  You can watch that YouTube, but whoâ€™s got an hour to spare? And anyhow, bloggingâ€™s really my favorite medium, so here we go.  If I tried to glom them all together into one mega-essay itâ€™d be brutally long, so letâ€™s go short-form.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>I work in AWSâ€™s Serverless group, and in the process of pulling together my<a href=\\"https://www.youtube.com/watch?v=IPOvrK3S3gQ\\">presentation at re:Invent</a>, discovered that I have a lot of opinions on the
subject and, while they may well be wrong, are at least well-informed.  You can watch that YouTube, but whoâ€™s got an hour to spare?
And anyhow, bloggingâ€™s really my favorite medium, so here we go.  If I tried to glom them all together into one mega-essay itâ€™d be
brutally long, so letâ€™s go short-form.</p><h2 id=\\"p-3\\">The Serverless Fragments</h2><p>â€œServerless Fragmentâ€ has five syllables and<span class=\\"o\\">ongoing</span>doesnâ€™t have that much room at the top of the page
for the title, so letâ€™s say â€œSFâ€.</p><ol><li><p><a href=\\"/ongoing/When/201x/2018/12/10/SF-1\\">SF 1: What is serverless?</a>Tl;dr: Itâ€™s when you donâ€™t have to reserve capacity before you start.  But itâ€™s not a binary
condition.</p></li><li><p><a href=\\"/ongoing/When/201x/2018/12/10/SF-2\\">SF 2: Why serverless?</a>Tl;dr: Frugality, Security, Elasticity.  That partâ€™s a no-brainer, but will you also get better
software?</p></li><li><p><a href=\\"/ongoing/When/201x/2018/12/11/SF-3\\">SF 3: Serverless everything?</a>Tl;dr: Nope, serverless where possible. To start with, think about control planes and data
planes.</p></li><li><p><a href=\\"/ongoing/When/201x/2018/12/14/SF-4\\">SF 4: Serverless latency?</a>Tl;dr: Itâ€™s complicated. And, there are things to do about it.</p></li><li><p><a href=\\"/ongoing/When/201x/2018/12/30/SF-5\\">SF 5: Serverless bills?</a>Tl;dr: Not<em>always</em>lower. But it depends how you count it.</p></li></ol></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "SF-5: Serverless Bills?",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/30/SF-5",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "0",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/30/SF-5#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/30/SF-5",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-30T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-30T17:38:53-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">One of the best reasons to go serverless is that you might save a lot of money. This is especially true when your load is peaky and has quiet times; because when your infrastructure isnâ€™t working, youâ€™re not paying.  But, not all loads are peaky.  And hereâ€™s a quote from an AWS internal mailing list: â€œFor every compute load, thereâ€™s some level of TPS where Lambda is going to be more expensive than servers.â€  So, when is that?  And how much should you care?</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>One of the best reasons to go serverless is that you might save a lot of money. This is especially true when your load is peaky
and has quiet times; because when your infrastructure isnâ€™t working, youâ€™re not paying.  But, not all loads are peaky.  And hereâ€™s a
quote from an AWS internal mailing list: â€œFor every compute load, thereâ€™s some level of TPS where Lambda is going to be more
expensive than servers.â€  So, when is that?  And how much should you care?</p><p><i>[This is part of the<a href=\\"/ongoing/When/201x/2018/12/09/Serverlessness\\">Serverlessness</a>series.]</i></p><h2 id=\\"p-1\\">Saving money with servers</h2><p>The answer, of course, like<em>always</em>, is â€œit dependsâ€.  But letâ€™s just jump straight to what strikes me as the canonical
example of someone for whom serverless didnâ€™t work out financially. To learn about it, check out this blog piece by Cory Oâ€™Daniel,<a href=\\"https://medium.com/coryodaniel/from-erverless-to-elixir-48752db4d7bc\\">From $erverless to Elixir</a>.</p><p>Tl;dr: No, wait, I
donâ€™t want to do a Tl;dr! The piece is funny and wise and instructive and if you care about this stuff, you should just go read it.
Go ahead, Iâ€™ll wait and be here when you get back.</p><p>Thereâ€™s no doubt at all that they saved a lot of money. The key lessons I took away from Oâ€™Danielâ€™s piece:</p><ol><li><p>They were smart to start up serverless, the app was running fine and requiring no management.</p></li><li><p>It was<em>hard</em>to get the serverful version running; they saw success on the third attempt, and ended up needing to
know a whole lot about the inner workings of the Erlang ecosystem.</p></li><li><p>As Cory says, â€œMind that we already have an ops team and we already have a Kubernetes cluster running.â€</p></li><li><p>Elixir is massively cool.  I want to use it for something before I give up on computers.</p></li></ol><p>And of course, Coryâ€™s closing soundbite (most highlighted on Medium) is worth reproducing:</p><blockquote><p>So, should everyone go and rewrite their Serverless services in Elixir? Roll out Kubernetes? Get a nose piercing?
Absolutely not â€¦
What everyone should do is think about where your service is going, and can you afford those costs when you get there. If you
donâ€™t have a team of ops people and you arenâ€™t familiar with serverful stuff, spending $30k/mo on HTTP requests might be cheaper
than an ops team.</p></blockquote><h2 id=\\"p-2\\">Do I agree?</h2><p>Mostly, I think.  Although if Cory worked for me I probably would have been sort of pushy about making absolutely sure that there
was no way to keep the current system around and still save some money, rather than toss-and-replace (on the third attempt).  I note
that a lot of their charges were API Gateway, and there are other ways to get data into the system.  The data was on Kinesis, which
is fine, but there are cases where something like SQS or Kafka can be cheaper.
But in the last analysis, itâ€™s not written in letters of gold on stone that serverless will<em>always</em>be cheaper.</p><h2 id=\\"p-4\\">Cheaper serverless</h2><p>To get a feel for the kind of thing Iâ€™d look for, letâ€™s head over to another blog piece,<a href=\\"https://runbook.cloud/blog/posts/how-we-massively-reduced-our-aws-lambda-bill-with-go/\\">How We Massively Reduced Our AWS
Lambda Bill With Go</a>, by Sam Bashton of<a href=\\"https://runbook.cloud/\\">Runbook.cloud</a>, a nifty-looking monitoring/troubleshooting service.  His narrative sort of
echoes Coryâ€™s, off the top: A popular Lambda-based app started running up some big bills, to the point where it was becoming
painful.</p><p>This particular Lambda (like Coryâ€™s) didnâ€™t do much more than pull some data in over the network and persist it.  What was
hurting is that they were running the function for each customer, for each AWS region, every five minutes.  And since business was
good the number of customers was increasing fast; well, you do the math.</p><p>Rather than retreating to servers, what they did was smash all those functions together into one, and bring the magic of the Go
language Lambda runtime to bear. Let me quote Sam:</p><blockquote><p>In a single morning we refactored the code to use a single Lambda invocation every minute, operating on 20% of the
customer base each time. This Lambda spawns a Goroutine per customer, which spawns a Goroutine per region, which spawns a Goroutine
per AWS service. The Lambda execution time hasnâ€™t increased significantly, because as before weâ€™re mainly waiting on network I/O -
weâ€™re just waiting on a lot more responses at the same time in a single Lambda function. Cost per customer is now much more
manageable however, becoming lower and lower with every sign up.</p></blockquote><p>Isnâ€™t that nice?  And no throwaway code, either.</p><h2 id=\\"p-3\\">Closing thoughts</h2><p>My opinion hasnâ€™t changed at all: For building software,<em>use serverless where you can</em>.  Obviously, â€œwhere you canâ€ depends a
lot on the specifics of your app and your budget and your sensitivities.</p><p>And when youâ€™re working out the costs of serverless vs
serverful, ask yourself: How much is it worth to you to not have to manage hosts, or containers, or capacities, or Kubernetes?  I
donâ€™t know the number, but Iâ€™m pretty sure itâ€™s not zero.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Christian Practice",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/26/Christmas",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "3",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/26/Christmas#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/26/Christmas",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-26T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-30T14:39:50-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Religion",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Religion",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Iâ€™m in<a href=\\"https://en.wikipedia.org/wiki/Regina,_Saskatchewan\\">Regina, Saskatchewan</a>with family for the holidays. Someone said â€œLetâ€™s go to a Christmas Eve carol serviceâ€ and five of us did that. We went to<a href=\\"http://www.lakeviewchurch.ca/\\">Lakeview United</a>, where â€œUnitedâ€ signifies the<a href=\\"https://en.wikipedia.org/wiki/United_Church_of_Canada\\">United Church of Canada</a>, the biggest Protestant denomination up here. It was uplifting and pleasant and sort of sad.  Disclosure: Iâ€™m not Christian at all; but still.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Iâ€™m in<a href=\\"https://en.wikipedia.org/wiki/Regina,_Saskatchewan\\">Regina, Saskatchewan</a>with family for the holidays. Someone
said â€œLetâ€™s go to a Christmas Eve carol serviceâ€ and five of us did that. We went to<a href=\\"http://www.lakeviewchurch.ca/\\">Lakeview United</a>, where â€œUnitedâ€ signifies the<a href=\\"https://en.wikipedia.org/wiki/United_Church_of_Canada\\">United Church of Canada</a>, the biggest Protestant denomination up
here. It was uplifting and pleasant and sort of sad.  Disclosure: Iâ€™m not Christian at all; but still.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2018/12/26/IMG_20181224_203657.png\\" alt=\\"Carol Service at Lakeview United\\"/><p>As you can see, the congregation (for the 8PM December 24th service) was sparse and elderly.  The statistics are remorseless:<a href=\\"http://www.intrust.org/Magazine/Issues/New-Year-2016/Religious-affiliation-and-attendance-in-Canada\\">Christianity is
in decline</a>. The proportion of Canadians who attend church weekly is not far from 10%.</p><p>This surprises me, if only because the Churchâ€™s tools are still very strong.  The voices raised in Christmas hymns were
breathtaking (the crowd, while small, sang well), the Gospelâ€™s words telling the Christmas story were beautiful, and Sue Breisch,
the Minister, was eloquent and welcoming, broadcasting love and empathy.<a href=\\"http://www.lakeviewchurch.ca/media?speaker=3\\">Here</a>are some of her sermons.</p><p>The building is really fine in a Sixties kind of way, its
main hall comfortable, with big comfy rocking chairs and coffee tables at the back.</p><p>Maybe itâ€™s as simple as this: Even if you donâ€™t actively disbelieve (as I do) the Christian narrative, religion has lost its
urgency, and as lives are increasingly filled by the Net and the pressures of late capitalism, there are ways to fill Sunday
mornings that feel more important.</p><p>Having said that, I enjoyed the words and music intensely<span class=\\"dashes\\">â€‰â€”</span>â€‰lack of faith didnâ€™t get in the
way<span class=\\"dashes\\">â€‰â€”</span>â€‰and recommend doing this sort of thing from time to time.  I also think it might be good for you.
And maybe Iâ€™m wrong, maybe Jesus is the Way, the Truth, and the Light, and youâ€™ll end up saving your soul from eternal torment.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "SF-4: Serverless Latency?",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/14/SF-4",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "5",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/14/SF-4#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/14/SF-4",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-14T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-15T16:22:09-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Suppose we like the idea of going serverless (we do).  What should we worry about when we make that bet?  What I hear when I talk to people thinking about it, mostly, is latency.  Can a run-on-demand function respond as quickly as a warmed-up Web server sitting there in memory waiting for incoming work?  The answer, unsurprisingly, is â€œit dependsâ€.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Suppose we like the idea of going serverless (we do).  What should we worry about when we make that bet?  What I hear when I talk
to people thinking about it, mostly, is latency.  Can a run-on-demand function respond as quickly as a warmed-up Web server sitting
there in memory waiting for incoming work?  The answer, unsurprisingly, is â€œit dependsâ€.</p><p><i>[This is part of the<a href=\\"/ongoing/When/201x/2018/12/09/Serverlessness\\">Serverlessness</a>series.]</i></p><h2 id=\\"p-1\\">What we talk about when we talk about latency</h2><p>First of all, in this context, latency conversations are almost all about<em>compute</em>latency; in the AWS context, that
means Lambda
functions and Fargate containers.  For serverless messaging services like SQS and databases like DynamoDB, the answer is generally
â€œfast enough to not worry aboutâ€.</p><p>Thereâ€™s this anti-pattern that still happens sometimes: Iâ€™m talking to someone about this subject, and they say â€œI have a hard
latency requirement of 120msâ€.  (For those who arenâ€™t in this culture, â€œmsâ€ stands for milliseconds and is the common currency of
latency discussions. So in this case, a little over a tenth of a second.)</p><p>Inside AWS, a claim like that would be met with a blank
stare, because latency is way, way more than just a number. To steal from an old joke: Latency is more complicated than you think,
even when you think itâ€™s more complicated than you think.  Letâ€™s start with a graph:</p><img src=\\"latency-graph.png\\" alt=\\"Latency Graph\\"/><p>To start with, nobody should ever talk about latency without a P-number.  P50 means a time such that latency is less than that 50% of
the time, P90 such that latency is less 90% of the time, and so on into P99, P99.9; and then P100 is the longest latency observed in
some measurement interval.</p><p>Looking at that graph, you can see that half the queries completed in about a quarter of a second, 90% in
under a second, 99% in under five seconds, and there were a few trailers out there in twenty-something second territory. (If youâ€™re
wondering, this is a real graph of one of the microservices inside EC2 Auto Scaling, some control-plane call. The variation is
because most Auto Scaling Groups have a single-digit handful of instances in them, but some have hundreds and a very few have tens
of thousands.)</p><p>Now, letâ€™s make it more complicated.</p><h2 id=\\"p-2\\">Running hot and cold</h2><p>The time it takes to launch a function depends on how recently youâ€™ve launched the function. Because if youâ€™ve run it reasonably
recently, weâ€™ve probably got it loaded on a host and ready to go, itâ€™s just a matter of routing the event to the right place. If
not, we have to go find an empty host, find your function in storage, pull it out, and install it before we fire it up.  The latter
scenario is referred to as a â€œCold Startâ€, and with any luck will only show up at some high P-number, like P90 or higher. The
latency difference can be surprising.</p><p>It turns out that there are a variety of tricks you can use to remediate cold-start effects;<a href=\\"https://duckduckgo.com/?q=keeping+lambda+warm&t=h_&ia=web\\">ask your favorite search engine</a>. And thatâ€™s all Iâ€™m
going to say on the subject, because while the techniques work, theyâ€™re annoying and itâ€™s also annoying that people have to use
them; this is a problem that we need to just do away with.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2018/12/14/warming-lambda.png\\" alt=\\"warming up a lambda\\"/><div class=\\"caption\\"><p>Photo: Ryan Mahle from Sherman Oaks, CA, USA - Flickr.com</p></div><h2 id=\\"p-3\\">Polyglot latency</h2><p>Once the triggering event is routed to your function, your function gets to start computing.  Unfortunately, that doesnâ€™t mean it
always starts doing useful work right away; and that depends on the language itâ€™s written in.  If itâ€™s a NodeJS or Python program,
it might have to load and compile some source code.  If itâ€™s Java or .NET, it may have to get a VM running.  If itâ€™s Go or C++ or
Rust, you drop straight into binary code.</p><p>And because this is latency, itâ€™s even more complicated than that.  Because some of the language runtime initialization happens
only on cold starts and some even on warm starts.</p><p>Itâ€™s worth saying a few words about Java here.  There is no computer language that, for practical purposes, runs usefully faster
on general-purpose server-side code than Java. That is to say, Java after your program is all initialized and the VM warmed
up. There has been a more-or-less conscious culture, stretching back over the decades of Javaâ€™s life, of buying runtime performance
and being willing to sacrifice startup performance.</p><p>And of course itâ€™s not all Javaâ€™s fault; a lot of app code starts up slow because of massive dependency-injection frameworks
like Spring and Guice; these tend to prioritize flurries of calls through the Java reflection APIs over handling that first request.
Now, Java neednâ€™t have sluggish startup; if you<em>must</em>have dependency injection, check out<a href=\\"https://google.github.io/dagger/\\">Dagger</a>, which tries to do it at compile time.</p><img src=\\"gopher.png\\" alt=\\"The Go language gopher mascot\\" class=\\"inline\\"/><p>The take-away, though, is that mainstream Java is slow to start and you need to do extra work to get around that. My reaction is
â€œMaybe donâ€™t use Java then.â€ There are multiple other runtimes whose cold-start behavior doesnâ€™t feature those ugly P90 numbers.
One example would be NodeJS, and you could use that but I wouldnâ€™t, because I have no patience for the NPM dependency labyrinth
and also donâ€™t like JavaScript. Another would be Python, which is not only a decent choice but almost compulsory if youâ€™re in
Scientific Computing or Machine Learning.</p><p>But my personal favorite choice for serverless compute is the Go programming language. Itâ€™s got great, clean, fast, tooling, it
produces static binaries, itâ€™s got superb concurrency primitives that make it easy to avoid the kind of race conditions that plague
anyone who goes near java.lang.Thread, and finally, it is exceedingly readable, a criterion that weighs more heavily with me as each
year passes.  Plus the<a href=\\"https://github.com/aws/aws-lambda-go\\">Go Lambda runtime</a>is freaking excellent.</p><h2 id=\\"p-4\\">State hydration</h2><p>Itâ€™s easy to think about startup latency problems as part of the infrastructure, whether itâ€™s the service or the
runtime, but lots of times, latency problems are right there in your own code.  Itâ€™s not hard to see why; services like Lambda are
built around stateless functions, but sometimes, when an event arrives at the front door, you need some state to deal with it.
I call this process â€œstate hydrationâ€.</p><p>Hereâ€™s an extreme example of that: A startup I was talking to that had a growing customer base and also growing AWS bills.  Their
load was super peaky and they were (reasonably) grumpy about paying for computers to not do anything.  I said â€œServerless?â€ and they
said â€œYeah, no, not going to happenâ€ and I said â€œWhy not?â€ and they said â€œDrupalâ€.  Drupal is a PHP-based Web framework that
probably still drives a substantial portion of the Internet, but itâ€™s<em>very</em>database-centric, and this particular app needed
to run like eight PostgreSQL queries to recover enough context to do any useful work.  So a Lambda function wasnâ€™t really an
option.</p><p>Hereâ€™s an extreme example of the opposite, that I presented in a session at re:Invent 2017.  Thomson Reuters is a well-known news
organization that has to deal with loads of incoming videos; the process includes transcoding and reformatting.  This tends to be
linear in the size of the video with a multiplier not far off 1, so a half-hour video clip could take a half-hour to process.</p><p>They came up with this ultra-clever scheme where they used<a href=\\"https://www.ffmpeg.org/\\">FFmpeg</a>to chop the video up into half-second-ish segments, then threw them into an S3 bucket which
theyâ€™d set up to fire a Lambda for each new object. Those Lambdas processed the segments in parallel, FFmpeg glued them back
together, and all of a sudden they were processing a half-hour video in a handful of seconds.  State hydration?  No such thing, the
only thing the Lambda needed to know was the S3 object name.</p><p>Another nice thing about the serverless approach here is that doing this in the traditional style would have required staging a big
enough fleet, which (since this is a<em>news</em>publisher) would have meant predicting when news would happen, and how telegenic
it would be. Which would obviously be impossible.  So this app has SERVERLESS written on it in letters of fire 500 meters high.</p><h2 id=\\"p-5\\">Database or not</h2><p>The conventional approach to state hydration is to load your context out of a database.  And thatâ€™s not necessarily terrible, it
doesnâ€™t mean you have to get stuck in a corner like those Drupal-dependent people. For example:</p><ol><li><p>You could use something like Redis or Memcache (maybe via<a href=\\"https://aws.amazon.com/elasticache/\\">Elasticache</a>); those things are<em>fast</em>.</p></li><li><p>You could use a key/value optimized NoSQL database like DynamoDB or Cassandra or Mongo.</p></li><li><p>You could use something that supports GraphQL (like<a href=\\"https://aws.amazon.com/appsync/\\">AppSync</a>), a protocol specifically designed to turn a flurry of RESTful fetches into a
single optimized HTTP round trip.</p></li><li><p>You could package up your events with a whole lot more context so that the code processing them doesnâ€™t have to do much work
to get its bearings.  The SQS-to-Lambda capability we announced earlier this year is getting a whole lot of use, and I bet most
of those reader functions start up pretty damn quick.</p></li></ol><h2 id=\\"p-6\\">Latency and affinity</h2><p>Thereâ€™s been this widely-held belief for years that the only way to get good latency in handling events or requests is to have
state in memory.  Thus we have things like session affinity and â€œsticky sessionsâ€ in conventional Web-facing apps, where you try to
route strongly-related queries to the same server in a load-balanced fleet.</p><p>This can help with latency (weâ€™ve used it in AWS services), but comes with its own set of problems.  Most obviously, what happens
when you lose that host, either because it fails or because you need to bounce it to patch the OS?  First, you have to notice that
itâ€™s gone (harder than youâ€™d think to do reliably), then you have to adjust the affinity routing, then you have to refresh the
context in the replacement server. And what happens when you lose a whole Availability Zone, say a third of your fleet?</p><p>If you can possibly figure out a way to do state hydration fast, then you donâ€™t have to have those session affinity struggles;
just spray your requests or events across your fleet, trying to stress all the hosts evenly (still nontrivial, but tractable) and
have a much simpler management task.</p><p>And once youâ€™ve done that, you can probably just go serverless, let Lambda handle smoothing out the load, and donâ€™t write any code that
isnâ€™t pure value-adding application logic.</p><h2 id=\\"p-7\\">How to talk about it</h2><p>To start with, donâ€™t just say â€œI need 120ms.â€ Try something more like â€œThis has to be in Python, the dataâ€™s in Cassandra, and I need
the P50 down under a fifth of a second, except I can tolerate 5-second latency if it doesnâ€™t happen more than once an hour.â€
And in most mainstream applications, you should be able to get there with serverless. If you plan for it.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "SF-3: Serverless Everything?",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/11/SF-3",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "1",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/11/SF-3#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/11/SF-3",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-11T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-14T08:40:07-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Sometimes we fans get a little over-excited and declaim that<em>everything</em>should be serverless. After all, weâ€™re pretty convinced that owning data centers and computers is becoming a thing of the past.  Well then, how could configuring your own hosts and paying for them even when theyâ€™re not working ever be a good idea?  Letâ€™s try to be moderate and pragmatic:<em>Serverless, where possible</em>.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Sometimes we fans get a little over-excited and declaim that<em>everything</em>should be serverless. After all,
weâ€™re pretty convinced that owning data centers and computers is becoming a thing of the past.  Well then, how could configuring
your own hosts and paying for them even when theyâ€™re not working ever be a good idea?  Letâ€™s try to be moderate and
pragmatic:<em>Serverless, where possible</em>.</p><p><i>[This is part of the<a href=\\"/ongoing/When/201x/2018/12/09/Serverlessness\\">Serverlessness</a>series.]</i></p><p>But what does â€œWhere possibleâ€ mean?  Hereâ€™s a nice concrete example from inside AWS: the<a href=\\"https://aws.amazon.com/amazon-mq/\\">Amazon MQ</a>service, which is a managed version of the excellent<a href=\\"http://activemq.apache.org/\\">Apache ActiveMQ</a>open-source message broker.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2018/12/11/MQ.png\\" alt=\\"How Amazon MQ works\\"/><p>To make this usable by AWS customers, we had to write a bunch of software to create, deploy, configure, start, stop, and delete
message brokers.  In this sort of scenario, ActiveMQ itself is called the â€œdata planeâ€ and the management software we wrote is
called the â€œcontrol planeâ€. The control planeâ€™s APIs are RESTful and, in Amazon MQ, its implementation is entirely serverless, based
on Lambda, API Gateway, and DynamoDB.</p><p>Iâ€™m pretty convinced, and pretty sure this belief is shared widely inside AWS, that for this sort of control-plane stuff,
serverless is the right way to go, and any other way is probably a wrong way.  Amazon MQ is a popular service, but how often do you
need to wind up a new broker, or reconfigure one?  Itâ€™d be just nuts to have old-school servers sitting there humming away all the
time just waiting for someone to do that. Environmentally nuts and economically nuts.  So, donâ€™t do that.</p><p>The data plane, ActiveMQ, is a big Java program that you run on an EC2 instance the control plane sets up for you.
Client programs connect to it by nailing up TCP/IP
connections and shooting bytes back and forth.  MQ and its clients take care of the message framing with a variety of protocols:
STOMP, MQTT, AMQP, and JMS/OpenWire.  This is obviously not RESTful.</p><p>Because of the permanent connection (unlike an HTTP API that
sets them up and tears them down for each request) the messaging latency can be really, really low.  Of course, the downside of that
that the scaling is limited to whatever a single broker instance can handle.</p><p>Anyhow, the data plane is absolutely not serverless.  Is this OK?  Iâ€™m going to say that itâ€™s
just fine.  Among other things, at the moment we donâ€™t have a good serverless way to simultaneously use nailed-up TCP/IP connections
and dispatch serverless functions; you can imagine such a thing, but we donâ€™t have it now.</p><p>Because itâ€™s not serverless its scalability is limited, and youâ€™re going to be paying for it to turn electricity into heat
24/7/365 whether youâ€™re doing any messaging or not.  But for a lot of customers who just want somebody else to manage their MQ
instances, or who have to integrate with legacy apps that talk JMS or AMQP or whatever, itâ€™s still super useful.</p><h2 id=\\"p-1\\">Global weather</h2><p>Let me give you another example.  I was recently talking to a large public-sector weather service that maintains a model of the
global weather picture.  This needs to be updated all the time, and the update needs to complete in 43 minutes. The actual software
is a vast, sprawling thing built up over decades and substantially in FORTRAN.  To get acceptable performance, they have to buy
insanely expensive supercomputers and run them flat out.</p><p>Would serverless be a good idea?  Well maybe, but they donâ€™t know to decompose the model into small enough pieces to fit
into serverless functions.  â€œAre you looking at that?â€ I asked. â€œWeâ€™d love to,â€ was the answer â€œbut anyone who can figure it
out will probably get a Nobel Prize. Want to try?â€</p><p>I think that, since weather forecasting is pretty important to civic well-being, we can all agree that this is another scenario
where being serverful is OK. (Well, until someone wins that Nobel Prize.)</p><h2 id=\\"p-2\\">Back to the mainstream</h2><p>Now, letâ€™s stipulate that most customers are writing neither real-time message brokers nor models of the global atmosphere. Most
are running something with a Web front end and a database back-end and straightforward application logic in between.  These days,
itâ€™d be unsurprising if there were events streaming in from dumb machines or user clickstreams or whatever.  Why shouldnâ€™t all of
this be serverless?  I think it usually should be, but there are things that reasonable people worry about and deserve
consideration.  Thatâ€™s next.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "SF-2: Why Serverless?",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/10/SF-2",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "1",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/10/SF-2#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/10/SF-2",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-10T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-13T22:48:25-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">Well obviously: Frugality, security, and elasticity.  But I want more, I want<em>better software</em>.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>Well obviously: Frugality, security, and elasticity.  But I want more, I want<em>better software</em>.</p><p><i>[This is part of the<a href=\\"/ongoing/When/201x/2018/12/09/Serverlessness\\">Serverlessness</a>series.]</i></p><h2 id=\\"p-1\\">Frugality</h2><p>The core idea is that when your workload goes to zero, so does your bill.  You might save big;<a href=\\"https://aws.amazon.com/solutions/case-studies/financial-engines/\\">Financial Engines</a>is the first case study that Google
popped up for me, but Iâ€™ve heard muttered stories in the hallways about way bigger savings than that.  And then thereâ€™s my co-worker
who took his school-photographer wifeâ€™s Website billings from $10/month down to a few cents.</p><p>And weâ€™re not just talking about Lambda.  When there are no messages flowing through your SQS queue, youâ€™re not paying
anything. When your Step Functions workflow is waiting, itâ€™s just a row in a database. And so on and so on.</p><img src=\\"https://www.tbray.org/ongoing/When/201x/2018/12/10/DsEx9t5U0AASIlI.png\\" alt=\\"From Werner Vogelsâ€™ 2017 re:invent keynote\\"/><div class=\\"caption\\"><p>Disclosure: I lobbied to get that soundbite into that keynote.</p></div><h2 id=\\"p-2\\">Security</h2><p>When you canâ€™t see the servers, that means weâ€™re taking care of them.  And since servers fail, our services have to be designed to
survive restarts. Which means that we can (and do) bounce them whenever they need patching.  So whatever hosts your DynamoDB table
or your SNS topic is running on, theyâ€™re likely freshly-enough patched to cut the number of known vulnerabilities to just about the
minimum possible.<i>[Urgh, upon typing this, it occurred to me to check the uptime on the Linux box hosting
this blog, and itâ€™s like a year. The box generating the bits you are now reading is probably a soft target for
all the bad guys out there. Ahem.]</i></p><p>Anyhow, thereâ€™s no perfect security in this bad old world, but freshly-patched instances really do help a lot.</p><h2 id=\\"p-3\\">Elasticity</h2><p>When we deliver serverless services, what weâ€™re really trying to do is get you out of the business of capacity
forecasting. That business<em>sucks</em>.  Itâ€™s hard, and easy to get wrong; the penalty for estimating low is lousy
performance for your customers, and estimating high is throwing away money.  So go serverless and let us take care of that for
you.</p><p>(By the way, Iâ€™m not claiming that weâ€™re any smarter about capacity management than you are. When you aggregate all the AWS
customersâ€™ traffic, the lumpy local variations even out.  So itâ€™s a much easier problem if youâ€™re a public-cloud
provider. Of course you have to not mind billions in capex.)</p><h2 id=\\"p-4\\">What about software quality?</h2><p>As<a href=\\"/ongoing/When/201x/2018/07/31/Serverless-Economics\\">Iâ€™ve blogged before</a>, that â€œFrugality, Security, Elasticityâ€ pitch
operates at a more or less pure business level.  But Iâ€™m a technologist and engineer, so I have to ask,
are serverless application designs<em>better</em>designs?  I think the only honest answer is â€œWe donâ€™t know yet.â€</p><p>Having
said that, my gut is saying â€œyesâ€.  It helps that Iâ€™m an old functional-programming bigot, and the notion of stateless functions in
the cloud responding to events gives me a warm glow.  There are things we<em>do</em>know: microservices that are connected
asynchronously with messaging systems (e.g. SQS, 100% serverless) are more robust and flexible than those that arenâ€™t.  Butâ€¦ Can I
say we have a basis of experience sufficiently strong to say â€œServerless software is betterâ€?  Nope.</p><p>But Iâ€™m pretty sure that going serverless isnâ€™t going to give you a<em>worse</em>design. So you should bloody well go ahead and
do it, because: Frugality, Security, and Elasticity.</p><h2 id=\\"p-5\\">But waitâ€¦</h2><p>Look at that picture above from Werner Vogelsâ€™ keynote at the 2017 re:Invent.</p><p>Then consider the fact that you have a finite time budget for software design.  If you go serverless, then you you donâ€™t
have to design Kubernetes flows or Auto Scaling policies or fleet-health metrics or any of that other stuff.  All your design time
can be dedicated to, like Wernerâ€™s slide says, software that directly addresses business issues.  So, given more design time, youâ€™re<em>probably</em>gonna get a better design with serverless.</p><p>My feeling is, the<em>why</em>of serverless is pretty obvious. Itâ€™s the<em>how</em>thatâ€™s interesting.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "SF-1: What Is Serverless?",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/12/10/SF-1",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "0",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/12/10/SF-1#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/12/10/SF-1",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-10T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-12-13T22:48:12-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">I donâ€™t think itâ€™s<em>that</em>complicated: If you canâ€™t see the servers in the service, then itâ€™s serverless.  Yeah, theyâ€™re still there, but the<em>whole point</em>is that you can mostly not worry about them.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>I donâ€™t think itâ€™s<em>that</em>complicated: If you canâ€™t see the servers in the service, then itâ€™s serverless.  Yeah, theyâ€™re
still there, but the<em>whole point</em>is that you can mostly not worry about them.</p><p><i>[This is part of the<a href=\\"/ongoing/When/201x/2018/12/09/Serverlessness\\">Serverlessness</a>series.]</i></p><p>That doesnâ€™t work just for functions: Lots of
services, for example RDS (in certain flavors), ElasticSearch, and Amazon MQ, require that you pick an instance that the service runs
on before you start.  Letâ€™s extend the nomenclature a bit; if anything requires that you pre-provision IOPS (or other unit of
capacity), then thatâ€™s not so serverless.</p><img src=\\"MQ-broker.png\\" alt=\\"Launching an Amazon MQ broker\\"/><div class=\\"caption\\"><p>Itâ€™s a great service, but itâ€™s not serverless.</p></div><h2 id=\\"p-2\\">Etymology</h2><p>Several people, starting with Werner Vogels, have griped about the name â€œserverlessâ€, finding it ill-conceived and pointed in the
wrong direction, preferring positive rather than negative names.  Fair enough, but too bad, English is not just a living language
but a hasty, impulsive, pigheaded one, and itâ€™s settled on â€œServerlessâ€ now, so just deal.</p><p>By the way, any fool can plainly see that the opposite of Serverless is Serverful, with just one trailing â€œlâ€, just like
faithful, sinful, and skillful.</p><h2 id=\\"p-1\\">Itâ€™s not binary</h2><p>I heartily recommend Ben Kehoeâ€™s<a href=\\"https://read.acloud.guru/the-serverless-spectrum-147b02cb2292\\">The Serverless Spectrum</a>in support of this point.  Let
me illustrate by example:  Your basic enterprise Oracle deployment is the most serverful thing imaginable; with the primary,
fallback, and standby instances, itâ€™s<em>triply</em>serverful!
RDS Aurora Serverless is more serverless, and while DynamoDB has always been even more serverless, with the advent of<a href=\\"https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing/\\">On-Demand
mode</a>, itâ€™s<em>really</em>serverless.</p><p>Another example: An EC2 instance is hardly serverless, a Docker container launched in Fargate is really pretty serverless, while
a Lambda function is the epitome of serverlessness.</p><p>I think we are past the time to argue about what â€œserverlessâ€ means.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Step Functions Integration",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/11/30/States-Language-Connectors",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "1",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/11/30/States-Language-Connectors#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/11/30/States-Language-Connectors",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-11-30T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-11-30T22:09:56-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Cloud",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">On Thursday we launched some add-ons for<a href=\\"https://aws.amazon.com/step-functions/\\">AWS Step Functions</a>, on which I helped a bit. As usual, thereâ€™s<a href=\\"https://aws.amazon.com/blogs/aws/new-compute-database-messaging-analytics-and-machine-learning-integration-for-aws-step-functions/\\">a nice Jeff Barr blog</a>. This is to add design notes and extra color.</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>On Thursday we launched some add-ons for<a href=\\"https://aws.amazon.com/step-functions/\\">AWS Step Functions</a>, on which I helped a bit. As usual, thereâ€™s<a href=\\"https://aws.amazon.com/blogs/aws/new-compute-database-messaging-analytics-and-machine-learning-integration-for-aws-step-functions/\\">a
nice Jeff Barr blog</a>. This is to add design notes and extra color.</p><p>Our announcement describes these as â€œIntegrationsâ€<span class=\\"dashes\\">â€‰â€”</span>â€‰internally, while we were building them, we
called them Connectors, and Iâ€™m going to stick with that because it has one less syllable and feels idiomatic.</p><h2 id=\\"p-1\\">Tl;dr</h2><p>Up till now, Step Functions knew how to hand work to Lambda functions and to polling â€œActivity Workersâ€.  As of now, it can also
make use
of DynamoDB (read/write), Batch (start a job in either fire-and-forget or wait-for completion mode), ECS (regular and Fargate
flavors), SNS (write-only), SQS (write-only), Glue (like Batch, async or sync), and SageMaker (same).</p><p>Of course, you could do all this before, by running a little Lambda function to call whatever API, but now Step Functions
knows how to make those calls directly. Which means fewer Lambdas to own and maintain.  Also this should run a little faster without
an interposed function, and finally, Step Functions can be smarter about dealing with retries and throttling and so on.</p><h2 id=\\"p-2\\">How it works</h2><p>Nothing essential in the<a href=\\"https://states-language.net/spec.html\\">Amazon States Language</a>has changed.  Just as before, you use a Task State to get
work done, and you identify the work in the value of the Resource field, which is a URI.  Used to be, the only URIs recognized were
Lambda ARNs and Activity-worker Task ARNs. Yeah, as far as I know, nobodyâ€™s ever registered AWSâ€™s â€œarnâ€ URI scheme, but for all
practical purposes theyâ€™re perfectly good URIs.</p><p>So all we really had to do to make this work was teach Step Functions to recognize new flavors of ARNs: One for each of the
operations I mentioned above.  For example, the Resource value that requests fetching a DynamoDB item is<code>arn:aws:states:::dynamodb:getItem</code>.  All the other stuff in Task states about Retriers and Catchers and so on goes on
working just as it did before.</p><p>This notion of short strings that identify a â€œunit of information or serviceâ€ is a straightforward use of URIs,
and shouldnâ€™t be surprising to anyone who understands how the Web works.</p><p>In most cases, the implementation is simple enough; the service just feeds the appropriate input data to the indicated API.
But a couple of the new Connectors go further, for example running a Batch job in synchronous mode.  It turns out that the Batch service
only has a fire-and-forget API, so what the service does in this case is write a rule into the callerâ€™s CLoudWatch Events account
which catches<a href=\\"https://docs.aws.amazon.com/batch/latest/userguide/batch_cwe_events.html\\">Batchâ€™s job-finished event</a>and routes it to an SQS queue, which Step Functions has a long-poll posted on to find out
when the work is done.</p><p>Once again, customers could previously have set this up for themselves (and in fact some have) but it just makes more sense to
offer it as a built-in.</p><h2 id=\\"p-5\\">Parameterization</h2><p>Step Functions has always had a tool,<a href=\\"https://states-language.net/spec.html#filters\\">the â€œInputPathâ€ field</a>, to filter incoming input and select bits and
pieces of it to feed to
workers.  When we started working on the first few Connectors, we realized it wasnâ€™t quite up to the task of assembling the correct
input for an arbitrary collection of API calls.  We were at risk of replacing the dumb little Lambdas that existed just to call APIs
with even dumber little Lambdas that just wrangled JSON into the right shape to call the API.</p><p>Thus the States Languageâ€™s brand-new â€œParametersâ€ field.  To explain this, Iâ€™m going to re-use the example from Jeffâ€™s blog linked
above:</p><pre><code>1 \\"Read Next Message from DynamoDB\\": {
 2      \\"Type\\": \\"Task\\",
 3      \\"Resource\\": \\"arn:aws:states:::dynamodb:getItem\\",
 4      \\"Parameters\\": {
 5        \\"TableName\\": \\"StepDemoStack-DDBTable-1DKVAVTZ1QTSH\\",
 6        \\"Key\\": {
 7          \\"MessageId\\": {\\"S.$\\": \\"$.List[0]\\"}
 8        }
 9      },
10      \\"ResultPath\\": \\"$.DynamoDB\\",
11      \\"Next\\": \\"Send Message to SQS\\"
12    }</code></pre><p>You can see the magic read-from-Dynamo ARN there in the Resource field on line 3.  But itâ€™s the Parameters field value thatâ€™s
interesting.
It has the right JSON shape to hold the<code>GetItem</code>API arguments, but buried down in the Key field on line 7 thereâ€™s a little
weirdness going on.  It turns out that DynamoDB wants you to pass a string argument by sending JSON that looks like:</p><p><code>\\"S\\": \\"My own personal string key\\"</code></p><p>In line 7, you see a field whose name is â€œS.$â€ and value is â€œ$.List[0]â€.  That â€œ.$â€ suffix is the new
thing; whenever you see that in the Parameters block, it means that the value is to be interpreted as a JSONPath, applied to the
stateâ€™s input, and then the whole field is replaced by one whose name is the same with the â€œ.$â€ suffix subtracted, and whose value
is whatever you got from the JSONPath.<br/><i>[Tim, what if their API already uses a field whose name ends in â€œ.$â€? -Ed.]<br/>[That would be unfortunate. -T]</i></p><p>We think this should provide people with most of what they need to compose the arguments for almost
anything you might want to invoke.
By the way, the Parameters-block idea wasnâ€™t mine, it was cooked up by folks on the Step Functions team, notably Ali Baghani.  And
because itâ€™s not mine, I can say: Way cool!</p><h2 id=\\"p-7\\">Permissions</h2><p>If you go to the console and set up a state machine like the one in the example, we can do an extra trick, namely look at all the
Connectors in your machine, figure out what permissions you need to make those calls, and synthesize a Role for you, designed to be
used in running that state machine.</p><h2 id=\\"p-6\\">API mapping?</h2><p>Now, if you look at the way weâ€™ve provided mappings for a few of the AWS APIs, you might reasonably wonder â€œWhy not<em>all</em>of them?â€.  After all, I notice that<a href=\\"https://github.com/DiegoZoracKy\\">Diego ZoracKy</a>recently published<a href=\\"https://github.com/DiegoZoracKy/lambda-aws-sdk-call\\">a general-purpose Lambda function</a>that does just
that<span class=\\"dashes\\">â€‰â€”</span>â€‰give it the API name and the right arguments and itâ€™ll do the call.</p><p>Itâ€™s not a crazy idea, but weâ€™re not going to do it.  Blindly calling APIs without having thought it through a little could be a
recipe for unhappiness.  We want to make sure that when we make those calls, weâ€™re being sensible about buffering, polling mode,
retrying, checking for impossible arguments, and so on. For example, we support sending a message to SQS, but receiving one will
require some head-scratching about whether and when to delete after a successful read.</p><p>Also, in some cases we might want to do prep work, as we already do to make
those asynchronous fire-and-forget APIs look synchronous when you put them in a state machine.</p><p>So, weâ€™re going to reserve the right to add Connectors at our own speed and in a thoughtful way.</p><h2 id=\\"p-3\\">Future directions</h2><p>The fact that we identify workers with URIs leaves the door open for any kind of future Connector you can think of.
There are lots of obvious candidates in the AWS SDK, to start with.  One especially obvious one is supporting the ARNs of other Step
Functions state machines, giving you nested child-workflow invocations.</p><p>Another is allowing the use of any old HTTP endpoint URL, so your state machine could talk to any Web API in the
universe.  I suppose weâ€™ll need to add an \\"HTTP-method\\" field or equivalent to specify whether you want GET or
POST.</p><p>Anyhow, there are lots of Step Functions features on the road map that arenâ€™t just Connectors; but I suspect that weâ€™re going to
come under pressure to keep adding them, starting today and going on more or less forever.</p><h2 id=\\"p-8\\">States-Language housekeeping</h2><p>The<a href=\\"https://states-language.net/spec.html\\">States Language spec</a>has been updated, and so has its<a href=\\"https://github.com/awslabs/states-language\\">source on GitHub</a>.  So has the<a href=\\"https://github.com/awslabs/statelint\\">statelint</a>state-machine validator (and the Ruby Gem updated).</p><p>All these years
into my career, I still get a little thrill being part of the Launch Day dance, a few little pushes with my own pinkies.</p><p>I tested my parts pretty hard but there might be bugs; I do look at pull requests and have taken some in the past.  In particular I
have to say thank-you for<a href=\\"https://github.com/awslabs/j2119/commits?author=jezhiggins\\">jezhigginsâ€™ updates</a>to the supporting<a href=\\"https://github.com/awslabs/j2119\\">j2119 parser generator</a>that
made it possible to add Parameters validation to statelint.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Post-REST",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/11/18/Post-REST",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "7",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/11/18/Post-REST#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/11/18/Post-REST",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-11-18T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-11-19T19:38:10-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology/Web",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Technology",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Web",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">More or less all the big APIs are RESTful these days.  Yeah, you can quibble about what â€œRESTâ€ means (and I will, a bit) but the assertion is broadly true.  Is it going to stay that way forever?  Seems unlikely.  So, whatâ€™s next?</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>More or less all the big APIs are RESTful these days.  Yeah, you can quibble about what â€œRESTâ€ means (and I will, a bit) but the
assertion is broadly true.  Is it going to stay that way forever?  Seems unlikely.  So, whatâ€™s next?</p><h2 id=\\"p-1\\">What we talk about when we talk about â€œRESTâ€</h2><p>These days, itâ€™s used colloquially to mean any API that is HTTP-based.  In fact, the vast majority of them offer CRUD operations
on things that have URIs, embed some of those URIs in their payloads, and thus are arguably RESTful in the original sense; although
these days Iâ€™m hearing the occasional â€œCRUDLâ€ where L is for List.</p><p>At AWS where I work, we almost always distinguish, for a service or an app, between its â€œcontrol planeâ€ and its â€œdata planeâ€.
For example, consider our database-as-a-service<a href=\\"https://aws.amazon.com/rds/\\">RDS</a>; the control plane APIs are where you create, configure, back-up, start, stop, and
delete databases.  The data plane is SQL, with connection pools and all that RDBMS baggage.</p><p>Itâ€™s interesting to note that the control plane is RESTful, but the data plane isnâ€™t at all. (This isnâ€™t
necessarily a database thing: DynamoDBâ€™s data plane is pretty RESTful.)</p><p>I think thereâ€™s a pattern there: The control plane for almost<em>anything</em>online has a good chance of being RESTful because,
well, thatâ€™s where youâ€™re going to be creating and deleting stuff.
The data plane might be a different story; my first prediction here is that whatever starts to displace REST will start doing it on
the data plane side, if only because control planes and REST are such a natural fit.</p><h2 id=\\"p-2\\">RESTful imperfections</h2><p>What are some reasons we might want to move beyond REST?  Let me list a few:</p><h3 id=\\"p-4\\">Latency</h3><p>Setting up and tearing down an HTTP connection for every little operation you want to do is not free.  A couple of decades
of effort have reduced the cost, but still.</p><p>For example, consider two messaging systems that are built by people who sit close to me:<a href=\\"https://aws.amazon.com/sqs/\\">Amazon SQS</a>and<a href=\\"https://aws.amazon.com/amazon-mq/\\">MQ</a>.
SQS has been running for a dozen years and can handle millions of messages per second and, assuming your senders and receivers are
reasonably well balanced, can be<em>really freaking fast</em><span class=\\"dashes\\">â€‰â€”</span>â€‰in fact, Iâ€™ve heard stories of messages
actually being received before they were sent; the long-polling receiver grabbed the message before the sender side got around to
tearing down the PutMessage HTTP connection.  But the MQ data plane, on the other hand, doesnâ€™t use HTTP, it uses nailed-up TCP/IP
connections with its own framing protocols. So you can get astonishingly low latencies for transmit and receive operations. But, on
the other hand, your throughput is limited by the number of messages the â€œmessage brokerâ€ terminating those connections can handle.
A lot of people who use MQ are pretty convinced that one of the reasons theyâ€™re doing this is they donâ€™t<em>want</em>a RESTful
interface.</p><h3 id=\\"p-5\\">Coupling</h3><p>In the wild, most REST requests (like most things labeled as APIs) operate synchronously; that is
to say, you call them (GET, POST, PUT, whatever) and you stall until you get your result back.  Now (speaking HTTP lingo) your
request might return 202 Accepted, in which case youâ€™d expect either to have sent a URI along to be called back as a webhook, or to
get one in the response that you can poll.  But in all these cases, the coupling is still pretty tight; you (the caller) have to
maintain some sort of state about the request until the caller has done with it, whether thatâ€™s now or later.</p><p>Which sort of sucks.  In particular when itâ€™s one microservice calling another and the client service is sending
requests at a higher rate than the server-side one can handle; a situation that can lead to acute pain very quickly.</p><h3 id=\\"p-6\\">Short life</h3><p>Handling some requests takes milliseconds. Handling others<span class=\\"dashes\\">â€‰â€”</span>â€‰a citizenship application, for
example<span class=\\"dashes\\">â€‰â€”</span>â€‰can take weeks and involve orchestrating lots of services, and occasionally human
interactions.  The notion of having a thread hanging waiting for something to happen is ridiculous.</p><h2 id=\\"p-7\\">A word on GraphQL</h2><p>It exists, basically, to handle the situation where a client has to assemble several flavors of information
do its job<span class=\\"dashes\\">â€‰â€”</span>â€‰for example, a mobile app building an information-rich display.  Since RESTful interfaces
tend to do a good job of telling you about a single resource, this can lead to a wasteful flurry of requests. So GraphQL lets you
cherry-pick an arbitrary selection of fields from multiple resources in a single request.
Presumably, the server-side implementation issues that
request flurry inside the data center where those calls are cheaper, then assembles your GraphQL output, but anyhow thatâ€™s no longer
your problem.</p><p>I observe that lots of client developers like GraphQL, and it seems like the world has a place for it, but I donâ€™t see it as that
big a game-changer. To start with, itâ€™s not as though client developers can compose arbitrary queries, limited only by the semantics
of GraphQL, and expect to get uniformly decent performance. (To be fair, the same is true of SQL.)  Anyhow, I see GraphQL as a
convenience feature designed to make synchronous APIs run more efficiently.</p><h2 id=\\"p-8\\">A word on RPC</h2><p>By which, these days, I guess I must mean gRPC.  I dunno, Iâ€™m old enough that I saw generation after generation of RPC frameworks
fail miserably; brittle, requiring lots of configuration, and failing to deliver the anticipated performance wins.  Smells like
making RESTful APIs more tightly coupled, to me, and itâ€™s hard to see that as a win.  But I could be wrong.</p><h2 id=\\"p-9\\">Post-REST: Messaging and Eventing</h2><p>This approach is all over, and I mean<em>all</em>over, the cloud infrastructure that I work on.  The idea is you get a request,
you validate it, maybe you do some computation on it, then you drop it on a queue (or bus, or stream, or whatever you want to call
it) and forget about it, itâ€™s not your problem any more.</p><p>The next stage of request handling is implemented by services that read the queue and either route an answer back to the original
requester or passes it on to another service stage.  Now for this to work, the queues in question have to be fast (which these,
days, they are), scalable (which they are), and very, very durable (which they are).</p><p>There are a lot of wins here: To start with, transient query surges are no longer a problem.  Also, once youâ€™ve got a message stream
you can do fan-out and filtering and assembly and subsetting and all sorts of other useful stuff, without disturbing the operations
of the upstream message source.</p><h2 id=\\"p-10\\">Post-REST: Orchestration</h2><p>This gets into workflow territory, something<a href=\\"https://states-language.net/spec.html\\">Iâ€™ve been working on a lot recently</a>.  Where by â€œworkflowâ€ I mean a service
tracking the state of computations that have multiple steps, any one of which can take an arbitrarily long time period, can fail,
can need to be retried, and whose behavior and output affect the choice of subsequent output steps and their behavior.</p><p>An increasing number of (for example) Lambda functions are, rather than serving requests and returning responses, executing in
the context of a workflow that provides their input, waits for them to complete, and routes their output further downstream.</p><h2 id=\\"p-11\\">Post-REST: Persistent connections</h2><p>Back a few paragraphs I talked about how MQ message brokers work, maintaining a bunch of nailed-up network connections, and
pumping bytes back and forth across them.  Itâ€™s not hard to believe that there are lots of scenarios where this is a good fit for
the way data and execution want to flow.</p><p>Now, weâ€™re already partway there. For example, SQS clients routinely use â€œlong pollingâ€ (typically around 30 seconds) to receive
messages. That means, they ask for messages and if there arenâ€™t any, the server doesnâ€™t say â€œno diceâ€, it holds up the connection
for a while and if some messages come in, shoots them back to the caller.  If you have a bunch of threads (potentially on multiple
hosts) long-polling an SQS queue, you can get massive throughput and latency and really reduce the cost of using HTTP.</p><p>The next two steps forward are pretty easy to see, too. The first is HTTP/2, already widely deployed, which lets you
multiplex multiple HTTP requests across a single network connection.  Used intelligently, it can buy you quite a few of the benefits
of a permanent connection.  But itâ€™s still firmly tied to TCP, which has some unfortunate side-effects that Iâ€™m not going to
deep-dive on here, partly because itâ€™s not a thing I understand that deeply.  But I expect to see lots of apps and services get good
value out of HTTP/2 going forward; in some part because as far as clients can tell, theyâ€™re still making, and responding to, the
same old HTTP requests they were before.</p><p>The next step after that is QUIC (<b>Q</b>uick<b>U</b>DP<b>I</b>nternet<b>C</b>onnections) which abandons
TCP in favor of UDP, while retaining HTTP semantics.  This is already in production on a lot of Google properties.  I personally
think itâ€™s a really big deal; one of the reasons that HTTP was so successful is that its connections are short-lived and thus
much less likely to suffer breakage while theyâ€™re at work. This is really good because designing an application-level protocol which
can deal with broken connections is super-hard.  In the world of HTTP, the most you have to deal with at one time is a failed
request, and a broken connection is just one of the reasons that can happen.  UDP makes the connection-breakage problem go away by not
really having connections.</p><p>Of course, thereâ€™s no free lunch.  If youâ€™re using UDP, youâ€™re not getting the TC in TCP,<b>T</b>ransmission<b>C</b>ontrol I
mean, which takes care of packetizing and reassembly and checksumming and throttling and loads of other super-useful stuff.  But
judging by the evidence I see, QUIC does enough of that well enough to support HTTP semantics cleanly, so once again, apps
that want to go on using the same old XMLHttpRequest calls like it was 2005 can remain happily oblivious.</p><h2 id=\\"p-12\\">Brave New World!</h2><p>It seems inevitable to me that, particularly in the world of high-throughput high-elasticity cloud-native apps, weâ€™re going to
see a steady increase in reliance on persistent connections, orchestration, and message/event-based logic.  If youâ€™re not using that
stuff already, now would be a good time to start learning.</p><p>But I bet that for the foreseeable future, a high proportion of all requests to services are going to have
(approximately) HTTP semantics, and that for most control planes and quite a few data planes, REST still provides a good clean way
to decompose complicated problems, and its extreme simplicity and resilience will mean that if you want to design networked apps,
youâ€™re still going to have to learn that way of thinking about things.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
    Object {
      "attrs": Map {},
      "meta": Map {
        "title" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "Car Capitalism",
        },
        "link" => Array [
          Object {
            "attrs": Map {
              "href" => "https://www.tbray.org/ongoing/When/201x/2018/11/13/Car-Capitalism",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "rel" => "replies",
              "thr:count" => "5",
              "type" => "application/xhtml+xml",
              "href" => "/ongoing/When/201x/2018/11/13/Car-Capitalism#comments",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "id" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "https://www.tbray.org/ongoing/When/201x/2018/11/13/Car-Capitalism",
        },
        "published" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-11-13T12:00:00-08:00",
        },
        "updated" => Object {
          "attrs": Map {},
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "2018-11-13T22:26:52-08:00",
        },
        "category" => Array [
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World/Politics",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "The World",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
          Object {
            "attrs": Map {
              "scheme" => "https://www.tbray.org/ongoing/What/",
              "term" => "Politics",
            },
            "meta": Map {},
            "uri": "http://www.w3.org/2005/Atom",
          },
        ],
        "summary" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\">What happened was, I was<a href=\\"/ongoing/When/201x/2018/10/27/Jaguar-Art-of-Performance-tour\\">hurtling around a mall parking lot</a>in a beautiful British-designed hundred-thousand-dollar sports car, and I thought â€œIs this the good side of capitalism?â€</div>",
        },
        "content" => Object {
          "attrs": Map {
            "type" => "xhtml",
          },
          "meta": Map {},
          "uri": "http://www.w3.org/2005/Atom",
          "value": "<div xmlns=\\"http://www.w3.org/1999/xhtml\\"><p>What happened was, I was<a href=\\"/ongoing/When/201x/2018/10/27/Jaguar-Art-of-Performance-tour\\">hurtling around a mall parking lot</a>in a
beautiful British-designed hundred-thousand-dollar sports car, and I thought â€œIs this the good side of capitalism?â€</p><h2 id=\\"p-1\\">I ♥ Cars</h2><p>Disclosure: I like driving sufficiently well to have written, ten years ago,<a href=\\"/ongoing/When/200x/2008/09/19/Driving\\">an encomium on the subject</a>that includes a police takedown and a poem.</p><p>And there are lots of things to like about the business. It produces products across a huge ranges of prices that work
pretty well<span class=\\"dashes\\">â€‰â€”</span>â€‰better every year, in fact<span class=\\"dashes\\">â€‰â€”</span>â€‰and last a long time, and about
which people have strong aesthetic feelings.</p><p>Thereâ€™s no suggestion of monopoly; competition is fierce and itâ€™s possible for new companies
to grab a foothold.  The industry tends to place value on its workers, paying them and treating them reasonably well.  They
do not, at least mostly, have<a href=\\"https://en.wikipedia.org/wiki/Bullshit_Jobs\\">bullshit jobs</a>.</p><p>Also, cars address humansâ€™ naturally nomadic nature; there is a special joy in getting on the road and
heading out in any direction you damn well please, as far as the road goes.  Making that possible really just canâ€™t be a bad thing.</p><h2 id=\\"p-2\\">Butâ€¦</h2><p>Automobiles have had to be regulated fiercely almost from day one: Their speeds, where they can drive and park,
the safety standards on their tires and electronics and brakes and crumple zones and seatbelts and child seating, and of course
emissions. The notion of a<i>laissez-faire</i>auto industry is laughable.</p><p>And given the slightest chance, car companies lie,
cheat, and steal. For example, the recent â€œdieselgateâ€ scandal played out against a backdrop of nudge-nudge wink-wink regulatory
capture where everyone knew that any given car emitted more and got worse mileage than it said on the label.  Sometimes the
corruption was laughably public, as with the US regulators<a href=\\"https://en.wikipedia.org/wiki/Chrysler_PT_Cruiser#Overview\\">classifying shitboxes like the PT Cruiser as â€œtrucksâ€</a>so
they could skate around emission regulations.</p><p>Not to mention the resistance, in recent years, to looking seriously at electric cars. In the face of terrifying climate-change
predictions, the industry did the absolute bare minimum they were forced to. Only now, under combined pressure from global
regulators and Tesla engineering, are they showing signs of taking it seriously.</p><h2 id=\\"p-1\\">Your point is?</h2><p>Iâ€™m a left-winger and somehow still like a lot of things about business: The drive to figure out what people need and want and
get that to them; the labyrinthine fascinations of marketing and sales; drama in trying something out that might not work;
satisfaction of being on a well-functioning team.</p><p>But yeah, the auto industry is the<em>nice</em>end of the private sector.  So much of business is poverty-by-policy, bullshit
jobs, institutionalized mismanagement, work-life balance seen as a failing, egregious sexism, corruption of the public sector, and
hyperentitled one-percenters who are so, so sure that they earned it all with their own hard work, deserve every penny, and the 99%
are just losers who deserve what theyâ€™re getting. [Me, I got lucky and know so many people who are smarter than me and work harder
and are struggling to make ends meet.  Why is that so hard to admit?]</p><p>Iâ€™m an optimist. I think we can find a better and more balanced way to build an economy and, in the fullness of time, will. And I
hope we can still have cool cars.</p></div>",
        },
      },
      "uri": "http://www.w3.org/2005/Atom",
    },
  ],
}
`;
